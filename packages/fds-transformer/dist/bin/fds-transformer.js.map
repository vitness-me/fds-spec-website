{"version":3,"sources":["../../node_modules/tsup/assets/esm_shims.js","../../src/schemas/bundled/v1.0.0/exercise.schema.json","../../src/schemas/bundled/v1.0.0/equipment.schema.json","../../src/schemas/bundled/v1.0.0/muscle.schema.json","../../src/schemas/bundled/v1.0.0/muscle-category.schema.json","../../src/schemas/bundled/v1.0.0/body-atlas.schema.json","../../src/schemas/bundled/v1.0.0/index.ts","../../src/bin/fds-transformer.ts","../../src/core/transformer.ts","../../src/core/mapping-engine.ts","../../src/transforms/transform-registry.ts","../../src/transforms/builtin/slugify.ts","../../src/transforms/builtin/title-case.ts","../../src/transforms/builtin/uuid.ts","../../src/transforms/builtin/to-array.ts","../../src/transforms/builtin/auto-generate.ts","../../src/transforms/builtin/registry-lookup.ts","../../src/transforms/builtin/template.ts","../../src/transforms/builtin/url-transform.ts","../../src/registries/registry-manager.ts","../../src/registries/fuzzy-matcher.ts","../../src/schemas/schema-manager.ts","../../src/schemas/validator.ts","../../src/ai/enrichment-engine.ts","../../src/ai/providers/openrouter.ts","../../src/ai/rate-limiter.ts","../../src/ai/checkpoint-manager.ts","../../src/ai/prompts/exercise-prompts.ts","../../src/ai/prompts/tier-prompts.ts","../../src/config/config-loader.ts","../../src/core/batch-processor.ts"],"sourcesContent":["// Shim globals in esm bundle\nimport path from 'node:path'\nimport { fileURLToPath } from 'node:url'\n\nconst getFilename = () => fileURLToPath(import.meta.url)\nconst getDirname = () => path.dirname(getFilename())\n\nexport const __dirname = /* @__PURE__ */ getDirname()\nexport const __filename = /* @__PURE__ */ getFilename()\n","{\n  \"$id\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json\",\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"FDS Exercise (v1.0.0)\",\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"required\": [\n    \"schemaVersion\",\n    \"exerciseId\",\n    \"canonical\",\n    \"classification\",\n    \"targets\",\n    \"metrics\",\n    \"metadata\"\n  ],\n  \"properties\": {\n    \"schemaVersion\": {\n      \"type\": \"string\",\n      \"pattern\": \"^[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\"\n    },\n    \"exerciseId\": {\n      \"type\": \"string\"\n    },\n    \"canonical\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"name\",\n        \"slug\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"slug\": {\n          \"type\": \"string\",\n          \"pattern\": \"^[a-z0-9-]{2,}$\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\",\n            \"minLength\": 1\n          },\n          \"uniqueItems\": true\n        },\n        \"localized\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"lang\",\n              \"name\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"lang\": {\n                \"type\": \"string\"\n              },\n              \"name\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"description\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"aliases\": {\n                \"type\": \"array\",\n                \"items\": {\n                  \"type\": \"string\",\n                  \"minLength\": 1\n                },\n                \"uniqueItems\": true\n              }\n            }\n          }\n        }\n      }\n    },\n    \"classification\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"exerciseType\",\n        \"movement\",\n        \"mechanics\",\n        \"force\",\n        \"level\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"exerciseType\" : {\n          \"type\": \"string\"\n        },\n        \"movement\": {\n          \"$ref\": \"#/$defs/movement\"\n        },\n        \"mechanics\": {\n          \"$ref\": \"#/$defs/mechanics\"\n        },\n        \"force\": {\n          \"$ref\": \"#/$defs/force\"\n        },\n        \"level\": {\n          \"$ref\": \"#/$defs/level\"\n        },\n        \"unilateral\": {\n          \"type\": \"boolean\",\n          \"default\": false\n        },\n        \"kineticChain\": {\n          \"$ref\": \"#/$defs/kineticChain\"\n        },\n        \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"taxonomyRefs\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"registry\",\n              \"id\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"registry\": {\n                \"type\": \"string\",\n                \"format\": \"uri-reference\"\n              },\n              \"id\": {\n                \"type\": \"string\"\n              },\n              \"label\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"targets\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"primary\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"primary\": {\n          \"type\": \"array\",\n          \"minItems\": 1,\n          \"items\": {\n            \"$ref\": \"#/$defs/muscleRef\"\n          }\n        },\n        \"secondary\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/muscleRef\"\n          }\n        }\n      }\n    },\n    \"equipment\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"required\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/equipmentRef\"\n          }\n        },\n        \"optional\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/equipmentRef\"\n          }\n        }\n      }\n    },\n    \"constraints\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"contraindications\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"prerequisites\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"progressions\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"regressions\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"environment\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"relations\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\n          \"type\",\n          \"targetId\"\n        ],\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"type\": {\n            \"$ref\": \"#/$defs/relationTypes\"\n          },\n          \"targetId\": {\n            \"type\": \"string\"\n          },\n          \"confidence\": {\n            \"type\": \"number\",\n            \"minimum\": 0,\n            \"maximum\": 1\n          },\n          \"notes\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"metrics\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"required\": [\n        \"primary\"\n      ],\n      \"properties\": {\n        \"primary\": {\n          \"$ref\": \"#/$defs/metricRef\"\n        },\n        \"secondary\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"$ref\": \"#/$defs/metricRef\"\n          },\n          \"uniqueItems\": true\n        }\n      }\n    },\n    \"media\": {\n      \"$ref\": \"#/$defs/media\"\n    },\n    \"attributes\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true\n    },\n    \"extensions\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true\n    },\n    \"metadata\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"createdAt\",\n        \"updatedAt\",\n        \"status\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"createdAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n        \"updatedAt\": {\n          \"type\": \"string\",\n          \"format\": \"date-time\"\n        },\n        \"source\": {\n          \"type\": \"string\"\n        },\n        \"version\": {\n          \"type\": \"string\"\n        },\n        \"status\" : {\n          \"$ref\": \"#/$defs/status\"\n        },\n        \"deprecated\": {\n          \"type\": \"object\",\n          \"additionalProperties\": false,\n          \"properties\": {\n            \"since\": {\n              \"type\": \"string\",\n              \"pattern\": \"^[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\"\n            },\n            \"replacedBy\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"externalRefs\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"system\",\n              \"id\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"system\": { \n                \"type\": \"string\"\n              },\n              \"id\": { \n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"history\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"at\": {\n                \"type\": \"string\",\n                \"format\": \"date-time\"\n              },\n              \"actor\": {\n                \"type\": \"string\"\n              },\n              \"change\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"$defs\": {\n    \"muscleRef\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"id\",\n        \"name\",\n        \"categoryId\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"id\": {\n          \"type\": \"string\"\n        },\n        \"slug\": {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"categoryId\": {\n          \"type\": \"string\"\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"equipmentRef\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"id\",\n        \"name\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"id\": {\n          \"type\": \"string\"\n        },\n        \"slug\": {\n          \"type\": \"string\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"abbreviation\": {\n          \"type\": \"string\"\n        },\n        \"categories\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"metricRef\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"required\": [\n        \"type\",\n        \"unit\"\n      ],\n      \"properties\": {\n        \"type\": {\n          \"$ref\": \"#/$defs/metricType\"\n        },\n        \"unit\": {\n          \"$ref\": \"#/$defs/metricUnit\"\n        }\n      }\n    },\n    \"metricType\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"reps\",\n        \"weight\",\n        \"duration\",\n        \"distance\",\n        \"speed\",\n        \"pace\",\n        \"power\",\n        \"heartRate\",\n        \"steps\",\n        \"calories\",\n        \"height\",\n        \"tempo\",\n        \"rpe\"\n      ]\n    },\n    \"metricUnit\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"count\",\n        \"kg\",\n        \"lb\",\n        \"s\",\n        \"min\",\n        \"m\",\n        \"km\",\n        \"mi\",\n        \"m_s\",\n        \"km_h\",\n        \"min_per_km\",\n        \"min_per_mi\",\n        \"W\",\n        \"bpm\",\n        \"kcal\",\n        \"cm\",\n        \"in\"\n      ]\n    },\n    \"movement\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"squat\",\n        \"hinge\",\n        \"lunge\",\n        \"push-horizontal\",\n        \"push-vertical\",\n        \"pull-horizontal\",\n        \"pull-vertical\",\n        \"carry\",\n        \"core-anti-extension\",\n        \"core-anti-rotation\",\n        \"rotation\",\n        \"locomotion\",\n        \"isolation\",\n        \"other\"\n      ]\n    },\n    \"mechanics\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"compound\",\n        \"isolation\"\n      ]\n    },\n    \"force\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"push\",\n        \"pull\",\n        \"static\",\n        \"mixed\"\n      ]\n    },\n    \"level\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"beginner\",\n        \"intermediate\",\n        \"advanced\"\n      ]\n    },\n    \"kineticChain\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"open\",\n        \"closed\",\n        \"mixed\"\n      ],\n      \"default\": \"mixed\"\n    },\n    \"relationTypes\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"alternate\",\n        \"variation\",\n        \"substitute\",\n        \"progression\",\n        \"regression\",\n        \"equipmentVariant\",\n        \"accessory\",\n        \"mobilityPrep\",\n        \"similarPattern\",\n        \"unilateralPair\",\n        \"contralateralPair\"\n      ]\n    },\n    \"media\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\"type\",\"uri\"],\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"type\": { \n            \"type\": \"string\", \n            \"enum\": [\n              \"image\",\n              \"video\",\n              \"doc\",\n              \"3d\"]\n          },\n          \"uri\": { \n            \"type\": \"string\", \n            \"format\": \"uri\"\n          },\n          \"caption\": { \n            \"type\": \"string\"\n          },\n          \"license\": { \n            \"type\": \"string\"\n          },\n          \"attribution\": { \n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"status\" : {\n      \"type\": \"string\",\n      \"enum\": [\n        \"draft\",\n        \"review\",\n        \"active\",\n        \"inactive\",\n        \"deprecated\"\n      ],\n      \"default\": \"active\"\n    }\n  }\n}","{\n  \"$id\": \"https://spec.vitness.me/schemas/equipment/v1.0.0/equipment.schema.json\",\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"FDS Equipment (v1.0.0)\",\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"required\": [\n    \"schemaVersion\",\n    \"id\",\n    \"canonical\",\n    \"metadata\"\n  ],\n  \"properties\": {\n    \"schemaVersion\": { \n      \"type\": \"string\", \n      \"pattern\": \"^[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\"\n    },\n    \"id\": { \n      \"type\": \"string\" \n    },\n    \"canonical\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"name\",\n        \"slug\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"slug\": {\n          \"type\": \"string\",\n          \"pattern\": \"^[a-z0-9-]{2,}$\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"abbreviation\": {\n          \"type\": \"string\"\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\",\n            \"minLength\": 1\n          },\n          \"uniqueItems\": true\n        },\n        \"localized\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"lang\",\n              \"name\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"lang\": {\n                \"type\": \"string\"\n              },\n              \"name\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"description\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"aliases\": {\n                \"type\": \"array\",\n                \"items\": {\n                  \"type\": \"string\",\n                  \"minLength\": 1\n                },\n                \"uniqueItems\": true\n              }\n            }\n          }\n        }\n      }\n    },\n    \"classification\": {\n      \"type\": \"object\",\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"media\": { \n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/$defs/media\" \n    },\n    \"attributes\": { \n      \"type\": \"object\", \n      \"additionalProperties\": true\n    },\n    \"extensions\": { \n      \"type\": \"object\", \n      \"additionalProperties\": true\n    },\n    \"metadata\": {\n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/properties/metadata\"\n    }\n  }\n}","{\n  \"$id\": \"https://spec.vitness.me/schemas/muscle/v1.0.0/muscle.schema.json\",\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"FDS Muscle (v1.0.0)\",\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"required\": [\n    \"schemaVersion\",\n    \"id\",\n    \"canonical\",\n    \"classification\",\n    \"metadata\"\n  ],\n  \"properties\": {\n    \"schemaVersion\": { \n      \"type\": \"string\", \n      \"pattern\": \"^[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\"\n    },\n    \"id\": { \n      \"type\": \"string\" \n    },\n    \"canonical\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"name\",\n        \"slug\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"name\": { \n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"slug\": { \n          \"type\": \"string\", \n          \"pattern\": \"^[a-z0-9-]{2,}$\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\",\n            \"minLength\": 1\n          },\n          \"uniqueItems\": true\n        },\n        \"localized\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"lang\",\n              \"name\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"lang\": {\n                \"type\": \"string\"\n              },\n              \"name\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"description\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"aliases\": {\n                \"type\": \"array\",\n                \"items\": {\n                  \"type\": \"string\",\n                  \"minLength\": 1\n                },\n                \"uniqueItems\": true\n              }\n            }\n          }\n        }\n      }\n    },\n    \"classification\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"categoryId\",\n        \"region\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"categoryId\": { \n          \"type\": \"string\" \n        },\n        \"region\": {\n          \"$ref\": \"#/$defs/regionGroup\"\n        },\n        \"laterality\": {\n          \"$ref\": \"#/$defs/laterality\"\n        },\n        \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"media\": { \n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/$defs/media\"\n    },\n    \"attributes\": { \n      \"type\": \"object\", \n      \"additionalProperties\": true\n    },\n    \"extensions\": { \n      \"type\": \"object\", \n      \"additionalProperties\": true\n    },\n    \"heatmap\": {\n      \"type\": \"object\",\n      \"required\": [\"atlasId\", \"regions\"],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"atlasId\": { \"type\": \"string\" },\n        \"regions\": {\n          \"type\": \"array\",\n          \"minItems\": 1,\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\"areaId\"],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"areaId\": { \"type\": \"string\" },\n              \"weight\": { \"type\": \"number\", \"minimum\": 0, \"maximum\": 1, \"default\": 1 }\n            }\n          }\n        }\n      }\n    },\n    \"metadata\": {\n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/properties/metadata\"\n    }\n  },\n  \"$defs\": {\n    \"regionGroup\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"upper-front\",\n        \"upper-back\",\n        \"lower-front\",\n        \"lower-back\",\n        \"core\",\n        \"full-body\",\n        \"n/a\"\n      ]\n    },\n    \"laterality\": {\n      \"type\": \"string\",\n      \"enum\": [\n        \"left\",\n        \"right\",\n        \"bilateral\",\n        \"unilateral\",\n        \"n/a\"\n      ]\n    }\n  }\n}\n","{\n  \"$id\": \"https://spec.vitness.me/schemas/muscle/muscle-category/v1.0.0/muscle-category.schema.json\",\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"FDS Muscle Category (v1.0.0)\",\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"required\": [\n    \"schemaVersion\",\n    \"id\",\n    \"canonical\",\n    \"metadata\"\n  ],\n  \"properties\": {\n    \"schemaVersion\": {\n      \"type\": \"string\",\n      \"pattern\": \"^[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\"\n    },\n    \"id\": {\n      \"type\": \"string\"\n    },\n    \"canonical\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"name\",\n        \"slug\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"slug\": {\n          \"type\": \"string\",\n          \"pattern\": \"^[a-z0-9-]{2,}$\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\",\n            \"minLength\": 1\n          },\n          \"uniqueItems\": true\n        },\n        \"localized\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"lang\",\n              \"name\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"lang\": {\n                \"type\": \"string\"\n              },\n              \"name\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"description\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"aliases\": {\n                \"type\": \"array\",\n                \"items\": {\n                  \"type\": \"string\",\n                  \"minLength\": 1\n                },\n                \"uniqueItems\": true\n              }\n            }\n          }\n        }\n      }\n    },\n    \"classification\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"properties\": {\n        \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"media\": {\n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/$defs/media\"\n    },\n    \"attributes\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true\n    },\n    \"extensions\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true\n    },\n    \"metadata\": {\n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/properties/metadata\"\n    }\n  }\n}","{\n  \"$id\": \"https://spec.vitness.me/schemas/atlas/v1.0.0/body-atlas.schema.json\",\n  \"$schema\": \"https://json-schema.org/draft/2020-12/schema\",\n  \"title\": \"FDS Body Atlas (v1.0.0)\",\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"required\": [\n    \"schemaVersion\",\n    \"id\",\n    \"canonical\",\n    \"views\",\n    \"areas\",\n    \"metadata\"\n  ],\n  \"properties\": {\n    \"schemaVersion\": { \"type\": \"string\", \"pattern\": \"^[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\" },\n    \"id\": { \"type\": \"string\" },\n    \"canonical\": {\n      \"type\": \"object\",\n      \"required\": [\n        \"name\",\n        \"slug\"\n      ],\n      \"additionalProperties\": false,\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"slug\": {\n          \"type\": \"string\",\n          \"pattern\": \"^[a-z0-9-]{2,}$\"\n        },\n        \"description\": {\n          \"type\": \"string\",\n          \"minLength\": 1\n        },\n        \"aliases\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"string\",\n            \"minLength\": 1\n          },\n          \"uniqueItems\": true\n        },\n        \"localized\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"required\": [\n              \"lang\",\n              \"name\"\n            ],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"lang\": {\n                \"type\": \"string\"\n              },\n              \"name\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"description\": {\n                \"type\": \"string\",\n                \"minLength\": 1\n              },\n              \"aliases\": {\n                \"type\": \"array\",\n                \"items\": {\n                  \"type\": \"string\",\n                  \"minLength\": 1\n                },\n                \"uniqueItems\": true\n              }\n            }\n          }\n        }\n      }\n    },\n    \"views\": {\n      \"type\": \"array\",\n      \"minItems\": 1,\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\"id\", \"kind\", \"asset\"],\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"id\": { \"type\": \"string\" },\n          \"kind\": {\n            \"type\": \"string\",\n            \"enum\": [\n              \"anterior\",\n              \"posterior\",\n              \"left-lateral\",\n              \"right-lateral\",\n              \"superior\",\n              \"inferior\"\n            ]\n          },\n          \"asset\": {\n            \"type\": \"object\",\n            \"required\": [\"type\", \"uri\"],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"type\": { \"type\": \"string\", \"enum\": [\"svg\", \"image\", \"3d\"] },\n              \"uri\": { \"type\": \"string\", \"format\": \"uri\" }\n            }\n          }\n        }\n      }\n    },\n    \"areas\": {\n      \"type\": \"array\",\n      \"minItems\": 1,\n      \"items\": {\n        \"type\": \"object\",\n        \"required\": [\"id\", \"canonical\", \"bindings\"],\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"id\": { \"type\": \"string\" },\n          \"canonical\": {\n            \"type\": \"object\",\n            \"required\": [\"name\", \"slug\"],\n            \"additionalProperties\": false,\n            \"properties\": {\n              \"name\": { \"type\": \"string\" },\n              \"slug\": { \"type\": \"string\", \"pattern\": \"^[a-z0-9-.]+$\" }\n            }\n          },\n          \"bindings\": {\n            \"type\": \"array\",\n            \"minItems\": 1,\n            \"items\": {\n              \"type\": \"object\",\n              \"required\": [\"viewId\", \"selector\"],\n              \"additionalProperties\": false,\n              \"properties\": {\n                \"viewId\": { \"type\": \"string\" },\n                \"selector\": { \"type\": \"string\" }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"attributes\": { \"type\": \"object\", \"additionalProperties\": true },\n    \"extensions\": { \"type\": \"object\", \"additionalProperties\": true },\n    \"metadata\": {\n      \"$ref\": \"https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json#/properties/metadata\"\n    }\n  }\n}\n\n","/**\n * Bundled FDS schemas v1.0.0\n * \n * These schemas are bundled with the transformer to avoid network dependency\n * and ensure consistent validation behavior.\n */\n\nimport exerciseSchema from './exercise.schema.json' assert { type: 'json' };\nimport equipmentSchema from './equipment.schema.json' assert { type: 'json' };\nimport muscleSchema from './muscle.schema.json' assert { type: 'json' };\nimport muscleCategorySchema from './muscle-category.schema.json' assert { type: 'json' };\nimport bodyAtlasSchema from './body-atlas.schema.json' assert { type: 'json' };\n\nexport default {\n  exercise: exerciseSchema,\n  equipment: equipmentSchema,\n  muscle: muscleSchema,\n  'muscle-category': muscleCategorySchema,\n  'body-atlas': bodyAtlasSchema,\n};\n\nexport {\n  exerciseSchema,\n  equipmentSchema,\n  muscleSchema,\n  muscleCategorySchema,\n  bodyAtlasSchema,\n};\n","#!/usr/bin/env node\n\n/**\n * FDS Transformer CLI\n *\n * Transform source data to FDS format with optional AI enrichment.\n * Supports tiered enrichment with checkpoint/resume, cost estimation,\n * and progress tracking.\n */\n\nimport { Command } from 'commander';\nimport * as p from '@clack/prompts';\nimport pc from 'picocolors';\nimport { Transformer, type BatchTransformOptions } from '../core/transformer.js';\nimport { BatchProcessor } from '../core/batch-processor.js';\nimport { ConfigLoader } from '../config/config-loader.js';\nimport { SchemaManager } from '../schemas/schema-manager.js';\nimport { CheckpointManager, CHECKPOINT_FILENAME } from '../ai/checkpoint-manager.js';\nimport type { CostEstimate, EnrichmentProgress, TierName } from '../core/types.js';\n\nconst program = new Command();\n\n/**\n * Log levels for controlling output verbosity\n */\ntype LogLevel = 'error' | 'warn' | 'info' | 'debug';\n\nconst LOG_LEVELS: Record<LogLevel, number> = {\n  error: 0,\n  warn: 1,\n  info: 2,\n  debug: 3,\n};\n\nlet currentLogLevel: LogLevel = 'info';\n\n/**\n * Log a message at the specified level\n */\nfunction log(level: LogLevel, message: string): void {\n  if (LOG_LEVELS[level] <= LOG_LEVELS[currentLogLevel]) {\n    switch (level) {\n      case 'error':\n        p.log.error(message);\n        break;\n      case 'warn':\n        p.log.warn(message);\n        break;\n      case 'info':\n        p.log.info(message);\n        break;\n      case 'debug':\n        p.log.message(pc.dim(`[debug] ${message}`));\n        break;\n    }\n  }\n}\n\n/**\n * Format number with thousand separators\n */\nfunction formatNumber(n: number): string {\n  return n.toLocaleString('en-US');\n}\n\n/**\n * Format cost as USD\n */\nfunction formatCost(cost: number): string {\n  return `$${cost.toFixed(2)}`;\n}\n\n/**\n * Display cost estimation table\n */\nfunction displayCostEstimate(estimate: CostEstimate, exerciseCount: number): void {\n  const { tiers, total, estimatedTime, disclaimer } = estimate;\n\n  // Count fields per tier from config (simplified count)\n  const simpleFields = 6;\n  const mediumFields = 5;\n  const complexFields = 7;\n\n  console.log('');\n  console.log(\n    pc.cyan(\n      '┌───────────────────────────────────────────────────────────────────────┐'\n    )\n  );\n  console.log(\n    pc.cyan(\n      '│                         Cost Estimation                               │'\n    )\n  );\n  console.log(\n    pc.cyan(\n      '├───────────────────────────────────────────────────────────────────────┤'\n    )\n  );\n  console.log(\n    pc.cyan('│') +\n      ` Input: ${formatNumber(exerciseCount)} exercises`.padEnd(71) +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan('│') +\n      ` Enrichment fields: 18 (${simpleFields} simple, ${mediumFields} medium, ${complexFields} complex)`.padEnd(\n        71\n      ) +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan('│') +\n      ''.padEnd(71) +\n      pc.cyan('│')\n  );\n\n  // Table header\n  console.log(\n    pc.cyan('│') +\n      ' Tier       │ Model              │ Batch │ Calls  │ Tokens   │ Cost   ' +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan('│') +\n      ' ───────────┼────────────────────┼───────┼────────┼──────────┼────────' +\n      pc.cyan('│')\n  );\n\n  // Tier rows\n  for (const tierName of ['simple', 'medium', 'complex'] as TierName[]) {\n    const tier = tiers[tierName];\n    const modelShort = tier.model.replace('anthropic/', '');\n    const tokens = `~${(tier.inputTokens / 1000).toFixed(0)}K`;\n    const row =\n      ` ${tierName.charAt(0).toUpperCase() + tierName.slice(1).padEnd(9)} │ ${modelShort.padEnd(18)} │ ${String(tier.batchSize).padStart(5)} │ ${formatNumber(tier.apiCalls).padStart(6)} │ ${tokens.padStart(8)} │ ${formatCost(tier.cost).padStart(6)} `;\n    console.log(pc.cyan('│') + row + pc.cyan('│'));\n  }\n\n  // Total row\n  console.log(\n    pc.cyan('│') +\n      ' ───────────┴────────────────────┴───────┴────────┴──────────┴────────' +\n      pc.cyan('│')\n  );\n  const totalTokens = `~${((total.inputTokens + total.outputTokens) / 1000000).toFixed(2)}M`;\n  const totalRow = ` TOTAL                                   │ ${formatNumber(total.apiCalls).padStart(6)} │ ${totalTokens.padStart(8)} │ ${formatCost(total.cost).padStart(6)} `;\n  console.log(pc.cyan('│') + pc.bold(totalRow) + pc.cyan('│'));\n  console.log(\n    pc.cyan('│') +\n      ''.padEnd(71) +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan('│') +\n      ` Estimated time: ${estimatedTime.formatted} (at 50 requests/min)`.padEnd(71) +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan('│') +\n      ''.padEnd(71) +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan('│') +\n      pc.dim(` * ${disclaimer}`).padEnd(71) +\n      pc.cyan('│')\n  );\n  console.log(\n    pc.cyan(\n      '└───────────────────────────────────────────────────────────────────────┘'\n    )\n  );\n  console.log('');\n}\n\n/**\n * Create a progress callback for enrichment display\n */\nfunction createProgressCallback(): (progress: EnrichmentProgress) => void {\n  let lastUpdate = 0;\n  const updateInterval = 500; // ms between updates\n\n  return (progress: EnrichmentProgress) => {\n    const now = Date.now();\n    if (now - lastUpdate < updateInterval) {\n      return;\n    }\n    lastUpdate = now;\n\n    const { exercise, tier, overall } = progress;\n\n    // Clear previous lines and write new progress\n    process.stderr.write('\\r\\x1b[K'); // Clear line\n\n    const tierStatus = getTierStatusDisplay(tier.status);\n    const progressBar = createProgressBar(overall.percentage, 20);\n\n    const line = `  ${pc.cyan('●')} Processing ${exercise.current}/${exercise.total}: ${pc.bold(exercise.name)} ${tierStatus} ${progressBar} ${overall.percentage.toFixed(1)}%`;\n\n    process.stderr.write(line);\n  };\n}\n\n/**\n * Get display string for tier status\n */\nfunction getTierStatusDisplay(\n  status: EnrichmentProgress['tier']['status']\n): string {\n  switch (status) {\n    case 'processing':\n      return pc.yellow('●');\n    case 'complete':\n      return pc.green('✓');\n    case 'failed':\n      return pc.red('✗');\n    case 'skipped':\n      return pc.dim('○');\n    case 'pending':\n    default:\n      return pc.dim('○');\n  }\n}\n\n/**\n * Create a simple progress bar\n */\nfunction createProgressBar(percentage: number, width: number): string {\n  const filled = Math.round((percentage / 100) * width);\n  const empty = width - filled;\n  return pc.cyan('│') + pc.green('█'.repeat(filled)) + pc.dim('░'.repeat(empty)) + pc.cyan('│');\n}\n\nprogram\n  .name('fds-transformer')\n  .description('Transform source data to FDS (Fitness Data Standard) format')\n  .version('0.1.0');\n\n// Transform command\nprogram\n  .command('transform')\n  .description('Transform source data to FDS format')\n  .option('-i, --input <path>', 'Input file path (JSON)')\n  .option('-c, --config <path>', 'Mapping configuration file')\n  .option('-o, --output <path>', 'Output directory')\n  .option('--no-ai', 'Disable AI enrichment (legacy)')\n  .option('--api-key <key>', 'API key for enrichment provider')\n  .option('--model <model>', 'AI model to use (legacy single-model mode)')\n  .option('--version <version>', 'Target FDS schema version', '1.0.0')\n  .option('--dry-run', 'Preview transformation without writing files')\n  // New tiered enrichment options\n  .option('--estimate-cost', 'Show cost estimate without running enrichment')\n  .option('--resume', 'Resume from checkpoint')\n  .option('--tier <tier>', 'Run only specific tier (simple|medium|complex)')\n  .option('--clear-checkpoint', 'Clear existing checkpoint before running')\n  .option('--no-checkpoint', 'Disable checkpoint saving')\n  .option('--no-enrichment', 'Skip AI enrichment entirely')\n  .option(\n    '--log-level <level>',\n    'Log verbosity (error|warn|info|debug)',\n    'info'\n  )\n  .action(async (options) => {\n    // Set log level\n    if (\n      options.logLevel &&\n      ['error', 'warn', 'info', 'debug'].includes(options.logLevel)\n    ) {\n      currentLogLevel = options.logLevel as LogLevel;\n    }\n\n    p.intro(pc.bgCyan(pc.black(' FDS Transformer ')));\n\n    try {\n      // Load input\n      if (!options.input) {\n        p.cancel('Input file is required. Use --input <path>');\n        process.exit(1);\n      }\n\n      const fs = await import('fs/promises');\n      const inputContent = await fs.readFile(options.input, 'utf-8');\n      const inputData = JSON.parse(inputContent);\n      const items = Array.isArray(inputData) ? inputData : [inputData];\n\n      log('info', `Loaded ${formatNumber(items.length)} items from ${options.input}`);\n\n      // Load config\n      let config: import('../core/types.js').MappingConfig;\n      if (options.config) {\n        config = await ConfigLoader.load(options.config);\n        log('info', `Loaded config from ${options.config}`);\n\n        // Check if tiered enrichment is configured\n        if (config.enrichment?.tiers && config.enrichment?.fields) {\n          log('info', 'Tiered enrichment configuration detected');\n        }\n      } else {\n        log('warn', 'No config file specified. Using default mappings.');\n        config = {\n          version: '1.0.0',\n          targetSchema: { version: options.version },\n          mappings: {},\n        };\n      }\n\n      // Apply CLI overrides for enrichment config\n      if (options.apiKey) {\n        config.enrichment = { ...config.enrichment, apiKey: options.apiKey };\n      }\n      if (options.model) {\n        config.enrichment = { ...config.enrichment, model: options.model };\n      }\n      if (options.noAi || options.noEnrichment) {\n        config.enrichment = { ...config.enrichment, enabled: false };\n      }\n\n      // Disable checkpoint if requested\n      if (options.noCheckpoint && config.enrichment) {\n        config.enrichment = {\n          ...config.enrichment,\n          checkpoint: { enabled: false, saveInterval: 0 },\n        };\n      }\n\n      // Create transformer\n      const transformer = new Transformer({ config });\n      await transformer.init();\n\n      // Handle --clear-checkpoint\n      const outputDir = options.output || config.output?.directory || process.cwd();\n      if (options.clearCheckpoint) {\n        const checkpointPath = `${outputDir}/${CHECKPOINT_FILENAME}`;\n        try {\n          await fs.unlink(checkpointPath);\n          log('info', 'Cleared existing checkpoint');\n        } catch {\n          // File may not exist, which is fine\n          log('debug', 'No checkpoint file to clear');\n        }\n      }\n\n      // Handle --estimate-cost\n      if (options.estimateCost) {\n        const estimate = transformer.estimateCost(items.length);\n        if (estimate) {\n          displayCostEstimate(estimate, items.length);\n          p.outro(pc.cyan('Cost estimation complete'));\n        } else {\n          p.log.warn(\n            'Cost estimation requires tiered enrichment configuration in mapping config.'\n          );\n          p.log.info(\n            'Add \"enrichment.tiers\" and \"enrichment.fields\" to your config file.'\n          );\n        }\n        return;\n      }\n\n      // Handle --resume - check for existing checkpoint\n      if (options.resume) {\n        const checkpointManager = new CheckpointManager(outputDir);\n        if (checkpointManager.exists()) {\n          const checkpoint = checkpointManager.load();\n          if (checkpoint) {\n            log(\n              'info',\n              `Found checkpoint: ${formatNumber(checkpoint.completedExercises)}/${formatNumber(checkpoint.totalExercises)} exercises completed`\n            );\n            log('info', `Resuming from exercise ${checkpoint.completedExercises + 1}...`);\n          }\n        } else {\n          log('warn', 'No checkpoint found. Starting fresh.');\n        }\n      }\n\n      // Validate --tier option\n      const validTiers: TierName[] = ['simple', 'medium', 'complex'];\n      if (options.tier && !validTiers.includes(options.tier)) {\n        p.cancel(\n          `Invalid tier: ${options.tier}. Must be one of: ${validTiers.join(', ')}`\n        );\n        process.exit(1);\n      }\n\n      // Check if we should use batch processing (tiered enrichment)\n      const useBatchMode = transformer.isTieredEnrichmentEnabled();\n\n      if (useBatchMode) {\n        log('debug', 'Using batch mode with tiered enrichment');\n\n        // Prepare batch options\n        const batchOptions: BatchTransformOptions = {\n          resume: options.resume,\n          tierFilter: options.tier as TierName | undefined,\n          outputDirectory: outputDir,\n          skipEnrichment: options.noEnrichment || options.noAi,\n          onProgress: createProgressCallback(),\n        };\n\n        const spinner = p.spinner();\n        spinner.start('Processing with tiered enrichment...');\n\n        const result = await transformer.transformAllBatch(items, batchOptions);\n\n        // Clear the progress line\n        process.stderr.write('\\r\\x1b[K');\n        spinner.stop('Transformation complete');\n\n        // Summary\n        log(\n          'info',\n          `Processed ${formatNumber(result.stats.total)} items in ${result.stats.durationMs}ms`\n        );\n        log('info', `  Successful: ${formatNumber(result.stats.success)}`);\n        log('info', `  Enriched: ${formatNumber(result.stats.enriched)}`);\n        log('info', `  API Calls: ${formatNumber(result.stats.apiCalls)}`);\n        if (result.stats.failed > 0) {\n          log('warn', `  Failed: ${formatNumber(result.stats.failed)}`);\n        }\n\n        // Output\n        if (!options.dryRun) {\n          await writeOutput(fs, result.results, config, outputDir, options);\n        }\n      } else {\n        log('debug', 'Using legacy single-item processing');\n\n        // Process with progress (legacy mode)\n        const spinner = p.spinner();\n        spinner.start('Transforming data...');\n\n        const batchProcessor = new BatchProcessor(transformer, {\n          onProgress: (progress) => {\n            spinner.message(\n              `Transforming... ${progress.processed}/${progress.total} (${progress.percentage}%)`\n            );\n          },\n        });\n\n        const result = await batchProcessor.process(items);\n\n        spinner.stop('Transformation complete');\n\n        // Summary\n        log(\n          'info',\n          `Processed ${formatNumber(result.summary.total)} items in ${result.summary.duration}ms`\n        );\n        log('info', `  Successful: ${formatNumber(result.summary.successful)}`);\n        if (result.summary.failed > 0) {\n          log('warn', `  Failed: ${formatNumber(result.summary.failed)}`);\n        }\n\n        // Output\n        if (!options.dryRun) {\n          await writeOutput(fs, result.results, config, outputDir, options);\n        }\n      }\n\n      p.outro(pc.green('Done!'));\n    } catch (error) {\n      p.cancel(\n        `Error: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n      process.exit(1);\n    }\n  });\n\n/**\n * Write output files\n */\nasync function writeOutput(\n  fs: typeof import('fs/promises'),\n  results: Array<{ success?: boolean; data?: unknown }>,\n  config: import('../core/types.js').MappingConfig,\n  outputDir: string,\n  options: { output?: string }\n): Promise<void> {\n  const spinner = p.spinner();\n  const dir = options.output || outputDir;\n\n  if (dir) {\n    spinner.start('Writing output files...');\n    await fs.mkdir(dir, { recursive: true });\n\n    // Check if we should write to a single file\n    const singleFile = config.output?.singleFile;\n    const singleFileName = config.output?.singleFileName || 'output.json';\n    const prettyPrint = config.output?.pretty !== false;\n\n    const successfulResults = results.filter(\n      (item) => item.success && item.data\n    );\n\n    if (singleFile) {\n      // Write all successful results to a single file\n      const successfulData = successfulResults.map((item) => item.data);\n\n      const outputPath = `${dir}/${singleFileName}`;\n      const content = prettyPrint\n        ? JSON.stringify(successfulData, null, 2)\n        : JSON.stringify(successfulData);\n      await fs.writeFile(outputPath, content);\n\n      spinner.stop(\n        `Wrote ${formatNumber(successfulResults.length)} exercises to ${outputPath}`\n      );\n    } else {\n      // Write individual files\n      for (const item of successfulResults) {\n        if (item.data) {\n          const slug =\n            (item.data as Record<string, unknown>).canonical &&\n            ((item.data as Record<string, unknown>).canonical as Record<string, unknown>)?.slug\n              ? String(\n                  ((item.data as Record<string, unknown>).canonical as Record<string, unknown>)\n                    .slug\n                )\n              : 'unknown';\n          const outputPath = `${dir}/${slug}.json`;\n          const content = prettyPrint\n            ? JSON.stringify(item.data, null, 2)\n            : JSON.stringify(item.data);\n          await fs.writeFile(outputPath, content);\n        }\n      }\n\n      spinner.stop(`Wrote ${formatNumber(successfulResults.length)} files to ${dir}`);\n    }\n  } else {\n    // No output directory - print summary to stdout\n    log(\n      'info',\n      'No output directory specified. Use --output <path> or set output.directory in config.'\n    );\n  }\n}\n\n// Validate command\nprogram\n  .command('validate')\n  .description('Validate FDS data against schema')\n  .option('-i, --input <path>', 'Input file to validate')\n  .option(\n    '-e, --entity <type>',\n    'Entity type (exercise, equipment, muscle)',\n    'exercise'\n  )\n  .option('--version <version>', 'FDS schema version', '1.0.0')\n  .action(async (options) => {\n    p.intro(pc.bgCyan(pc.black(' FDS Validator ')));\n\n    try {\n      if (!options.input) {\n        p.cancel('Input file is required. Use --input <path>');\n        process.exit(1);\n      }\n\n      const fs = await import('fs/promises');\n      const content = await fs.readFile(options.input, 'utf-8');\n      const data = JSON.parse(content);\n\n      const schemaManager = new SchemaManager();\n      await schemaManager.loadVersion(options.version);\n\n      const result = await schemaManager.validate(\n        data,\n        options.entity,\n        options.version\n      );\n\n      if (result.valid) {\n        p.log.success('Validation passed!');\n      } else {\n        p.log.error('Validation failed:');\n        for (const error of result.errors) {\n          p.log.warn(`  ${error.field}: ${error.message}`);\n        }\n      }\n\n      p.outro(result.valid ? pc.green('Valid!') : pc.red('Invalid'));\n      process.exit(result.valid ? 0 : 1);\n    } catch (error) {\n      p.cancel(\n        `Error: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n      process.exit(1);\n    }\n  });\n\n// Init command (wizard)\nprogram\n  .command('init')\n  .description('Create a new mapping configuration interactively')\n  .option('-s, --sample <path>', 'Sample source file to analyze')\n  .option('-o, --output <path>', 'Output path for config', './mapping.json')\n  .action(async (options) => {\n    p.intro(pc.bgCyan(pc.black(' FDS Transformer Setup ')));\n\n    // TODO(init-wizard): Implement interactive mapping configuration wizard\n    // Features to implement:\n    // 1. Analyze sample source file (--sample option) to detect field structure\n    // 2. Present detected fields and suggest mappings to FDS schema\n    // 3. Allow user to select which fields to map\n    // 4. Configure registry sources (muscles, equipment, etc.)\n    // 5. Configure AI enrichment tiers\n    // 6. Generate mapping.json output file\n    // See: docs/tools/transformer/cli-reference.md - \"Note: The interactive wizard is under development\"\n    \n    p.log.info('Interactive setup wizard is under development.');\n    \n    if (options.sample) {\n      p.log.info(`Sample file provided: ${options.sample}`);\n      p.log.info('Future version will analyze this file to suggest mappings.');\n    }\n    \n    p.log.info('');\n    p.log.info('For now, create your mapping.json manually using these resources:');\n    p.log.message('  - Documentation: https://spec.vitness.me/docs/tools/transformer/configuration');\n    p.log.message(`  - Output location: ${options.output}`);\n\n    p.outro('See documentation for manual configuration');\n  });\n\n// Schemas command\nprogram\n  .command('schemas')\n  .description('Manage FDS schemas')\n  .argument('<action>', 'Action: list, update')\n  .action(async (action) => {\n    p.intro(pc.bgCyan(pc.black(' FDS Schemas ')));\n\n    const schemaManager = new SchemaManager();\n\n    switch (action) {\n      case 'list':\n        const versions = await schemaManager.listVersions();\n        p.log.info('Available schema versions:');\n        for (const v of versions) {\n          p.log.message(`  ${v.version} ${v.bundled ? '(bundled)' : ''}`);\n        }\n        break;\n\n      case 'update':\n        p.log.info('Updating schema cache...');\n        await schemaManager.updateCache();\n        p.log.success('Cache updated');\n        break;\n\n      default:\n        p.log.error(`Unknown action: ${action}`);\n    }\n\n    p.outro('Done');\n  });\n\n// Interactive mode (no command)\nprogram.action(async () => {\n  p.intro(pc.bgCyan(pc.black(' FDS Transformer ')));\n\n  const action = await p.select({\n    message: 'What would you like to do?',\n    options: [\n      { value: 'transform', label: 'Transform data to FDS format' },\n      { value: 'validate', label: 'Validate existing FDS data' },\n      { value: 'init', label: 'Create new mapping configuration' },\n      { value: 'schemas', label: 'Manage FDS schemas' },\n    ],\n  });\n\n  if (p.isCancel(action)) {\n    p.cancel('Cancelled');\n    process.exit(0);\n  }\n\n  // Re-run with the selected command\n  const args = [process.argv[0], process.argv[1], action as string];\n  process.argv = args;\n  await program.parseAsync(args);\n});\n\nprogram.parse();\n","/**\n * Main Transformer class for FDS schema transformation\n *\n * Supports two modes of operation:\n * 1. Single-item transformation via transform() - Uses legacy enrichment\n * 2. Batch transformation via transformAllBatch() - Uses tiered enrichment\n */\n\nimport type {\n  MappingConfig,\n  TransformOptions,\n  TransformResult,\n  TransformContext,\n  ProgressCallback,\n  CostEstimate,\n} from './types.js';\nimport { MappingEngine } from './mapping-engine.js';\nimport { RegistryManager } from '../registries/registry-manager.js';\nimport { SchemaManager } from '../schemas/schema-manager.js';\nimport { EnrichmentEngine, type ExerciseInput, type BatchEnrichmentOptions, type BatchEnrichmentResult } from '../ai/enrichment-engine.js';\nimport { ConfigLoader } from '../config/config-loader.js';\n\nexport interface TransformerOptions extends TransformOptions {\n  config?: MappingConfig | string;\n}\n\n/**\n * Options for batch transformation with tiered enrichment\n */\nexport interface BatchTransformOptions {\n  /** Resume from checkpoint if available */\n  resume?: boolean;\n  /** Run only specific tier (simple|medium|complex) */\n  tierFilter?: 'simple' | 'medium' | 'complex';\n  /** Progress callback for tracking */\n  onProgress?: ProgressCallback;\n  /** Output directory for checkpoints and results */\n  outputDirectory?: string;\n  /** Skip AI enrichment entirely */\n  skipEnrichment?: boolean;\n}\n\n/**\n * Result of batch transformation\n */\nexport interface BatchTransformResult {\n  /** Successfully transformed exercises */\n  results: TransformResult[];\n  /** Statistics about the transformation */\n  stats: {\n    total: number;\n    success: number;\n    failed: number;\n    enriched: number;\n    apiCalls: number;\n    tokensUsed: number;\n    durationMs: number;\n  };\n  /** Errors encountered during transformation */\n  errors: Array<{ index: number; exerciseId?: string; error: string }>;\n}\n\nexport class Transformer {\n  private config: MappingConfig;\n  private mappingEngine: MappingEngine;\n  private registryManager: RegistryManager;\n  private schemaManager: SchemaManager;\n  private enrichmentEngine: EnrichmentEngine | null = null;\n  private initialized = false;\n\n  constructor(options: TransformerOptions = {}) {\n    // Config will be loaded during init\n    this.config = options.config as MappingConfig || {} as MappingConfig;\n    this.mappingEngine = new MappingEngine();\n    this.registryManager = new RegistryManager();\n    this.schemaManager = new SchemaManager();\n    // EnrichmentEngine will be initialized in init() after config is loaded\n  }\n\n  /**\n   * Get the enrichment engine (for testing or direct access)\n   */\n  getEnrichmentEngine(): EnrichmentEngine | null {\n    return this.enrichmentEngine;\n  }\n\n  /**\n   * Get the schema manager (for accessing schema $defs)\n   */\n  getSchemaManager(): SchemaManager {\n    return this.schemaManager;\n  }\n\n  /**\n   * Check if tiered enrichment is available\n   */\n  isTieredEnrichmentEnabled(): boolean {\n    return this.enrichmentEngine?.isTieredEnabled() ?? false;\n  }\n\n  /**\n   * Get cost estimate for batch enrichment\n   */\n  estimateCost(exerciseCount: number): CostEstimate | null {\n    if (!this.enrichmentEngine) {\n      return null;\n    }\n    return this.enrichmentEngine.estimateCost(exerciseCount);\n  }\n\n  /**\n   * Initialize the transformer (load config, registries, schemas)\n   */\n  async init(): Promise<void> {\n    if (this.initialized) return;\n\n    // Load config if string path provided\n    if (typeof this.config === 'string') {\n      this.config = await ConfigLoader.load(this.config);\n    }\n\n    // Initialize enrichment engine with config settings\n    if (this.config.enrichment?.enabled !== false) {\n      this.enrichmentEngine = new EnrichmentEngine(this.config.enrichment);\n    }\n\n    // Load registries\n    if (this.config.registries) {\n      await this.registryManager.load(this.config.registries);\n    }\n\n    // Load target schema\n    if (this.config.targetSchema) {\n      await this.schemaManager.loadVersion(this.config.targetSchema.version);\n    }\n\n    this.initialized = true;\n  }\n\n  /**\n   * Transform a single source item to FDS format\n   */\n  async transform(source: Record<string, unknown>): Promise<TransformResult> {\n    await this.init();\n\n    const context: TransformContext = {\n      source,\n      target: {},\n      field: '',\n      registries: {\n        muscles: this.registryManager.getMuscles(),\n        equipment: this.registryManager.getEquipment(),\n        muscleCategories: this.registryManager.getMuscleCategories(),\n      },\n      config: this.config,\n    };\n\n    try {\n      // Apply mappings\n      const mapped = await this.mappingEngine.apply(\n        source,\n        this.config.mappings,\n        context\n      );\n\n      // Apply AI enrichment if enabled\n      let enriched: string[] = [];\n      if (this.enrichmentEngine && this.config.enrichment?.enabled !== false) {\n        const enrichmentResult = await this.enrichmentEngine.enrich(\n          mapped,\n          this.config.mappings,\n          context\n        );\n        this.deepMerge(mapped, enrichmentResult.data || {});\n        enriched = Object.keys(enrichmentResult.data || {});\n      }\n\n      // Validate output\n      let validation = { valid: true, errors: [] as any[] };\n      if (this.config.validation?.enabled !== false) {\n        validation = await this.schemaManager.validate(\n          mapped,\n          this.config.targetSchema?.entity || 'exercise'\n        );\n      }\n\n      return {\n        success: validation.valid || !this.config.validation?.strict,\n        data: mapped as any,\n        errors: validation.errors,\n        enriched,\n        __validation: validation,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        errors: [\n          {\n            field: '_transform',\n            message: error instanceof Error ? error.message : 'Unknown error',\n          },\n        ],\n      };\n    }\n  }\n\n  /**\n   * Transform multiple items with streaming support\n   */\n  async *transformStream(\n    source: AsyncIterable<Record<string, unknown>> | Iterable<Record<string, unknown>>\n  ): AsyncGenerator<TransformResult> {\n    await this.init();\n\n    for await (const item of source) {\n      yield await this.transform(item);\n    }\n  }\n\n  /**\n   * Transform all items from an array\n   */\n  async transformAll(\n    sources: Record<string, unknown>[]\n  ): Promise<TransformResult[]> {\n    const results: TransformResult[] = [];\n    for await (const result of this.transformStream(sources)) {\n      results.push(result);\n    }\n    return results;\n  }\n\n  /**\n   * Transform all items using batch enrichment with tiered processing\n   *\n   * This method is more efficient than transformAll() for large datasets as it:\n   * 1. Maps all exercises first (without enrichment)\n   * 2. Batches exercises by tier for enrichment (using appropriate models)\n   * 3. Supports checkpoint/resume for long-running operations\n   * 4. Reports progress via callback\n   *\n   * @param sources - Array of source items to transform\n   * @param options - Batch transformation options\n   * @returns Batch transformation result with stats\n   */\n  async transformAllBatch(\n    sources: Record<string, unknown>[],\n    options: BatchTransformOptions = {}\n  ): Promise<BatchTransformResult> {\n    const startTime = Date.now();\n    await this.init();\n\n    const results: TransformResult[] = [];\n    const errors: Array<{ index: number; exerciseId?: string; error: string }> = [];\n    let enrichedCount = 0;\n    let apiCalls = 0;\n    let tokensUsed = 0;\n\n    // Phase 1: Map all exercises (without enrichment)\n    const mappedExercises: Array<{\n      index: number;\n      source: Record<string, unknown>;\n      mapped: Record<string, unknown>;\n      context: TransformContext;\n    }> = [];\n\n    for (let i = 0; i < sources.length; i++) {\n      const source = sources[i];\n      const context: TransformContext = {\n        source,\n        target: {},\n        field: '',\n        registries: {\n          muscles: this.registryManager.getMuscles(),\n          equipment: this.registryManager.getEquipment(),\n          muscleCategories: this.registryManager.getMuscleCategories(),\n        },\n        config: this.config,\n      };\n\n      try {\n        const mapped = await this.mappingEngine.apply(\n          source,\n          this.config.mappings,\n          context\n        );\n        mappedExercises.push({ index: i, source, mapped, context });\n      } catch (error) {\n        errors.push({\n          index: i,\n          error: error instanceof Error ? error.message : 'Mapping failed',\n        });\n        results[i] = {\n          success: false,\n          errors: [\n            {\n              field: '_mapping',\n              message: error instanceof Error ? error.message : 'Mapping failed',\n            },\n          ],\n        };\n      }\n    }\n\n    // Phase 2: Batch enrichment (if tiered enrichment is configured)\n    let enrichmentResults: BatchEnrichmentResult | null = null;\n\n    if (\n      !options.skipEnrichment &&\n      this.enrichmentEngine &&\n      this.config.enrichment?.enabled !== false &&\n      this.enrichmentEngine.isTieredEnabled()\n    ) {\n      // Prepare exercise inputs for batch enrichment\n      const exerciseInputs: ExerciseInput[] = mappedExercises.map(({ mapped, index }) => {\n        const canonical = mapped.canonical as Record<string, unknown> | undefined;\n        const targets = mapped.targets as Record<string, unknown> | undefined;\n        const equipment = mapped.equipment as Record<string, unknown> | undefined;\n\n        return {\n          id: (mapped.exerciseId as string) || `exercise-${index}`,\n          slug: (canonical?.slug as string) || `exercise-${index}`,\n          name: (canonical?.name as string) || `Exercise ${index}`,\n          description: canonical?.description as string | undefined,\n          primaryTargets: (targets?.primary as Array<{ id: string; name: string }>) || undefined,\n          requiredEquipment:\n            (equipment?.required as Array<{ id: string; name: string }>) || undefined,\n        };\n      });\n\n      // Get schema $defs for validation context\n      const schema = this.schemaManager.getSchema(\n        this.config.targetSchema?.entity || 'exercise',\n        this.config.targetSchema?.version || '1.0.0'\n      );\n      const schemaDefs = (schema as Record<string, unknown> | null)?.$defs as\n        | Record<string, unknown>\n        | undefined;\n\n      // Prepare enrichment options\n      const enrichmentOptions: BatchEnrichmentOptions = {\n        resume: options.resume,\n        tierFilter: options.tierFilter,\n        onProgress: options.onProgress,\n        outputDirectory: options.outputDirectory,\n        schemaDefs,\n      };\n\n      // Run batch enrichment\n      enrichmentResults = await this.enrichmentEngine.enrichBatch(\n        exerciseInputs,\n        enrichmentOptions\n      );\n\n      apiCalls = enrichmentResults.apiCalls;\n      tokensUsed = enrichmentResults.tokensUsed;\n    }\n\n    // Phase 3: Merge enrichment results and validate\n    for (const { index, mapped, source } of mappedExercises) {\n      // Skip if already errored in mapping phase\n      if (results[index]) {\n        continue;\n      }\n\n      // Merge enrichment results if available\n      let enriched: string[] = [];\n      if (enrichmentResults) {\n        const exerciseId =\n          (mapped.exerciseId as string) ||\n          ((mapped.canonical as Record<string, unknown> | undefined)?.slug as string) ||\n          `exercise-${index}`;\n\n        const enrichmentData = enrichmentResults.results.get(exerciseId);\n        if (enrichmentData) {\n          this.deepMerge(mapped, enrichmentData);\n          enriched = Object.keys(enrichmentData);\n          enrichedCount++;\n        }\n\n        // Check if this exercise failed enrichment\n        if (enrichmentResults.failedIds.includes(exerciseId)) {\n          const error = enrichmentResults.errors.find((e) => e.exerciseId === exerciseId);\n          errors.push({\n            index,\n            exerciseId,\n            error: error?.error || 'Enrichment failed',\n          });\n        }\n      }\n\n      // Apply legacy single-item enrichment if tiered is not enabled\n      if (\n        !options.skipEnrichment &&\n        this.enrichmentEngine &&\n        this.config.enrichment?.enabled !== false &&\n        !this.enrichmentEngine.isTieredEnabled()\n      ) {\n        try {\n          const context: TransformContext = {\n            source,\n            target: mapped,\n            field: '',\n            registries: {\n              muscles: this.registryManager.getMuscles(),\n              equipment: this.registryManager.getEquipment(),\n              muscleCategories: this.registryManager.getMuscleCategories(),\n            },\n            config: this.config,\n          };\n          const enrichmentResult = await this.enrichmentEngine.enrich(\n            mapped,\n            this.config.mappings,\n            context\n          );\n          if (enrichmentResult.data) {\n            this.deepMerge(mapped, enrichmentResult.data);\n            enriched = Object.keys(enrichmentResult.data);\n            enrichedCount++;\n          }\n        } catch (error) {\n          errors.push({\n            index,\n            error: error instanceof Error ? error.message : 'Enrichment failed',\n          });\n        }\n      }\n\n      // Validate output\n      let validation = { valid: true, errors: [] as any[] };\n      if (this.config.validation?.enabled !== false) {\n        validation = await this.schemaManager.validate(\n          mapped,\n          this.config.targetSchema?.entity || 'exercise'\n        );\n      }\n\n      results[index] = {\n        success: validation.valid || !this.config.validation?.strict,\n        data: mapped as any,\n        errors: validation.errors,\n        enriched,\n        __validation: validation,\n      };\n    }\n\n    // Calculate stats\n    const successCount = results.filter((r) => r?.success).length;\n    const failedCount = sources.length - successCount;\n\n    return {\n      results,\n      stats: {\n        total: sources.length,\n        success: successCount,\n        failed: failedCount,\n        enriched: enrichedCount,\n        apiCalls,\n        tokensUsed,\n        durationMs: Date.now() - startTime,\n      },\n      errors,\n    };\n  }\n\n  /**\n   * Deep merge source object into target\n   */\n  private deepMerge(\n    target: Record<string, unknown>,\n    source: Record<string, unknown>\n  ): void {\n    for (const key of Object.keys(source)) {\n      const sourceValue = source[key];\n      const targetValue = target[key];\n\n      if (\n        sourceValue !== null &&\n        typeof sourceValue === 'object' &&\n        !Array.isArray(sourceValue) &&\n        targetValue !== null &&\n        typeof targetValue === 'object' &&\n        !Array.isArray(targetValue)\n      ) {\n        // Recursively merge objects\n        this.deepMerge(\n          targetValue as Record<string, unknown>,\n          sourceValue as Record<string, unknown>\n        );\n      } else if (sourceValue !== undefined) {\n        // Overwrite with source value (including arrays)\n        target[key] = sourceValue;\n      }\n    }\n  }\n}\n","/**\n * Mapping Engine - applies field mappings from source to target\n */\n\nimport type {\n  FieldMapping,\n  FieldMappingObject,\n  TransformContext,\n} from './types.js';\nimport { TransformRegistry } from '../transforms/transform-registry.js';\n\nexport class MappingEngine {\n  private transformRegistry: TransformRegistry;\n\n  constructor() {\n    this.transformRegistry = new TransformRegistry();\n  }\n\n  /**\n   * Apply all mappings to transform source to target\n   */\n  async apply(\n    source: Record<string, unknown>,\n    mappings: Record<string, FieldMapping>,\n    context: TransformContext\n  ): Promise<Record<string, unknown>> {\n    const target: Record<string, unknown> = {};\n\n    for (const [targetPath, mapping] of Object.entries(mappings)) {\n      const normalizedMapping = this.normalizeMapping(mapping);\n      const value = await this.applyMapping(\n        source,\n        normalizedMapping,\n        { ...context, field: targetPath, target }\n      );\n\n      if (value !== undefined) {\n        this.setNestedValue(target, targetPath, value);\n      }\n    }\n\n    return target;\n  }\n\n  /**\n   * Normalize string shorthand to full mapping object\n   */\n  private normalizeMapping(mapping: FieldMapping): FieldMappingObject {\n    if (typeof mapping === 'string') {\n      return { from: mapping };\n    }\n    return mapping;\n  }\n\n  /**\n   * Apply a single field mapping\n   */\n  private async applyMapping(\n    source: Record<string, unknown>,\n    mapping: FieldMappingObject,\n    context: TransformContext\n  ): Promise<unknown> {\n    // Check condition if present\n    if (mapping.condition) {\n      const conditionMet = this.evaluateCondition(\n        mapping.condition,\n        source,\n        context.config?.allowUnsafeEval === true\n      );\n      if (!conditionMet) {\n        return undefined;\n      }\n    }\n\n    // Get source value(s)\n    let value: unknown;\n    if (mapping.from === null || mapping.from === undefined) {\n      value = undefined;\n    } else if (Array.isArray(mapping.from)) {\n      // Multiple source fields - try each until one has a value\n      for (const path of mapping.from) {\n        value = this.getNestedValue(source, path);\n        if (value !== undefined && value !== null && value !== '') {\n          break;\n        }\n      }\n    } else {\n      value = this.getNestedValue(source, mapping.from);\n    }\n\n    // Apply default if value is missing\n    if ((value === undefined || value === null || value === '') && mapping.default !== undefined) {\n      value = mapping.default;\n    }\n\n    // Apply transform(s)\n    // Note: Transforms like 'uuid', 'timestamp' can generate values even without input\n    if (mapping.transform) {\n      const transforms = Array.isArray(mapping.transform)\n        ? mapping.transform\n        : [mapping.transform];\n\n      for (const transformName of transforms) {\n        value = await this.transformRegistry.apply(\n          transformName,\n          value,\n          mapping.options || {},\n          context\n        );\n      }\n    }\n\n    // Handle required fields\n    if (mapping.required && (value === undefined || value === null)) {\n      throw new Error(`Required field ${context.field} could not be populated`);\n    }\n\n    return value;\n  }\n\n  /**\n   * Get a nested value from an object using dot notation\n   */\n  private getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n    const parts = path.split('.');\n    let current: unknown = obj;\n\n    for (const part of parts) {\n      if (current === null || current === undefined) {\n        return undefined;\n      }\n\n      // Handle array index notation: field[0]\n      const arrayMatch = part.match(/^(\\w+)\\[(\\d+)\\]$/);\n      if (arrayMatch) {\n        const [, fieldName, index] = arrayMatch;\n        current = (current as Record<string, unknown>)[fieldName];\n        if (Array.isArray(current)) {\n          current = current[parseInt(index, 10)];\n        } else {\n          return undefined;\n        }\n      } else {\n        current = (current as Record<string, unknown>)[part];\n      }\n    }\n\n    return current;\n  }\n\n  /**\n   * Set a nested value in an object using dot notation\n   */\n  private setNestedValue(\n    obj: Record<string, unknown>,\n    path: string,\n    value: unknown\n  ): void {\n    const parts = path.split('.');\n    let current: unknown = obj;\n\n    for (let i = 0; i < parts.length; i++) {\n      const part = parts[i];\n      const isLast = i === parts.length - 1;\n      const arrayMatch = part.match(/^(\\w+)\\[(\\d+)\\]$/);\n\n      if (arrayMatch) {\n        const [, fieldName, index] = arrayMatch;\n        const targetIndex = parseInt(index, 10);\n\n        if (current === null || current === undefined || typeof current !== 'object') {\n          return;\n        }\n\n        const currentRecord = current as Record<string, unknown>;\n        if (!Array.isArray(currentRecord[fieldName])) {\n          currentRecord[fieldName] = [];\n        }\n\n        const arrayRef = currentRecord[fieldName] as unknown[];\n\n        if (isLast) {\n          arrayRef[targetIndex] = value;\n          return;\n        }\n\n        if (arrayRef[targetIndex] === undefined) {\n          const nextPart = parts[i + 1];\n          arrayRef[targetIndex] = /^\\w+\\[\\d+\\]$/.test(nextPart) ? [] : {};\n        }\n\n        current = arrayRef[targetIndex];\n        continue;\n      }\n\n      if (current === null || current === undefined || typeof current !== 'object') {\n        return;\n      }\n\n      const currentRecord = current as Record<string, unknown>;\n      if (isLast) {\n        currentRecord[part] = value;\n        return;\n      }\n\n      if (!(part in currentRecord)) {\n        const nextPart = parts[i + 1];\n        currentRecord[part] = /^\\w+\\[\\d+\\]$/.test(nextPart) ? [] : {};\n      }\n\n      current = currentRecord[part];\n    }\n  }\n\n  /**\n   * Evaluate a condition expression\n   */\n  private evaluateCondition(\n    condition: string,\n    source: Record<string, unknown>,\n    allowUnsafeEval: boolean\n  ): boolean {\n    if (!allowUnsafeEval) {\n      console.warn('Conditional expressions are disabled. Set allowUnsafeEval to true to enable them.');\n      return false;\n    }\n    try {\n      // Create a safe evaluation context\n      const fn = new Function('source', `return ${condition}`);\n      return Boolean(fn(source));\n    } catch {\n      console.warn(`Failed to evaluate condition: ${condition}`);\n      return true;\n    }\n  }\n}\n","/**\n * Transform Registry - manages transform functions and plugins\n */\n\nimport type { TransformFunction, TransformContext, TransformPlugin } from '../core/types.js';\n\n// Import built-in transforms\nimport { slugify } from './builtin/slugify.js';\nimport { titleCase } from './builtin/title-case.js';\nimport { uuid } from './builtin/uuid.js';\nimport { toArray, toMediaArray } from './builtin/to-array.js';\nimport { timestamp, autoGenerate } from './builtin/auto-generate.js';\nimport { registryLookup } from './builtin/registry-lookup.js';\nimport { template } from './builtin/template.js';\nimport { urlTransform } from './builtin/url-transform.js';\n\nexport class TransformRegistry {\n  private transforms: Map<string, TransformFunction> = new Map();\n  private plugins: Map<string, TransformPlugin> = new Map();\n\n  constructor() {\n    this.registerBuiltins();\n  }\n\n  /**\n   * Register built-in transforms\n   */\n  private registerBuiltins(): void {\n    // String transforms\n    this.register('slugify', slugify);\n    this.register('titleCase', titleCase);\n    this.register('lowerCase', (v) => String(v).toLowerCase());\n    this.register('upperCase', (v) => String(v).toUpperCase());\n    this.register('trim', (v) => String(v).trim());\n\n    // ID transforms\n    this.register('uuid', uuid);\n\n    // Array transforms\n    this.register('toArray', toArray);\n    this.register('toMediaArray', toMediaArray);\n\n    // Auto-generation transforms\n    this.register('timestamp', timestamp);\n    this.register('autoGenerate', autoGenerate);\n\n    // Lookup transforms\n    this.register('registryLookup', registryLookup);\n\n    // Template transforms\n    this.register('template', template);\n\n    // URL transforms\n    this.register('urlTransform', urlTransform);\n\n    // Utility transforms\n    this.register('coalesce', (values) => {\n      if (Array.isArray(values)) {\n        return values.find((v) => v !== undefined && v !== null && v !== '');\n      }\n      return values;\n    });\n\n    this.register('split', (value, options: { delimiter?: string } = {}) => {\n      return String(value).split(options.delimiter || ',').map((s) => s.trim());\n    });\n\n    this.register('join', (value, options: { delimiter?: string } = {}) => {\n      if (Array.isArray(value)) {\n        return value.join(options.delimiter || ', ');\n      }\n      return value;\n    });\n\n    this.register('replace', (value, options: { pattern?: string; replacement?: string } = {}) => {\n      if (!options.pattern) return value;\n      return String(value).replace(new RegExp(options.pattern, 'g'), options.replacement || '');\n    });\n\n    this.register('jsonParse', (value) => {\n      try {\n        return JSON.parse(String(value));\n      } catch {\n        return value;\n      }\n    });\n\n    this.register('jsonStringify', (value) => {\n      return JSON.stringify(value);\n    });\n  }\n\n  /**\n   * Register a transform function\n   */\n  register(name: string, fn: TransformFunction): void {\n    this.transforms.set(name, fn);\n  }\n\n  /**\n   * Register a plugin\n   */\n  registerPlugin(plugin: TransformPlugin): void {\n    this.plugins.set(plugin.name, plugin);\n\n    // Register plugin transforms with namespaced names\n    for (const [name, fn] of Object.entries(plugin.transforms)) {\n      this.transforms.set(`${plugin.name}:${name}`, fn);\n    }\n  }\n\n  /**\n   * Load a plugin from a module path\n   */\n  async loadPlugin(modulePath: string): Promise<void> {\n    try {\n      const module = await import(modulePath);\n      const plugin = module.default || module;\n\n      if (this.isValidPlugin(plugin)) {\n        this.registerPlugin(plugin);\n      } else {\n        throw new Error('Invalid plugin structure');\n      }\n    } catch (error) {\n      throw new Error(`Failed to load plugin from ${modulePath}: ${error}`);\n    }\n  }\n\n  /**\n   * Check if an object is a valid plugin\n   */\n  private isValidPlugin(obj: unknown): obj is TransformPlugin {\n    if (typeof obj !== 'object' || obj === null) return false;\n    const plugin = obj as Partial<TransformPlugin>;\n    return (\n      typeof plugin.name === 'string' &&\n      typeof plugin.version === 'string' &&\n      typeof plugin.transforms === 'object'\n    );\n  }\n\n  /**\n   * Get a transform function by name\n   */\n  get(name: string): TransformFunction | undefined {\n    return this.transforms.get(name);\n  }\n\n  /**\n   * Apply a transform\n   */\n  async apply(\n    name: string,\n    value: unknown,\n    options: Record<string, unknown>,\n    context: TransformContext\n  ): Promise<unknown> {\n    const transform = this.get(name);\n\n    if (!transform) {\n      throw new Error(`Unknown transform: ${name}`);\n    }\n\n    return transform(value, options, context);\n  }\n\n  /**\n   * Check if a transform exists\n   */\n  has(name: string): boolean {\n    return this.transforms.has(name);\n  }\n\n  /**\n   * List all registered transforms\n   */\n  list(): string[] {\n    return Array.from(this.transforms.keys());\n  }\n\n  /**\n   * List registered plugins\n   */\n  listPlugins(): string[] {\n    return Array.from(this.plugins.keys());\n  }\n}\n","/**\n * Slugify transform - converts strings to URL-safe slugs\n */\n\nimport type { TransformFunction } from '../../core/types.js';\n\n// Special word replacements\nconst WORD_REPLACEMENTS: Record<string, string> = {\n  '3/4': 'three-quarter',\n  '1/4': 'quarter',\n  '1/2': 'half',\n  '&': 'and',\n  '+': 'plus',\n  '@': 'at',\n};\n\nexport const slugify: TransformFunction = (\n  value: unknown,\n  _options: Record<string, unknown> = {}\n): string => {\n  if (value === null || value === undefined) {\n    return '';\n  }\n\n  let str = String(value);\n\n  // Apply word replacements\n  for (const [pattern, replacement] of Object.entries(WORD_REPLACEMENTS)) {\n    str = str.replace(new RegExp(escapeRegex(pattern), 'gi'), replacement);\n  }\n\n  // Convert to lowercase\n  str = str.toLowerCase();\n\n  // Replace spaces and underscores with hyphens\n  str = str.replace(/[\\s_]+/g, '-');\n\n  // Remove special characters (keep alphanumeric and hyphens)\n  str = str.replace(/[^a-z0-9-]/g, '');\n\n  // Collapse multiple hyphens\n  str = str.replace(/-+/g, '-');\n\n  // Trim hyphens from start and end\n  str = str.replace(/^-+|-+$/g, '');\n\n  // Ensure minimum length\n  if (str.length < 2) {\n    str = str.padEnd(2, '0');\n  }\n\n  return str;\n};\n\n/**\n * Escape special regex characters\n */\nfunction escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nexport default slugify;\n","/**\n * Title Case transform - converts strings to Title Case\n */\n\nimport type { TransformFunction } from '../../core/types.js';\n\n// Words that should remain lowercase (unless first word)\nconst LOWERCASE_WORDS = new Set([\n  'a', 'an', 'and', 'as', 'at', 'but', 'by', 'for', 'in', 'nor',\n  'of', 'on', 'or', 'so', 'the', 'to', 'up', 'yet', 'with',\n]);\n\n// Words/acronyms that should remain uppercase\nconst UPPERCASE_WORDS = new Set([\n  'db', 'bb', 'kb', 'ez', 'trx', 'hiit', 'amrap', 'emom', 'bw',\n]);\n\nexport const titleCase: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {}\n): string => {\n  if (value === null || value === undefined) {\n    return '';\n  }\n\n  const str = String(value);\n  const preserveAcronyms = options.preserveAcronyms !== false;\n\n  const words = str.split(/(\\s+|-)/); // Split but keep delimiters\n  \n  return words.map((word, index) => {\n    // Skip delimiters\n    if (/^\\s+$/.test(word) || word === '-') {\n      return word;\n    }\n\n    const lowerWord = word.toLowerCase();\n\n    // Check if it's an acronym that should stay uppercase\n    if (preserveAcronyms && UPPERCASE_WORDS.has(lowerWord)) {\n      return word.toUpperCase();\n    }\n\n    // Check if it's a word that should stay lowercase (unless first)\n    if (index > 0 && LOWERCASE_WORDS.has(lowerWord)) {\n      return lowerWord;\n    }\n\n    // Capitalize first letter, keep rest as-is for words like \"iPhone\"\n    // But lowercase if all caps\n    if (word === word.toUpperCase() && word.length > 1) {\n      return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();\n    }\n\n    return word.charAt(0).toUpperCase() + word.slice(1);\n  }).join('');\n};\n\nexport default titleCase;\n","/**\n * UUID transforms - generate UUIDs\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport type { TransformFunction } from '../../core/types.js';\n\n/**\n * Generate a new UUIDv4\n * \n * FDS requires plain UUIDs for all identifiers.\n */\nexport const uuid: TransformFunction = (): string => {\n  return uuidv4();\n};\n\nexport default uuid;\n","/**\n * Array transforms - convert values to arrays\n */\n\nimport type { TransformFunction } from '../../core/types.js';\n\n/**\n * Ensure value is an array\n */\nexport const toArray: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {}\n): unknown[] => {\n  if (value === null || value === undefined) {\n    return [];\n  }\n\n  if (Array.isArray(value)) {\n    return value;\n  }\n\n  // Split string by delimiter\n  if (typeof value === 'string' && options.delimiter) {\n    return value.split(String(options.delimiter)).map((s) => s.trim()).filter(Boolean);\n  }\n\n  return [value];\n};\n\n/**\n * Convert URL(s) to FDS media array format\n */\nexport const toMediaArray: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {}\n): Array<{ type: string; uri: string; caption?: string }> => {\n  if (value === null || value === undefined) {\n    return [];\n  }\n\n  const mediaType = String(options.type || 'image');\n  const urls = Array.isArray(value) ? value : [value];\n  \n  return urls\n    .filter((url) => url !== null && url !== undefined && url !== '')\n    .map((url) => {\n      let uri = String(url);\n\n      // Apply URL transformation if configured\n      if (options.urlTransform && typeof options.urlTransform === 'object') {\n        const transform = options.urlTransform as { pattern?: string; replace?: string };\n        if (transform.pattern && transform.replace) {\n          uri = uri.replace(new RegExp(transform.pattern), transform.replace);\n        }\n      }\n\n      // Apply base URL if configured\n      if (options.baseUrl) {\n        // Extract filename from URL\n        const filename = uri.split('/').pop() || uri;\n        uri = `${String(options.baseUrl).replace(/\\/$/, '')}/${filename}`;\n      }\n\n      const mediaItem: { type: string; uri: string; caption?: string; license?: string; attribution?: string } = {\n        type: mediaType,\n        uri,\n      };\n\n      // Add optional fields\n      if (options.caption) {\n        mediaItem.caption = String(options.caption);\n      }\n      if (options.license) {\n        mediaItem.license = String(options.license);\n      }\n      if (options.attribution) {\n        mediaItem.attribution = String(options.attribution);\n      }\n\n      return mediaItem;\n    });\n};\n\nexport default toArray;\n","/**\n * Auto-generate transforms - create metadata and timestamps\n */\n\nimport type { TransformFunction, TransformContext } from '../../core/types.js';\n\n/**\n * Generate a timestamp\n */\nexport const timestamp: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {}\n): string => {\n  const format = String(options.format || 'iso8601');\n  const date = value ? new Date(String(value)) : new Date();\n\n  switch (format) {\n    case 'iso8601':\n    case 'iso':\n      return date.toISOString();\n    case 'unix':\n      return String(Math.floor(date.getTime() / 1000));\n    case 'unixms':\n      return String(date.getTime());\n    case 'date':\n      return date.toISOString().split('T')[0];\n    default:\n      return date.toISOString();\n  }\n};\n\n/**\n * Auto-generate metadata fields\n */\nexport const autoGenerate: TransformFunction = (\n  _value: unknown,\n  options: Record<string, unknown> = {},\n  context: TransformContext\n): Record<string, unknown> => {\n  const result: Record<string, unknown> = {};\n\n  // Handle each option\n  for (const [key, val] of Object.entries(options)) {\n    if (val === 'now') {\n      result[key] = new Date().toISOString();\n    } else if (val === 'source') {\n      // Get from source\n      result[key] = getNestedValue(context.source, key);\n    } else if (typeof val === 'string' && val.startsWith('source.')) {\n      // Get specific field from source\n      result[key] = getNestedValue(context.source, val.slice(7));\n    } else {\n      result[key] = val;\n    }\n  }\n\n  return result;\n};\n\n/**\n * Get nested value helper\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined) {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n\nexport default autoGenerate;\n","/**\n * Registry Lookup transform - find entries in FDS registries\n */\n\nimport type {\n  TransformFunction,\n  TransformContext,\n  MuscleRef,\n  EquipmentRef,\n  MuscleCategoryRef,\n} from '../../core/types.js';\n\nexport interface RegistryLookupOptions {\n  registry: 'muscles' | 'equipment' | 'muscleCategories';\n  matchField?: 'name' | 'slug' | 'id';\n  fuzzyMatch?: boolean;\n  toArray?: boolean;\n  returnFields?: string[];\n}\n\nfunction getRegistryLookupOptions(options: Record<string, unknown>): RegistryLookupOptions {\n  const registry = options.registry;\n  const matchField = options.matchField;\n  const fuzzyMatch = options.fuzzyMatch;\n  const toArray = options.toArray;\n  const returnFields = options.returnFields;\n\n  return {\n    registry:\n      registry === 'muscles' || registry === 'equipment' || registry === 'muscleCategories'\n        ? registry\n        : 'muscles',\n    matchField: matchField === 'name' || matchField === 'slug' || matchField === 'id' ? matchField : undefined,\n    fuzzyMatch: typeof fuzzyMatch === 'boolean' ? fuzzyMatch : undefined,\n    toArray: typeof toArray === 'boolean' ? toArray : undefined,\n    returnFields: Array.isArray(returnFields)\n      ? returnFields.filter((field): field is string => typeof field === 'string')\n      : undefined,\n  };\n}\n\n/**\n * Look up a value in a registry\n */\nexport const registryLookup: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {},\n  context: TransformContext\n): unknown => {\n  const lookupOptions = getRegistryLookupOptions(options);\n\n  if (value === null || value === undefined || value === '') {\n    return lookupOptions.toArray ? [] : null;\n  }\n\n  const registryName = lookupOptions.registry;\n  const registry = context.registries[registryName];\n\n  if (!registry || registry.length === 0) {\n    console.warn(`Registry \"${registryName}\" is empty or not loaded`);\n    return lookupOptions.toArray ? [] : null;\n  }\n\n  const queries = Array.isArray(value) ? value : [value];\n  const results: Array<MuscleRef | EquipmentRef | MuscleCategoryRef | Record<string, unknown>> = [];\n\n  for (const query of queries) {\n    const normalizedQuery = String(query).toLowerCase().trim();\n\n    let match: typeof registry[0] | undefined;\n\n    if (lookupOptions.matchField === 'id') {\n      match = registry.find((entry) => String(entry.id).toLowerCase() === normalizedQuery);\n    } else if (lookupOptions.matchField === 'slug') {\n      match = registry.find((entry) => entry.canonical.slug.toLowerCase() === normalizedQuery);\n    } else if (lookupOptions.matchField === 'name') {\n      match = registry.find(\n        (entry) =>\n          entry.canonical.name.toLowerCase() === normalizedQuery ||\n          entry.canonical.aliases?.some((alias) => alias.toLowerCase() === normalizedQuery)\n      );\n    } else {\n      match = registry.find(\n        (entry) =>\n          entry.canonical.name.toLowerCase() === normalizedQuery ||\n          entry.canonical.slug.toLowerCase() === normalizedQuery\n      );\n\n      if (!match) {\n        match = registry.find((entry) =>\n          entry.canonical.aliases?.some((alias) => alias.toLowerCase() === normalizedQuery)\n        );\n      }\n    }\n\n    // Try fuzzy match\n    if (!match && lookupOptions.fuzzyMatch && lookupOptions.matchField !== 'id') {\n      match = findFuzzyMatch(registry, normalizedQuery) as typeof registry[0] | undefined;\n    }\n\n    if (match) {\n      // Format the result based on registry type\n      let result: MuscleRef | EquipmentRef | MuscleCategoryRef;\n\n      if (registryName === 'muscles') {\n        const muscleEntry = match as any;\n        result = {\n          id: match.id,\n          name: match.canonical.name,\n          slug: match.canonical.slug,\n          categoryId: muscleEntry.classification?.categoryId || '',\n        } as MuscleRef;\n      } else if (registryName === 'equipment') {\n        result = {\n          id: match.id,\n          name: match.canonical.name,\n          slug: match.canonical.slug,\n        } as EquipmentRef;\n      } else {\n        result = {\n          id: match.id,\n          name: match.canonical.name,\n          slug: match.canonical.slug,\n        } as MuscleCategoryRef;\n      }\n\n      if (lookupOptions.returnFields?.length) {\n        const filtered: Record<string, unknown> = {};\n        const resultRecord: Record<string, unknown> = { ...result };\n        for (const field of lookupOptions.returnFields) {\n          if (field in resultRecord) {\n            filtered[field] = resultRecord[field];\n          }\n        }\n        results.push(filtered);\n      } else {\n        results.push(result);\n      }\n    }\n  }\n\n  // Return based on toArray option\n  if (lookupOptions.toArray) {\n    return results;\n  }\n\n  return results.length > 0 ? results[0] : null;\n};\n\n/**\n * Find a fuzzy match using simple similarity\n */\nfunction findFuzzyMatch(\n  registry: Array<{ canonical: { name: string; slug: string; aliases?: string[] } }>,\n  query: string\n): typeof registry[0] | null {\n  let bestMatch: typeof registry[0] | null = null;\n  let bestScore = 0;\n  const threshold = 0.6;\n\n  for (const entry of registry) {\n    // Check name similarity\n    const nameScore = calculateSimilarity(query, entry.canonical.name.toLowerCase());\n    if (nameScore > bestScore && nameScore >= threshold) {\n      bestScore = nameScore;\n      bestMatch = entry;\n    }\n\n    // Check slug similarity\n    const slugScore = calculateSimilarity(query, entry.canonical.slug);\n    if (slugScore > bestScore && slugScore >= threshold) {\n      bestScore = slugScore;\n      bestMatch = entry;\n    }\n\n    // Check aliases\n    if (entry.canonical.aliases) {\n      for (const alias of entry.canonical.aliases) {\n        const aliasScore = calculateSimilarity(query, alias.toLowerCase());\n        if (aliasScore > bestScore && aliasScore >= threshold) {\n          bestScore = aliasScore;\n          bestMatch = entry;\n        }\n      }\n    }\n  }\n\n  return bestMatch;\n}\n\n/**\n * Calculate string similarity (0-1)\n */\nfunction calculateSimilarity(str1: string, str2: string): number {\n  if (str1 === str2) return 1;\n  if (str1.length === 0 || str2.length === 0) return 0;\n\n  // Simple Levenshtein-based similarity\n  const len1 = str1.length;\n  const len2 = str2.length;\n  const matrix: number[][] = [];\n\n  for (let i = 0; i <= len1; i++) {\n    matrix[i] = [i];\n  }\n\n  for (let j = 0; j <= len2; j++) {\n    matrix[0][j] = j;\n  }\n\n  for (let i = 1; i <= len1; i++) {\n    for (let j = 1; j <= len2; j++) {\n      const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;\n      matrix[i][j] = Math.min(\n        matrix[i - 1][j] + 1,\n        matrix[i][j - 1] + 1,\n        matrix[i - 1][j - 1] + cost\n      );\n    }\n  }\n\n  const distance = matrix[len1][len2];\n  return 1 - distance / Math.max(len1, len2);\n}\n\nexport default registryLookup;\n","/**\n * Template transform - apply simple templates\n */\n\nimport type { TransformFunction, TransformContext } from '../../core/types.js';\n\n/**\n * Apply a template to the value\n */\nexport const template: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {},\n  context: TransformContext\n): unknown => {\n  const templateValue = options.template;\n\n  if (templateValue === undefined) {\n    return value;\n  }\n\n  // If template is an object/array, process it recursively\n  if (typeof templateValue === 'object' && templateValue !== null) {\n    return processTemplateObject(templateValue, value, context);\n  }\n\n  // If template is a string, replace placeholders\n  if (typeof templateValue === 'string') {\n    return replaceTemplatePlaceholders(templateValue, value, context);\n  }\n\n  return templateValue;\n};\n\n/**\n * Process template object/array recursively\n */\nfunction processTemplateObject(\n  template: unknown,\n  value: unknown,\n  context: TransformContext\n): unknown {\n  if (Array.isArray(template)) {\n    return template.map((item) => processTemplateObject(item, value, context));\n  }\n\n  if (typeof template === 'object' && template !== null) {\n    const result: Record<string, unknown> = {};\n    for (const [key, val] of Object.entries(template)) {\n      result[key] = processTemplateObject(val, value, context);\n    }\n    return result;\n  }\n\n  if (typeof template === 'string') {\n    return replaceTemplatePlaceholders(template, value, context);\n  }\n\n  return template;\n}\n\n/**\n * Replace {{placeholder}} in template strings\n */\nfunction replaceTemplatePlaceholders(\n  template: string,\n  value: unknown,\n  context: TransformContext\n): string {\n  return template.replace(/\\{\\{(\\w+(?:\\.\\w+)*)\\}\\}/g, (_match, path) => {\n    // Special placeholders\n    if (path === 'value') {\n      return String(value ?? '');\n    }\n\n    if (path === 'index') {\n      return String(context.field || '');\n    }\n\n    // Check source\n    const sourceValue = getNestedValue(context.source, path);\n    if (sourceValue !== undefined) {\n      return String(sourceValue);\n    }\n\n    // Check target\n    const targetValue = getNestedValue(context.target, path);\n    if (targetValue !== undefined) {\n      return String(targetValue);\n    }\n\n    // Return empty string for unresolved\n    return '';\n  });\n}\n\n/**\n * Get nested value from object\n */\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n\n  for (const part of parts) {\n    if (current === null || current === undefined) {\n      return undefined;\n    }\n    current = (current as Record<string, unknown>)[part];\n  }\n\n  return current;\n}\n\nexport default template;\n","/**\n * URL Transform - manipulate URLs\n */\n\nimport type { TransformFunction } from '../../core/types.js';\n\nexport interface UrlTransformOptions {\n  pattern?: string;\n  replace?: string;\n  baseUrl?: string;\n  protocol?: string;\n}\n\n/**\n * Transform a URL\n */\nexport const urlTransform: TransformFunction = (\n  value: unknown,\n  options: Record<string, unknown> = {}\n): string => {\n  if (value === null || value === undefined || value === '') {\n    return '';\n  }\n\n  let url = String(value);\n  const opts = options as UrlTransformOptions;\n\n  // Apply regex replacement\n  if (opts.pattern && opts.replace !== undefined) {\n    try {\n      url = url.replace(new RegExp(opts.pattern), opts.replace);\n    } catch (error) {\n      console.warn(`Invalid URL transform pattern: ${opts.pattern}`);\n    }\n  }\n\n  // Apply base URL\n  if (opts.baseUrl) {\n    // Extract filename/path from original URL\n    const parts = url.split('/');\n    const filename = parts[parts.length - 1];\n    url = `${opts.baseUrl.replace(/\\/$/, '')}/${filename}`;\n  }\n\n  // Change protocol\n  if (opts.protocol) {\n    url = url.replace(/^https?:/, opts.protocol);\n  }\n\n  return url;\n};\n\nexport default urlTransform;\n","/**\n * Registry Manager - loads and manages FDS registries\n */\n\nimport type {\n  RegistriesConfig,\n  RegistryConfig,\n  RegistryEntry,\n  MuscleRegistryEntry,\n  EquipmentRegistryEntry,\n  MuscleCategoryRegistryEntry,\n} from '../core/types.js';\nimport { FuzzyMatcher } from './fuzzy-matcher.js';\n\nexport class RegistryManager {\n  private muscles: MuscleRegistryEntry[] = [];\n  private equipment: EquipmentRegistryEntry[] = [];\n  private muscleCategories: MuscleCategoryRegistryEntry[] = [];\n  private fuzzyMatcher: FuzzyMatcher;\n\n  constructor() {\n    this.fuzzyMatcher = new FuzzyMatcher();\n  }\n\n  /**\n   * Load all registries from config\n   */\n  async load(config: RegistriesConfig): Promise<void> {\n    const loaders: Promise<void>[] = [];\n\n    if (config.muscles) {\n      loaders.push(this.loadRegistry('muscles', config.muscles));\n    }\n    if (config.equipment) {\n      loaders.push(this.loadRegistry('equipment', config.equipment));\n    }\n    if (config.muscleCategories) {\n      loaders.push(this.loadRegistry('muscleCategories', config.muscleCategories));\n    }\n\n    await Promise.all(loaders);\n  }\n\n  /**\n   * Load a single registry\n   */\n  private async loadRegistry(\n    type: 'muscles' | 'equipment' | 'muscleCategories',\n    config: RegistryConfig\n  ): Promise<void> {\n    let data: RegistryEntry[] = [];\n\n    try {\n      if (config.inline && config.inline.length > 0) {\n        data = config.inline;\n      } else if (config.local) {\n        data = await this.loadFromFile(config.local);\n      } else if (config.source === 'remote' || config.url) {\n        data = await this.loadFromUrl(\n          config.url || this.getDefaultUrl(type)\n        );\n      }\n    } catch (error) {\n      // Try fallback\n      if (config.fallback) {\n        console.warn(`Failed to load ${type} from primary source, trying fallback`);\n        if (config.fallback === 'local' && config.local) {\n          data = await this.loadFromFile(config.local);\n        } else if (config.fallback === 'remote') {\n          data = await this.loadFromUrl(this.getDefaultUrl(type));\n        }\n      } else {\n        throw error;\n      }\n    }\n\n    switch (type) {\n      case 'muscles':\n        this.muscles = data as MuscleRegistryEntry[];\n        break;\n      case 'equipment':\n        this.equipment = data as EquipmentRegistryEntry[];\n        break;\n      case 'muscleCategories':\n        this.muscleCategories = data as MuscleCategoryRegistryEntry[];\n        break;\n    }\n  }\n\n  /**\n   * Load registry from local file\n   */\n  private async loadFromFile(path: string): Promise<RegistryEntry[]> {\n    const fs = await import('fs/promises');\n    const content = await fs.readFile(path, 'utf-8');\n    return JSON.parse(content);\n  }\n\n  /**\n   * Load registry from URL\n   */\n  private async loadFromUrl(url: string): Promise<RegistryEntry[]> {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`Failed to fetch registry from ${url}: ${response.statusText}`);\n    }\n    return response.json() as Promise<RegistryEntry[]>;\n  }\n\n  /**\n   * Get default URL for a registry type\n   */\n  private getDefaultUrl(type: string): string {\n    const baseUrl = 'https://spec.vitness.me/registries';\n    switch (type) {\n      case 'muscles':\n        return `${baseUrl}/muscles.registry.json`;\n      case 'equipment':\n        return `${baseUrl}/equipment.registry.json`;\n      case 'muscleCategories':\n        return `${baseUrl}/muscle-categories.registry.json`;\n      default:\n        throw new Error(`Unknown registry type: ${type}`);\n    }\n  }\n\n  // Getters\n  getMuscles(): MuscleRegistryEntry[] {\n    return this.muscles;\n  }\n\n  getEquipment(): EquipmentRegistryEntry[] {\n    return this.equipment;\n  }\n\n  getMuscleCategories(): MuscleCategoryRegistryEntry[] {\n    return this.muscleCategories;\n  }\n\n  // Lookup methods\n  findMuscle(query: string, fuzzy = true): MuscleRegistryEntry | null {\n    return this.findInRegistry(this.muscles, query, fuzzy) as MuscleRegistryEntry | null;\n  }\n\n  findEquipment(query: string, fuzzy = true): EquipmentRegistryEntry | null {\n    return this.findInRegistry(this.equipment, query, fuzzy) as EquipmentRegistryEntry | null;\n  }\n\n  findMuscleCategory(query: string, fuzzy = true): MuscleCategoryRegistryEntry | null {\n    return this.findInRegistry(this.muscleCategories, query, fuzzy) as MuscleCategoryRegistryEntry | null;\n  }\n\n  /**\n   * Find an entry in a registry\n   */\n  private findInRegistry(\n    registry: RegistryEntry[],\n    query: string,\n    fuzzy: boolean\n  ): RegistryEntry | null {\n    const normalizedQuery = query.toLowerCase().trim();\n\n    // Exact match on name or slug\n    let match = registry.find(\n      (entry) =>\n        entry.canonical.name.toLowerCase() === normalizedQuery ||\n        entry.canonical.slug === normalizedQuery\n    );\n\n    if (match) return match;\n\n    // Match on aliases\n    match = registry.find((entry) =>\n      entry.canonical.aliases?.some(\n        (alias) => alias.toLowerCase() === normalizedQuery\n      )\n    );\n\n    if (match) return match;\n\n    // Fuzzy match if enabled\n    if (fuzzy) {\n      return this.fuzzyMatcher.findBestMatch(registry, query);\n    }\n\n    return null;\n  }\n}\n","/**\n * Fuzzy Matcher - finds best matches using string similarity\n */\n\nimport type { RegistryEntry } from '../core/types.js';\nimport levenshtein from 'fast-levenshtein';\n\nexport interface FuzzyMatchOptions {\n  threshold?: number;\n  caseSensitive?: boolean;\n}\n\nexport interface FuzzyMatchResult {\n  entry: RegistryEntry;\n  score: number;\n  matchedField: string;\n}\n\nexport class FuzzyMatcher {\n  private defaultThreshold = 0.6;\n\n  /**\n   * Find the best matching entry in a registry\n   */\n  findBestMatch(\n    registry: RegistryEntry[],\n    query: string,\n    options: FuzzyMatchOptions = {}\n  ): RegistryEntry | null {\n    const threshold = options.threshold ?? this.defaultThreshold;\n    const normalizedQuery = options.caseSensitive\n      ? query.trim()\n      : query.toLowerCase().trim();\n\n    let bestMatch: FuzzyMatchResult | null = null;\n\n    for (const entry of registry) {\n      // Check name\n      const nameScore = this.calculateSimilarity(\n        normalizedQuery,\n        options.caseSensitive\n          ? entry.canonical.name\n          : entry.canonical.name.toLowerCase()\n      );\n\n      if (nameScore > (bestMatch?.score ?? threshold)) {\n        bestMatch = { entry, score: nameScore, matchedField: 'name' };\n      }\n\n      // Check slug\n      const slugScore = this.calculateSimilarity(\n        normalizedQuery,\n        entry.canonical.slug\n      );\n\n      if (slugScore > (bestMatch?.score ?? threshold)) {\n        bestMatch = { entry, score: slugScore, matchedField: 'slug' };\n      }\n\n      // Check aliases\n      if (entry.canonical.aliases) {\n        for (const alias of entry.canonical.aliases) {\n          const aliasScore = this.calculateSimilarity(\n            normalizedQuery,\n            options.caseSensitive ? alias : alias.toLowerCase()\n          );\n\n          if (aliasScore > (bestMatch?.score ?? threshold)) {\n            bestMatch = { entry, score: aliasScore, matchedField: `alias:${alias}` };\n          }\n        }\n      }\n    }\n\n    return bestMatch?.entry ?? null;\n  }\n\n  /**\n   * Find all matches above threshold\n   */\n  findAllMatches(\n    registry: RegistryEntry[],\n    query: string,\n    options: FuzzyMatchOptions = {}\n  ): FuzzyMatchResult[] {\n    const threshold = options.threshold ?? this.defaultThreshold;\n    const normalizedQuery = options.caseSensitive\n      ? query.trim()\n      : query.toLowerCase().trim();\n\n    const matches: FuzzyMatchResult[] = [];\n\n    for (const entry of registry) {\n      const scores: Array<{ score: number; field: string }> = [];\n\n      // Check name\n      scores.push({\n        score: this.calculateSimilarity(\n          normalizedQuery,\n          options.caseSensitive\n            ? entry.canonical.name\n            : entry.canonical.name.toLowerCase()\n        ),\n        field: 'name',\n      });\n\n      // Check slug\n      scores.push({\n        score: this.calculateSimilarity(normalizedQuery, entry.canonical.slug),\n        field: 'slug',\n      });\n\n      // Check aliases\n      if (entry.canonical.aliases) {\n        for (const alias of entry.canonical.aliases) {\n          scores.push({\n            score: this.calculateSimilarity(\n              normalizedQuery,\n              options.caseSensitive ? alias : alias.toLowerCase()\n            ),\n            field: `alias:${alias}`,\n          });\n        }\n      }\n\n      // Find best score for this entry\n      const best = scores.reduce((a, b) => (a.score > b.score ? a : b));\n\n      if (best.score >= threshold) {\n        matches.push({\n          entry,\n          score: best.score,\n          matchedField: best.field,\n        });\n      }\n    }\n\n    // Sort by score descending\n    return matches.sort((a, b) => b.score - a.score);\n  }\n\n  /**\n   * Calculate similarity between two strings (0-1)\n   */\n  calculateSimilarity(str1: string, str2: string): number {\n    if (str1 === str2) return 1;\n    if (str1.length === 0 || str2.length === 0) return 0;\n\n    const distance = levenshtein.get(str1, str2);\n    const maxLength = Math.max(str1.length, str2.length);\n\n    return 1 - distance / maxLength;\n  }\n\n  /**\n   * Normalize a string for comparison\n   */\n  normalize(str: string): string {\n    return str\n      .toLowerCase()\n      .trim()\n      .replace(/[\\s-_]+/g, ' ') // Normalize whitespace\n      .replace(/[^a-z0-9 ]/g, ''); // Remove special chars\n  }\n}\n","/**\n * Schema Manager - handles FDS schema loading and versioning\n * \n * Uses a hybrid approach:\n * 1. Try fetching from spec.vitness.me (gets latest schemas)\n * 2. Fall back to bundled schemas if remote fails (offline support)\n * \n * This ensures the transformer works both online (with latest schemas)\n * and offline (with bundled fallback).\n */\n\nimport type { ValidationResult } from '../core/types.js';\nimport { Validator } from './validator.js';\n\nexport interface SchemaVersion {\n  version: string;\n  url: string;\n  bundled: boolean;\n}\n\nexport interface SchemaLoadResult {\n  source: 'remote' | 'bundled';\n  entities: string[];\n  errors: string[];\n}\n\nexport class SchemaManager {\n  private schemas: Map<string, Map<string, object>> = new Map();\n  private validator: Validator;\n  private cacheDir: string | null = null;\n  private lastLoadResult: SchemaLoadResult | null = null;\n\n  constructor() {\n    this.validator = new Validator();\n  }\n\n  /**\n   * Load a specific schema version using hybrid approach:\n   * 1. Try remote first (gets latest)\n   * 2. Validate that schemas compile correctly (catch broken $ref paths)\n   * 3. Fall back to bundled if remote fails or has compilation errors\n   */\n  async loadVersion(version: string): Promise<void> {\n    if (this.schemas.has(version)) {\n      return;\n    }\n\n    const entitySchemas = new Map<string, object>();\n    const entities = ['exercise', 'equipment', 'muscle', 'muscle-category', 'body-atlas'];\n    const errors: string[] = [];\n    let source: 'remote' | 'bundled' = 'remote';\n\n    // Try remote first\n    let remoteSuccess = true;\n    for (const entity of entities) {\n      try {\n        const schema = await this.fetchSchema(entity, version);\n        entitySchemas.set(entity, schema);\n      } catch (error) {\n        remoteSuccess = false;\n        errors.push(`Remote fetch failed for ${entity}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        break; // If one fails, switch to bundled for all\n      }\n    }\n\n    // If remote fetch succeeded, validate schemas compile correctly\n    if (remoteSuccess) {\n      // Use silent mode to avoid duplicate warnings - we'll log our own if fallback is needed\n      const testValidator = new Validator({ silent: true });\n      testValidator.addSchemas(entitySchemas);\n      \n      // Check if any schema had compilation errors\n      for (const entity of entities) {\n        if (testValidator.hasSchemaError(entity)) {\n          remoteSuccess = false;\n          errors.push(`Remote schema compilation failed for ${entity}: ${testValidator.getSchemaError(entity)}`);\n        }\n      }\n    }\n\n    // If remote failed (fetch or compilation), fall back to bundled\n    if (!remoteSuccess) {\n      entitySchemas.clear();\n      source = 'bundled';\n      \n      try {\n        const bundled = await this.loadBundled(version);\n        for (const [entity, schema] of Object.entries(bundled)) {\n          entitySchemas.set(entity, schema);\n        }\n      } catch (bundledError) {\n        errors.push(`Bundled fallback failed: ${bundledError instanceof Error ? bundledError.message : 'Unknown error'}`);\n        // Log errors but don't throw - validator will handle missing schemas gracefully\n        for (const err of errors) {\n          console.warn(err);\n        }\n      }\n    }\n\n    this.lastLoadResult = {\n      source,\n      entities: Array.from(entitySchemas.keys()),\n      errors,\n    };\n\n    this.schemas.set(version, entitySchemas);\n    this.validator.addSchemas(entitySchemas);\n  }\n\n  /**\n   * Get information about how schemas were loaded\n   */\n  getLoadResult(): SchemaLoadResult | null {\n    return this.lastLoadResult;\n  }\n\n  /**\n   * Load bundled schemas (fallback for offline/network errors)\n   */\n  private async loadBundled(version: string): Promise<Record<string, object>> {\n    // Use statically imported bundled schemas for v1.0.0\n    if (version === '1.0.0') {\n      try {\n        const bundled = await import('./bundled/v1.0.0/index.js');\n        return bundled.default || bundled;\n      } catch {\n        throw new Error(`Failed to load bundled schemas for version ${version}`);\n      }\n    }\n    throw new Error(`No bundled schemas for version ${version}`);\n  }\n\n  /**\n   * Fetch schema from remote URL\n   */\n  private async fetchSchema(entity: string, version: string): Promise<object> {\n    const baseUrl = 'https://spec.vitness.me/schemas';\n    let url: string;\n\n    switch (entity) {\n      case 'exercise':\n        url = `${baseUrl}/exercises/v${version}/exercise.schema.json`;\n        break;\n      case 'equipment':\n        url = `${baseUrl}/equipment/v${version}/equipment.schema.json`;\n        break;\n      case 'muscle':\n        url = `${baseUrl}/muscle/v${version}/muscle.schema.json`;\n        break;\n      case 'muscle-category':\n        url = `${baseUrl}/muscle/muscle-category/v${version}/muscle-category.schema.json`;\n        break;\n      case 'body-atlas':\n        url = `${baseUrl}/atlas/v${version}/body-atlas.schema.json`;\n        break;\n      default:\n        throw new Error(`Unknown entity type: ${entity}`);\n    }\n\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`Failed to fetch schema: ${response.statusText}`);\n    }\n\n    const schema = await response.json() as object;\n\n    // Cache locally if cacheDir is set\n    if (this.cacheDir) {\n      await this.cacheSchema(entity, version, schema);\n    }\n\n    return schema;\n  }\n\n  /**\n   * Cache schema locally\n   */\n  private async cacheSchema(\n    entity: string,\n    version: string,\n    schema: object\n  ): Promise<void> {\n    if (!this.cacheDir) return;\n\n    const fs = await import('fs/promises');\n    const path = await import('path');\n\n    const dir = path.join(this.cacheDir, `v${version}`);\n    await fs.mkdir(dir, { recursive: true });\n\n    const filePath = path.join(dir, `${entity}.schema.json`);\n    await fs.writeFile(filePath, JSON.stringify(schema, null, 2));\n  }\n\n  /**\n   * List available schema versions\n   */\n  async listVersions(): Promise<SchemaVersion[]> {\n    // For now, return known versions\n    return [\n      {\n        version: '1.0.0',\n        url: 'https://spec.vitness.me/schemas/exercises/v1.0.0/exercise.schema.json',\n        bundled: true,\n      },\n    ];\n  }\n\n  /**\n   * Get a specific schema\n   */\n  getSchema(entity: string, version = '1.0.0'): object | null {\n    return this.schemas.get(version)?.get(entity) ?? null;\n  }\n\n  /**\n   * Validate data against a schema\n   */\n  async validate(\n    data: unknown,\n    entity: string,\n    version = '1.0.0'\n  ): Promise<ValidationResult> {\n    // Ensure schema is loaded\n    await this.loadVersion(version);\n\n    // Use the entity name to validate (uses pre-compiled schema or handles errors gracefully)\n    return this.validator.validate(data, entity);\n  }\n\n  /**\n   * Set the cache directory\n   */\n  setCacheDir(dir: string): void {\n    this.cacheDir = dir;\n  }\n\n  /**\n   * Update cached schemas\n   */\n  async updateCache(): Promise<void> {\n    const versions = await this.listVersions();\n    for (const { version } of versions) {\n      await this.loadVersion(version);\n    }\n  }\n\n  /**\n   * Force load bundled schemas only (skip remote fetch)\n   * Useful for offline mode or when remote schemas are known to be broken\n   */\n  async loadBundledOnly(version: string): Promise<void> {\n    if (this.schemas.has(version)) {\n      return;\n    }\n\n    const entitySchemas = new Map<string, object>();\n\n    try {\n      const bundled = await this.loadBundled(version);\n      for (const [entity, schema] of Object.entries(bundled)) {\n        entitySchemas.set(entity, schema);\n      }\n      \n      this.lastLoadResult = {\n        source: 'bundled',\n        entities: Array.from(entitySchemas.keys()),\n        errors: [],\n      };\n    } catch (error) {\n      this.lastLoadResult = {\n        source: 'bundled',\n        entities: [],\n        errors: [`Failed to load bundled schemas: ${error instanceof Error ? error.message : 'Unknown error'}`],\n      };\n      throw error;\n    }\n\n    this.schemas.set(version, entitySchemas);\n    this.validator.addSchemas(entitySchemas);\n  }\n\n  /**\n   * Clear loaded schemas (useful for testing or reloading)\n   */\n  clearSchemas(): void {\n    this.schemas.clear();\n    this.lastLoadResult = null;\n  }\n}\n","/**\n * Validator - JSON Schema validation using Ajv\n * \n * Uses Ajv 2020-12 draft support for FDS schemas which use:\n * \"$schema\": \"https://json-schema.org/draft/2020-12/schema\"\n */\n\nimport Ajv2020 from 'ajv/dist/2020.js';\nimport addFormats from 'ajv-formats';\nimport type { ValidationResult, ValidationError } from '../core/types.js';\n\nexport interface ValidatorOptions {\n  /** Suppress console warnings (useful for testing schema validity) */\n  silent?: boolean;\n}\n\nexport class Validator {\n  private ajv: InstanceType<typeof Ajv2020>;\n  private compiledSchemas: Map<string, ReturnType<InstanceType<typeof Ajv2020>['compile']>> = new Map();\n  private schemaErrors: Map<string, string> = new Map();\n  private silent: boolean;\n\n  constructor(options: ValidatorOptions = {}) {\n    this.silent = options.silent ?? false;\n    this.ajv = new Ajv2020({\n      allErrors: true,\n      verbose: true,\n      strict: false,\n      loadSchema: this.loadExternalSchema.bind(this),\n    });\n    addFormats(this.ajv);\n  }\n\n  /**\n   * Load external schema by URI (for $ref resolution)\n   * This is called by Ajv when it encounters an external $ref\n   */\n  private async loadExternalSchema(uri: string): Promise<object> {\n    try {\n      const response = await fetch(uri);\n      if (!response.ok) {\n        throw new Error(`Failed to fetch schema: ${response.statusText}`);\n      }\n      return await response.json() as object;\n    } catch (error) {\n      // Return a permissive schema if we can't load the external reference\n      if (!this.silent) {\n        console.warn(`Could not load external schema ${uri}:`, error);\n      }\n      return { type: 'object', additionalProperties: true };\n    }\n  }\n\n  /**\n   * Add schemas to the validator\n   * First registers all schemas with their $id, then compiles them\n   */\n  addSchemas(schemas: Map<string, object>): void {\n    // First pass: add all schemas to Ajv so $refs can be resolved\n    for (const [, schema] of schemas) {\n      try {\n        const schemaObj = schema as { $id?: string };\n        if (schemaObj.$id) {\n          // Add schema by its $id so it can be referenced\n          this.ajv.addSchema(schema, schemaObj.$id);\n        }\n      } catch {\n        // Schema might already be added, ignore\n      }\n    }\n\n    // Second pass: compile schemas\n    for (const [name, schema] of schemas) {\n      try {\n        const schemaObj = schema as { $id?: string };\n        // Try to get already-compiled schema or compile it\n        let compiled = schemaObj.$id ? this.ajv.getSchema(schemaObj.$id) : undefined;\n        if (!compiled) {\n          compiled = this.ajv.compile(schema);\n        }\n        if (compiled) {\n          this.compiledSchemas.set(name, compiled as ReturnType<InstanceType<typeof Ajv2020>['compile']>);\n        }\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        if (!this.silent) {\n          console.warn(`Failed to compile schema ${name}:`, message);\n        }\n        this.schemaErrors.set(name, message);\n      }\n    }\n  }\n\n  /**\n   * Check if a schema had compilation errors\n   */\n  hasSchemaError(name: string): boolean {\n    return this.schemaErrors.has(name);\n  }\n\n  /**\n   * Get schema compilation error\n   */\n  getSchemaError(name: string): string | undefined {\n    return this.schemaErrors.get(name);\n  }\n\n  /**\n   * Validate data against a schema\n   */\n  validate(data: unknown, schema: object | string): ValidationResult {\n    let validateFn: ReturnType<InstanceType<typeof Ajv2020>['compile']>;\n\n    if (typeof schema === 'string') {\n      // Check if there was a compilation error for this schema\n      const schemaError = this.schemaErrors.get(schema);\n      if (schemaError) {\n        // Return a warning but consider valid (schema couldn't be compiled)\n        return {\n          valid: true,\n          errors: [],\n          warnings: [\n            {\n              field: '_schema',\n              message: `Schema \"${schema}\" could not be compiled: ${schemaError}. Validation skipped.`,\n            },\n          ],\n        };\n      }\n\n      // Use pre-compiled schema by name\n      const compiled = this.compiledSchemas.get(schema);\n      if (!compiled) {\n        // Schema not found - consider valid but warn\n        return {\n          valid: true,\n          errors: [],\n          warnings: [\n            {\n              field: '_schema',\n              message: `Schema \"${schema}\" not found. Validation skipped.`,\n            },\n          ],\n        };\n      }\n      validateFn = compiled;\n    } else {\n      // Compile schema on the fly\n      try {\n        validateFn = this.ajv.compile(schema);\n      } catch (error) {\n        return {\n          valid: false,\n          errors: [\n            {\n              field: '_schema',\n              message: `Failed to compile schema: ${error instanceof Error ? error.message : 'Unknown error'}`,\n            },\n          ],\n        };\n      }\n    }\n\n    const valid = validateFn(data);\n\n    if (valid) {\n      return { valid: true, errors: [] };\n    }\n\n    const errors: ValidationError[] = (validateFn.errors || []).map((err) => ({\n      field: err.instancePath ? err.instancePath.slice(1).replace(/\\//g, '.') : err.params?.missingProperty || '_root',\n      message: err.message || 'Validation failed',\n      value: err.data,\n      constraint: err.keyword,\n    }));\n\n    return { valid: false, errors };\n  }\n\n  /**\n   * Validate and return typed result\n   */\n  validateTyped<T>(data: unknown, schema: object | string): { valid: true; data: T } | { valid: false; errors: ValidationError[] } {\n    const result = this.validate(data, schema);\n\n    if (result.valid) {\n      return { valid: true, data: data as T };\n    }\n\n    return { valid: false, errors: result.errors };\n  }\n\n  /**\n   * Check if a value matches a specific type\n   */\n  isValidType(value: unknown, type: string): boolean {\n    switch (type) {\n      case 'string':\n        return typeof value === 'string';\n      case 'number':\n        return typeof value === 'number' && !isNaN(value);\n      case 'integer':\n        return typeof value === 'number' && Number.isInteger(value);\n      case 'boolean':\n        return typeof value === 'boolean';\n      case 'array':\n        return Array.isArray(value);\n      case 'object':\n        return typeof value === 'object' && value !== null && !Array.isArray(value);\n      case 'null':\n        return value === null;\n      default:\n        return true;\n    }\n  }\n\n  /**\n   * Format validation errors for display\n   */\n  formatErrors(errors: ValidationError[]): string {\n    return errors\n      .map((err) => {\n        let msg = `${err.field}: ${err.message}`;\n        if (err.constraint) {\n          msg += ` (${err.constraint})`;\n        }\n        return msg;\n      })\n      .join('\\n');\n  }\n}\n","/**\n * Enrichment Engine - Tiered AI-powered field enrichment\n *\n * Supports three processing modes:\n * 1. Tiered enrichment (new) - Groups fields by complexity tier (simple/medium/complex)\n *    and uses appropriate models (Haiku/Sonnet/Opus) for cost-effective processing\n * 2. Comprehensive enrichment - Single API call for all fields (legacy)\n * 3. Per-field enrichment - Individual API calls per field (legacy fallback)\n *\n * Features:\n * - Configurable tier-to-model mapping\n * - Batch processing per tier with configurable batch sizes\n * - Checkpoint support for resumable enrichment\n * - Rate limiting with automatic backoff\n * - Fallback chain on errors (complex -> medium -> simple)\n * - Cost estimation before running\n * - Progress reporting via callback\n */\n\nimport type {\n  EnrichmentConfig,\n  EnrichmentResult,\n  FieldMapping,\n  FieldMappingObject,\n  TransformContext,\n  AIProvider,\n  TierName,\n  TierConfig,\n  TieredFieldEnrichmentConfig,\n  FallbackConfig,\n  CostEstimate,\n  TierCostEstimate,\n  ProgressCallback,\n} from '../core/types.js';\nimport { OpenRouterProvider } from './providers/openrouter.js';\nimport { RateLimiter, DEFAULT_RATE_LIMIT_CONFIG } from './rate-limiter.js';\nimport { CheckpointManager } from './checkpoint-manager.js';\nimport {\n  EXERCISE_SYSTEM_PROMPT,\n  getExerciseEnrichmentPrompt,\n  FIELD_PROMPTS,\n  type ExerciseContext,\n} from './prompts/exercise-prompts.js';\nimport {\n  buildTierPrompt,\n  SYSTEM_PROMPTS,\n  type ExerciseContext as TierExerciseContext,\n} from './prompts/tier-prompts.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Exercise input for batch enrichment\n */\nexport interface ExerciseInput {\n  /** Unique identifier (exerciseId or slug) */\n  id: string;\n  /** Exercise slug */\n  slug: string;\n  /** Exercise name */\n  name: string;\n  /** Optional existing description */\n  description?: string;\n  /** Primary target muscles */\n  primaryTargets?: Array<{ id: string; name: string }>;\n  /** Required equipment */\n  requiredEquipment?: Array<{ id: string; name: string }>;\n  /** Any additional context */\n  [key: string]: unknown;\n}\n\n/**\n * Result of batch enrichment\n */\nexport interface BatchEnrichmentResult {\n  /** Successfully enriched exercises */\n  results: Map<string, Record<string, unknown>>;\n  /** IDs of exercises that failed */\n  failedIds: string[];\n  /** Total API calls made */\n  apiCalls: number;\n  /** Total tokens used */\n  tokensUsed: number;\n  /** Total duration in ms */\n  durationMs: number;\n  /** Errors encountered */\n  errors: Array<{ exerciseId: string; error: string; tier?: TierName }>;\n}\n\n/**\n * Options for batch enrichment\n */\nexport interface BatchEnrichmentOptions {\n  /** Resume from checkpoint if available */\n  resume?: boolean;\n  /** Run only specific tier */\n  tierFilter?: TierName;\n  /** Progress callback */\n  onProgress?: ProgressCallback;\n  /** Output directory for checkpoints */\n  outputDirectory?: string;\n  /** Schema $defs for validation context */\n  schemaDefs?: Record<string, unknown>;\n}\n\n/**\n * Internal batch for processing\n */\ninterface ProcessingBatch {\n  exercises: ExerciseInput[];\n  batchNumber: number;\n  totalBatches: number;\n}\n\n// ============================================================================\n// Default Configurations\n// ============================================================================\n\n/**\n * Default tier configurations\n */\nexport const DEFAULT_TIER_CONFIGS: Record<TierName, TierConfig> = {\n  simple: {\n    model: 'anthropic/claude-haiku-4.5',\n    temperature: 0.1,\n    maxTokens: 800,\n    batchSize: 10,\n    priority: 'speed',\n  },\n  medium: {\n    model: 'anthropic/claude-sonnet-4.5',\n    temperature: 0.1,\n    maxTokens: 1500,\n    batchSize: 3,\n    priority: 'balanced',\n  },\n  complex: {\n    model: 'anthropic/claude-opus-4.5',\n    temperature: 0.1,\n    maxTokens: 2000,\n    batchSize: 1,\n    priority: 'accuracy',\n  },\n};\n\n/**\n * Default fallback configuration\n */\nexport const DEFAULT_FALLBACK_CONFIG: FallbackConfig = {\n  retries: 1,\n  degradeModel: true,\n  useDefaults: true,\n  degradeChain: {\n    complex: 'medium',\n    medium: 'simple',\n    simple: null,\n  },\n};\n\n/**\n * Token estimates per tier for cost estimation\n */\nconst TOKEN_ESTIMATES = {\n  simple: { inputPerExercise: 80, outputPerExercise: 40 },\n  medium: { inputPerExercise: 333, outputPerExercise: 267 },\n  complex: { inputPerExercise: 600, outputPerExercise: 400 },\n};\n\n/**\n * Model pricing (per 1M tokens) - OpenRouter as of 2026-01\n */\nconst MODEL_PRICING: Record<string, { input: number; output: number }> = {\n  'anthropic/claude-haiku-4.5': { input: 0.25, output: 1.25 },\n  'anthropic/claude-sonnet-4.5': { input: 3.0, output: 15.0 },\n  'anthropic/claude-opus-4.5': { input: 15.0, output: 75.0 },\n  // Fallback for unknown models\n  default: { input: 3.0, output: 15.0 },\n};\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Format duration in milliseconds to human readable string\n */\nfunction formatDuration(ms: number): string {\n  if (ms < 1000) return `${ms}ms`;\n  if (ms < 60000) return `${(ms / 1000).toFixed(1)}s`;\n  const minutes = Math.floor(ms / 60000);\n  const seconds = Math.floor((ms % 60000) / 1000);\n  if (minutes < 60) return `${minutes}m ${seconds}s`;\n  const hours = Math.floor(minutes / 60);\n  const remainingMinutes = minutes % 60;\n  return `${hours}h ${remainingMinutes}m`;\n}\n\n\n\n// ============================================================================\n// EnrichmentEngine Class\n// ============================================================================\n\nexport class EnrichmentEngine {\n  private provider: AIProvider | null = null;\n  private config: EnrichmentConfig;\n  private rateLimiter: RateLimiter | null = null;\n\n  constructor(config: EnrichmentConfig = {}) {\n    this.config = {\n      enabled: true,\n      provider: 'openrouter',\n      model: 'anthropic/claude-3.5-sonnet',\n      ...config,\n    };\n\n    if (this.config.enabled) {\n      this.initializeProvider();\n    }\n  }\n\n  /**\n   * Initialize the AI provider\n   */\n  private initializeProvider(): void {\n    const apiKey = this.config.apiKey || process.env.OPENROUTER_API_KEY;\n\n    if (!apiKey) {\n      console.warn('No API key provided for AI enrichment. Enrichment will be skipped.');\n      return;\n    }\n\n    // Initialize rate limiter if tiered enrichment is configured\n    if (this.config.tiers || this.config.rateLimit) {\n      const rateLimitConfig = this.config.rateLimit || DEFAULT_RATE_LIMIT_CONFIG;\n      this.rateLimiter = new RateLimiter(rateLimitConfig);\n    }\n\n    switch (this.config.provider) {\n      case 'openrouter':\n        this.provider = new OpenRouterProvider({\n          apiKey,\n          model: this.config.model,\n          baseUrl: this.config.baseUrl,\n          rateLimiter: this.rateLimiter ?? undefined,\n          ...this.config.options,\n        });\n        break;\n      default:\n        console.warn(`Unknown AI provider: ${this.config.provider}`);\n    }\n  }\n\n  // ==========================================================================\n  // Tiered Batch Enrichment (New Primary API)\n  // ==========================================================================\n\n  /**\n   * Enrich multiple exercises using tiered processing\n   *\n   * This is the main entry point for batch enrichment. It:\n   * 1. Groups fields by tier based on configuration\n   * 2. Processes each tier in order (simple -> medium -> complex)\n   * 3. Batches exercises per tier's batchSize\n   * 4. Handles errors with fallback chain\n   * 5. Saves progress to checkpoint for resumability\n   *\n   * @param exercises - Array of exercises to enrich\n   * @param options - Enrichment options\n   * @returns Batch enrichment result\n   */\n  async enrichBatch(\n    exercises: ExerciseInput[],\n    options: BatchEnrichmentOptions = {}\n  ): Promise<BatchEnrichmentResult> {\n    const startTime = Date.now();\n    const results = new Map<string, Record<string, unknown>>();\n    const failedIds: string[] = [];\n    const errors: Array<{ exerciseId: string; error: string; tier?: TierName }> = [];\n    let apiCalls = 0;\n    let tokensUsed = 0;\n\n    // Early return if enrichment is disabled or no provider\n    const debug = process.env.DEBUG_ENRICHMENT === 'true';\n    if (debug) {\n      console.log(`[DEBUG enrichBatch] config.enabled: ${this.config.enabled}, provider: ${!!this.provider}`);\n      console.log(`[DEBUG enrichBatch] exercises count: ${exercises.length}`);\n    }\n    if (!this.config.enabled || !this.provider) {\n      if (debug) {\n        console.log(`[DEBUG enrichBatch] EARLY RETURN - enrichment disabled or no provider`);\n      }\n      return {\n        results,\n        failedIds,\n        apiCalls,\n        tokensUsed,\n        durationMs: Date.now() - startTime,\n        errors,\n      };\n    }\n\n    // Check if tiered enrichment is configured\n    if (debug) {\n      console.log(`[DEBUG enrichBatch] config.tiers: ${!!this.config.tiers}, config.fields: ${!!this.config.fields}`);\n    }\n    if (!this.config.tiers || !this.config.fields) {\n      // Fall back to comprehensive enrichment for each exercise\n      for (const exercise of exercises) {\n        try {\n          const result = await this.enrichComprehensive({\n            source: exercise as Record<string, unknown>,\n            target: {},\n            field: '',\n            registries: { muscles: [], equipment: [], muscleCategories: [] },\n            config: {} as TransformContext['config'],\n          });\n          if (result.success && result.data) {\n            results.set(exercise.id, result.data);\n          } else {\n            failedIds.push(exercise.id);\n            errors.push({ exerciseId: exercise.id, error: result.error || 'Unknown error' });\n          }\n        } catch (error) {\n          failedIds.push(exercise.id);\n          errors.push({\n            exerciseId: exercise.id,\n            error: error instanceof Error ? error.message : 'Unknown error',\n          });\n        }\n      }\n\n      return {\n        results,\n        failedIds,\n        apiCalls,\n        tokensUsed,\n        durationMs: Date.now() - startTime,\n        errors,\n      };\n    }\n\n    // Initialize checkpoint manager if configured\n    let checkpointManager: CheckpointManager | null = null;\n    const checkpointConfig = this.config.checkpoint;\n    const outputDir = options.outputDirectory || process.cwd();\n\n    if (checkpointConfig?.enabled) {\n      checkpointManager = new CheckpointManager(outputDir, checkpointConfig);\n\n      // Try to load existing checkpoint if resuming\n      if (options.resume && checkpointManager.exists()) {\n        const existingData = checkpointManager.load();\n        if (existingData) {\n          const validation = checkpointManager.validate(this.config);\n          if (validation.valid) {\n            // Pre-populate results from checkpoint\n            const checkpointResults = checkpointManager.getAllResults();\n            for (const [exerciseId, tierResults] of Object.entries(checkpointResults)) {\n              const merged: Record<string, unknown> = {};\n              for (const fields of Object.values(tierResults)) {\n                Object.assign(merged, fields);\n              }\n              results.set(exerciseId, merged);\n            }\n          } else {\n            console.warn(`Checkpoint invalid: ${validation.reason}. Starting fresh.`);\n            checkpointManager.clear();\n          }\n        }\n      }\n\n      // Initialize checkpoint if not loaded\n      if (!checkpointManager.getData()) {\n        checkpointManager.initialize({\n          inputFile: 'batch-enrichment',\n          totalExercises: exercises.length,\n          config: this.config,\n        });\n      }\n    }\n\n    // Get completed IDs from checkpoint\n    const completedIds = new Set(checkpointManager?.getCompletedIds() ?? []);\n\n    // Filter exercises to process\n    const exercisesToProcess = exercises.filter((e) => !completedIds.has(e.id));\n\n    if (exercisesToProcess.length === 0) {\n      return {\n        results,\n        failedIds,\n        apiCalls,\n        tokensUsed,\n        durationMs: Date.now() - startTime,\n        errors,\n      };\n    }\n\n    // Group fields by tier\n    const fieldsByTier = this.groupFieldsByTier();\n\n    // Determine tiers to process\n    const tiersToProcess: TierName[] = options.tierFilter\n      ? [options.tierFilter]\n      : (['simple', 'medium', 'complex'] as TierName[]);\n\n    // Process each tier\n    if (debug) {\n      console.log(`[DEBUG enrichBatch] tiersToProcess: ${tiersToProcess.join(', ')}`);\n      console.log(`[DEBUG enrichBatch] fieldsByTier keys: ${[...fieldsByTier.keys()].join(', ')}`);\n    }\n    for (const tier of tiersToProcess) {\n      const tierFields = fieldsByTier.get(tier);\n      if (debug) {\n        console.log(`[DEBUG enrichBatch] tier: ${tier}, fields: ${tierFields ? [...tierFields.keys()].join(', ') : 'none'}`);\n      }\n      if (!tierFields || tierFields.size === 0) {\n        if (debug) {\n          console.log(`[DEBUG enrichBatch] SKIPPING tier ${tier} - no fields`);\n        }\n        continue;\n      }\n\n      const tierConfig = this.getTierConfig(tier);\n      const batches = this.createBatches(exercisesToProcess, tierConfig.batchSize);\n\n      // Update checkpoint with current tier\n      if (checkpointManager) {\n        const data = checkpointManager.getData();\n        if (data) {\n          data.currentTier = tier;\n        }\n      }\n\n      for (const batch of batches) {\n        try {\n          const batchResult = await this.processTierBatch(\n            tier,\n            tierConfig,\n            batch,\n            tierFields,\n            options.onProgress,\n            checkpointManager\n          );\n\n          // Merge batch results\n          if (debug) {\n            console.log(`[DEBUG enrichBatch] batchResult.results.size: ${batchResult.results.size}, apiCalls: ${batchResult.apiCalls}`);\n          }\n          for (const [exerciseId, fields] of batchResult.results) {\n            const existing = results.get(exerciseId) || {};\n            results.set(exerciseId, { ...existing, ...fields });\n            if (debug) {\n              console.log(`[DEBUG enrichBatch] Merged result for ${exerciseId}`);\n            }\n\n            // Update checkpoint\n            if (checkpointManager) {\n              checkpointManager.update({\n                exerciseId,\n                success: true,\n                currentTier: tier,\n                results: { [tier]: fields },\n              });\n            }\n          }\n\n          // Track failures\n          for (const id of batchResult.failedIds) {\n            if (!failedIds.includes(id)) {\n              failedIds.push(id);\n            }\n          }\n\n          // Track stats\n          apiCalls += batchResult.apiCalls;\n          tokensUsed += batchResult.tokensUsed;\n          errors.push(...batchResult.errors);\n          if (debug) {\n            console.log(`[DEBUG enrichBatch] Updated totals - apiCalls: ${apiCalls}, tokensUsed: ${tokensUsed}`);\n          }\n        } catch (error) {\n          // Batch-level error - mark all exercises in batch as failed\n          for (const exercise of batch.exercises) {\n            if (!failedIds.includes(exercise.id)) {\n              failedIds.push(exercise.id);\n              errors.push({\n                exerciseId: exercise.id,\n                error: error instanceof Error ? error.message : 'Unknown error',\n                tier,\n              });\n            }\n          }\n        }\n      }\n    }\n\n    // Clear checkpoint on successful completion\n    if (checkpointManager && failedIds.length === 0) {\n      checkpointManager.clear();\n    } else if (checkpointManager) {\n      checkpointManager.forceSave();\n    }\n\n    return {\n      results,\n      failedIds,\n      apiCalls,\n      tokensUsed,\n      durationMs: Date.now() - startTime,\n      errors,\n    };\n  }\n\n  /**\n   * Estimate cost for batch enrichment\n   */\n  estimateCost(exerciseCount: number): CostEstimate {\n    const tiers = this.config.tiers || DEFAULT_TIER_CONFIGS;\n    const fields = this.config.fields || {};\n\n    // Count fields per tier\n    const fieldCounts: Record<TierName, number> = { simple: 0, medium: 0, complex: 0 };\n    for (const fieldConfig of Object.values(fields)) {\n      fieldCounts[fieldConfig.tier]++;\n    }\n\n    const tierEstimates: Record<TierName, TierCostEstimate> = {} as Record<\n      TierName,\n      TierCostEstimate\n    >;\n    let totalApiCalls = 0;\n    let totalInputTokens = 0;\n    let totalOutputTokens = 0;\n    let totalCost = 0;\n\n    for (const tierName of ['simple', 'medium', 'complex'] as TierName[]) {\n      const tierConfig = tiers[tierName] || DEFAULT_TIER_CONFIGS[tierName];\n      const tokenEstimate = TOKEN_ESTIMATES[tierName];\n      const pricing = MODEL_PRICING[tierConfig.model] || MODEL_PRICING['default'];\n\n      const apiCalls = Math.ceil(exerciseCount / tierConfig.batchSize);\n      const inputTokens = exerciseCount * tokenEstimate.inputPerExercise;\n      const outputTokens = exerciseCount * tokenEstimate.outputPerExercise;\n      const cost =\n        (inputTokens / 1_000_000) * pricing.input + (outputTokens / 1_000_000) * pricing.output;\n\n      tierEstimates[tierName] = {\n        tier: tierName,\n        model: tierConfig.model,\n        batchSize: tierConfig.batchSize,\n        apiCalls,\n        inputTokens,\n        outputTokens,\n        cost: Math.round(cost * 100) / 100,\n      };\n\n      totalApiCalls += apiCalls;\n      totalInputTokens += inputTokens;\n      totalOutputTokens += outputTokens;\n      totalCost += cost;\n    }\n\n    // Estimate time (assuming 50 requests/minute rate limit)\n    const requestsPerMinute = this.config.rateLimit?.requestsPerMinute || 50;\n    const estimatedMinutes = totalApiCalls / requestsPerMinute;\n\n    return {\n      tiers: tierEstimates,\n      total: {\n        apiCalls: totalApiCalls,\n        inputTokens: totalInputTokens,\n        outputTokens: totalOutputTokens,\n        cost: Math.round(totalCost * 100) / 100,\n      },\n      estimatedTime: {\n        minutes: Math.round(estimatedMinutes),\n        formatted: formatDuration(estimatedMinutes * 60000),\n      },\n      disclaimer:\n        'Costs are estimates based on average token usage. Actual costs may vary by ±20%.',\n    };\n  }\n\n  /**\n   * Group configured fields by their tier\n   */\n  groupFieldsByTier(): Map<TierName, Map<string, TieredFieldEnrichmentConfig>> {\n    const result = new Map<TierName, Map<string, TieredFieldEnrichmentConfig>>();\n    result.set('simple', new Map());\n    result.set('medium', new Map());\n    result.set('complex', new Map());\n\n    if (!this.config.fields) {\n      return result;\n    }\n\n    for (const [fieldPath, fieldConfig] of Object.entries(this.config.fields)) {\n      const tierMap = result.get(fieldConfig.tier);\n      if (tierMap) {\n        tierMap.set(fieldPath, fieldConfig);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Get tier configuration, merging with defaults\n   */\n  getTierConfig(tier: TierName): TierConfig {\n    const defaultConfig = DEFAULT_TIER_CONFIGS[tier];\n    const customConfig = this.config.tiers?.[tier];\n\n    if (!customConfig) {\n      return defaultConfig;\n    }\n\n    return { ...defaultConfig, ...customConfig };\n  }\n\n  /**\n   * Get fallback configuration\n   */\n  getFallbackConfig(): FallbackConfig {\n    return this.config.fallback || DEFAULT_FALLBACK_CONFIG;\n  }\n\n  /**\n   * Create batches of exercises for processing\n   */\n  private createBatches(exercises: ExerciseInput[], batchSize: number): ProcessingBatch[] {\n    const batches: ProcessingBatch[] = [];\n    const totalBatches = Math.ceil(exercises.length / batchSize);\n\n    for (let i = 0; i < exercises.length; i += batchSize) {\n      batches.push({\n        exercises: exercises.slice(i, i + batchSize),\n        batchNumber: batches.length + 1,\n        totalBatches,\n      });\n    }\n\n    return batches;\n  }\n\n  /**\n   * Process a batch of exercises for a specific tier\n   */\n  private async processTierBatch(\n    tier: TierName,\n    tierConfig: TierConfig,\n    batch: ProcessingBatch,\n    fields: Map<string, TieredFieldEnrichmentConfig>,\n    onProgress?: ProgressCallback,\n    _checkpointManager?: CheckpointManager | null\n  ): Promise<BatchEnrichmentResult> {\n    const startTime = Date.now();\n    const results = new Map<string, Record<string, unknown>>();\n    const failedIds: string[] = [];\n    const errors: Array<{ exerciseId: string; error: string; tier?: TierName }> = [];\n    let apiCalls = 0;\n    let tokensUsed = 0;\n\n    if (!this.provider) {\n      return {\n        results,\n        failedIds: batch.exercises.map((e) => e.id),\n        apiCalls: 0,\n        tokensUsed: 0,\n        durationMs: 0,\n        errors: [{ exerciseId: 'batch', error: 'No AI provider available', tier }],\n      };\n    }\n\n    // Get unique prompt IDs for this tier's fields\n    const promptIds = new Set<string>();\n    for (const fieldConfig of fields.values()) {\n      promptIds.add(fieldConfig.prompt);\n    }\n\n    // Convert exercises to tier prompt context format\n    const exerciseContexts: TierExerciseContext[] = batch.exercises.map((e) => ({\n      name: e.name,\n      slug: e.slug,\n      description: e.description,\n      primaryTargets: e.primaryTargets,\n      requiredEquipment: e.requiredEquipment,\n      exerciseType: e.exerciseType as string | undefined,\n    }));\n\n    // Process each prompt for this tier\n    const debug = process.env.DEBUG_ENRICHMENT === 'true';\n    if (debug) {\n      console.log(`[DEBUG processTierBatch] tier: ${tier}, promptIds: ${[...promptIds].join(', ')}`);\n    }\n    for (const promptId of promptIds) {\n      const builtPrompt = buildTierPrompt(tier, promptId, exerciseContexts);\n      if (!builtPrompt) {\n        if (debug) {\n          console.log(`[DEBUG processTierBatch] NO PROMPT BUILT for promptId: ${promptId}`);\n        }\n        continue;\n      }\n      if (debug) {\n        console.log(`[DEBUG processTierBatch] Built prompt for promptId: ${promptId}`);\n      }\n\n      // Report progress\n      if (onProgress) {\n        const exercise = batch.exercises[0];\n        onProgress({\n          exercise: {\n            current: batch.batchNumber,\n            total: batch.totalBatches,\n            name: exercise.name,\n            slug: exercise.slug,\n          },\n          tier: {\n            name: tier,\n            status: 'processing',\n            batchNumber: batch.batchNumber,\n            totalBatches: batch.totalBatches,\n          },\n          overall: {\n            percentage: (batch.batchNumber / batch.totalBatches) * 100,\n            elapsedMs: Date.now() - startTime,\n            elapsedFormatted: formatDuration(Date.now() - startTime),\n            remainingMs: 0,\n            remainingFormatted: 'calculating...',\n            apiCalls,\n            errors: errors.length,\n          },\n        });\n      }\n\n      try {\n        // Switch model for this tier\n        if (this.provider instanceof OpenRouterProvider) {\n          (this.provider as OpenRouterProvider).setModel(tierConfig.model);\n        }\n\n        if (debug) {\n          console.log(`[DEBUG processTierBatch] Calling API for promptId: ${promptId}, model: ${tierConfig.model}`);\n        }\n\n        // Make API call with retry/fallback handling\n        const response = await this.callWithFallback(tier, builtPrompt, tierConfig);\n        apiCalls++;\n        tokensUsed += response.tokensUsed || 0;\n\n        if (debug) {\n          console.log(`[DEBUG processTierBatch] API response received, tokens: ${response.tokensUsed}`);\n          console.log(`[DEBUG processTierBatch] Response content (first 300 chars): ${response.content.slice(0, 300)}`);\n        }\n\n        // Parse and distribute results\n        const parsedResults = this.parseResponse(response.content, batch.exercises, promptId);\n\n        if (debug) {\n          console.log(`[DEBUG processTierBatch] Parsed results count: ${parsedResults.size}`);\n        }\n\n        for (const [exerciseId, fieldValues] of parsedResults) {\n          const existing = results.get(exerciseId) || {};\n          results.set(exerciseId, { ...existing, ...fieldValues });\n          if (debug) {\n            console.log(`[DEBUG processTierBatch] Set result for ${exerciseId}: ${JSON.stringify(fieldValues).slice(0, 200)}`);\n          }\n        }\n      } catch (error) {\n        if (debug) {\n          console.error(`[DEBUG processTierBatch] ERROR for promptId ${promptId}:`, error);\n        }\n        // Mark batch as failed for this prompt\n        for (const exercise of batch.exercises) {\n          if (!failedIds.includes(exercise.id)) {\n            failedIds.push(exercise.id);\n          }\n          errors.push({\n            exerciseId: exercise.id,\n            error: error instanceof Error ? error.message : 'Unknown error',\n            tier,\n          });\n        }\n      }\n    }\n\n    return {\n      results,\n      failedIds,\n      apiCalls,\n      tokensUsed,\n      durationMs: Date.now() - startTime,\n      errors,\n    };\n  }\n\n  /**\n   * Call API with fallback on errors\n   */\n  private async callWithFallback(\n    tier: TierName,\n    prompt: { system: string; user: string },\n    tierConfig: TierConfig,\n    attemptNumber: number = 0\n  ): Promise<{ content: string; tokensUsed?: number }> {\n    const fallbackConfig = this.getFallbackConfig();\n\n    if (!this.provider) {\n      throw new Error('No AI provider available');\n    }\n\n    try {\n      const response = await this.provider.complete(prompt.user, {\n        systemPrompt: prompt.system,\n        temperature: tierConfig.temperature,\n        maxTokens: tierConfig.maxTokens,\n      });\n\n      return { content: response.content, tokensUsed: response.tokensUsed };\n    } catch (error) {\n      // Check if we should retry\n      if (attemptNumber < fallbackConfig.retries) {\n        return this.callWithFallback(tier, prompt, tierConfig, attemptNumber + 1);\n      }\n\n      // Check if we should degrade to a lower tier\n      if (fallbackConfig.degradeModel) {\n        const degradeTier = fallbackConfig.degradeChain[tier];\n        if (degradeTier) {\n          const degradeConfig = this.getTierConfig(degradeTier);\n\n          // Switch model\n          if (this.provider instanceof OpenRouterProvider) {\n            (this.provider as OpenRouterProvider).setModel(degradeConfig.model);\n          }\n\n          // Use degraded tier's system prompt\n          const degradedPrompt = {\n            system: SYSTEM_PROMPTS[degradeTier],\n            user: prompt.user,\n          };\n\n          return this.callWithFallback(degradeTier, degradedPrompt, degradeConfig, 0);\n        }\n      }\n\n      // Re-throw if no fallback available\n      throw error;\n    }\n  }\n\n  /**\n   * Parse API response and map to exercises\n   */\n  private parseResponse(\n    content: string,\n    exercises: ExerciseInput[],\n    promptId: string\n  ): Map<string, Record<string, unknown>> {\n    const results = new Map<string, Record<string, unknown>>();\n\n    // Debug logging\n    const debug = process.env.DEBUG_ENRICHMENT === 'true';\n    if (debug) {\n      console.log(`\\n[DEBUG parseResponse] promptId: ${promptId}`);\n      console.log(`[DEBUG parseResponse] exercises: ${exercises.map(e => e.slug).join(', ')}`);\n      console.log(`[DEBUG parseResponse] raw content (first 500 chars):\\n${content.slice(0, 500)}`);\n    }\n\n    try {\n      // Extract JSON from response\n      let jsonStr = content.trim();\n      const codeBlockMatch = content.match(/```(?:json)?\\s*([\\s\\S]*?)\\s*```/);\n      if (codeBlockMatch) {\n        jsonStr = codeBlockMatch[1];\n        if (debug) {\n          console.log(`[DEBUG parseResponse] extracted from code block`);\n        }\n      }\n\n      if (debug) {\n        console.log(`[DEBUG parseResponse] jsonStr to parse (first 500 chars):\\n${jsonStr.slice(0, 500)}`);\n      }\n\n      const parsed = JSON.parse(jsonStr);\n\n      if (debug) {\n        console.log(`[DEBUG parseResponse] parsed successfully, keys: ${Object.keys(parsed).join(', ')}`);\n        if (parsed.results) {\n          console.log(`[DEBUG parseResponse] results array length: ${parsed.results.length}`);\n          console.log(`[DEBUG parseResponse] results slugs: ${parsed.results.map((r: Record<string, unknown>) => r.slug).join(', ')}`);\n        }\n      }\n\n      // Handle batch response format\n      if (parsed.results && Array.isArray(parsed.results)) {\n        for (const result of parsed.results) {\n          const slug = result.slug;\n          const exercise = exercises.find((e) => e.slug === slug);\n          if (debug) {\n            console.log(`[DEBUG parseResponse] looking for slug \"${slug}\" -> found: ${!!exercise}`);\n          }\n          if (exercise) {\n            // Remove slug from result and map fields\n            const { slug: _slug, ...fields } = result;\n            const mapped = this.mapFieldsFromPrompt(promptId, fields);\n            if (debug) {\n              console.log(`[DEBUG parseResponse] mapped fields for ${exercise.id}:`, JSON.stringify(mapped, null, 2));\n            }\n            results.set(exercise.id, mapped);\n          }\n        }\n      } else {\n        // Single exercise response (complex tier)\n        const exercise = exercises[0];\n        if (exercise) {\n          const mapped = this.mapFieldsFromPrompt(promptId, parsed);\n          if (debug) {\n            console.log(`[DEBUG parseResponse] single exercise mapped:`, JSON.stringify(mapped, null, 2));\n          }\n          results.set(exercise.id, mapped);\n        }\n      }\n    } catch (err) {\n      // If parsing fails, return empty results\n      console.warn('Failed to parse API response:', content.slice(0, 200));\n      if (debug) {\n        console.error(`[DEBUG parseResponse] parse error:`, err);\n      }\n    }\n\n    if (debug) {\n      console.log(`[DEBUG parseResponse] final results count: ${results.size}`);\n    }\n\n    return results;\n  }\n\n  /**\n   * Map parsed fields to proper FDS paths based on prompt type\n   */\n  private mapFieldsFromPrompt(\n    promptId: string,\n    fields: Record<string, unknown>\n  ): Record<string, unknown> {\n    const mapped: Record<string, unknown> = {};\n\n    switch (promptId) {\n      case 'description':\n        if (fields.description) {\n          this.setNestedValue(mapped, 'canonical.description', fields.description);\n        }\n        break;\n\n      case 'aliases':\n        if (fields.aliases) {\n          this.setNestedValue(mapped, 'canonical.aliases', fields.aliases);\n        }\n        break;\n\n      case 'classification-simple':\n        if (fields.exerciseType) {\n          this.setNestedValue(mapped, 'classification.exerciseType', fields.exerciseType);\n        }\n        if (fields.level) {\n          this.setNestedValue(mapped, 'classification.level', fields.level);\n        }\n        if (fields.unilateral !== undefined) {\n          this.setNestedValue(mapped, 'classification.unilateral', fields.unilateral);\n        }\n        break;\n\n      case 'metrics':\n        if (fields.primary) {\n          this.setNestedValue(mapped, 'metrics.primary', fields.primary);\n        }\n        if (fields.secondary) {\n          this.setNestedValue(mapped, 'metrics.secondary', fields.secondary);\n        }\n        break;\n\n      case 'equipment':\n        if (fields.optional) {\n          this.setNestedValue(mapped, 'equipment.optional', fields.optional);\n        }\n        break;\n\n      case 'constraints':\n        if (fields.contraindications) {\n          this.setNestedValue(mapped, 'constraints.contraindications', fields.contraindications);\n        }\n        if (fields.prerequisites) {\n          this.setNestedValue(mapped, 'constraints.prerequisites', fields.prerequisites);\n        }\n        if (fields.progressions) {\n          this.setNestedValue(mapped, 'constraints.progressions', fields.progressions);\n        }\n        if (fields.regressions) {\n          this.setNestedValue(mapped, 'constraints.regressions', fields.regressions);\n        }\n        break;\n\n      case 'relations':\n        if (fields.relations) {\n          this.setNestedValue(mapped, 'relations', fields.relations);\n        }\n        break;\n\n      case 'biomechanics':\n        if (fields.movement) {\n          this.setNestedValue(mapped, 'classification.movement', fields.movement);\n        }\n        if (fields.mechanics) {\n          this.setNestedValue(mapped, 'classification.mechanics', fields.mechanics);\n        }\n        if (fields.force) {\n          this.setNestedValue(mapped, 'classification.force', fields.force);\n        }\n        if (fields.kineticChain) {\n          this.setNestedValue(mapped, 'classification.kineticChain', fields.kineticChain);\n        }\n        if (fields.tags) {\n          this.setNestedValue(mapped, 'classification.tags', fields.tags);\n        }\n        if (fields.secondary) {\n          this.setNestedValue(mapped, 'targets.secondary', fields.secondary);\n        }\n        break;\n\n      default:\n        // Unknown prompt - copy fields as-is\n        Object.assign(mapped, fields);\n    }\n\n    return mapped;\n  }\n\n  // ==========================================================================\n  // Legacy API (Backwards Compatible)\n  // ==========================================================================\n\n  /**\n   * Enrich mapped data with AI-generated content\n   * Uses comprehensive single-call enrichment for efficiency\n   * @deprecated Use enrichBatch for new code\n   */\n  async enrich(\n    mapped: Record<string, unknown>,\n    mappings: Record<string, FieldMapping>,\n    context: TransformContext\n  ): Promise<EnrichmentResult> {\n    if (!this.provider || !this.config.enabled) {\n      return { success: true, data: {} };\n    }\n\n    // Check if any fields need enrichment\n    const fieldsNeedingEnrichment: string[] = [];\n    for (const [field, mapping] of Object.entries(mappings)) {\n      const mappingObj = this.normalizeMapping(mapping);\n      if (mappingObj.enrichment?.enabled) {\n        const shouldEnrich = this.shouldEnrich(mapped, field, mappingObj.enrichment);\n        if (shouldEnrich && !this.config.skipFields?.includes(field)) {\n          fieldsNeedingEnrichment.push(field);\n        }\n      }\n    }\n\n    if (fieldsNeedingEnrichment.length === 0) {\n      return { success: true, data: {} };\n    }\n\n    // Use comprehensive single-call enrichment\n    try {\n      const result = await this.enrichComprehensive(context);\n      if (result.success && result.data) {\n        return result;\n      }\n    } catch (error) {\n      console.warn('Comprehensive enrichment failed, falling back to per-field:', error);\n    }\n\n    // Fallback to per-field enrichment if comprehensive fails\n    return this.enrichPerField(mapped, mappings, context);\n  }\n\n  /**\n   * Comprehensive enrichment - single API call for all fields\n   */\n  private async enrichComprehensive(context: TransformContext): Promise<EnrichmentResult> {\n    if (!this.provider) {\n      return { success: false, error: 'No AI provider available' };\n    }\n\n    const exerciseContext: ExerciseContext = {\n      name: String(context.source.name || 'Unknown Exercise'),\n      target: context.source.target as string | undefined,\n      equipment: context.source.equipment as string | undefined,\n      bodyPart: context.source.bodyPart as string | undefined,\n    };\n\n    const prompt = getExerciseEnrichmentPrompt(exerciseContext);\n\n    try {\n      const result = await this.provider.completeJSON<Record<string, unknown>>(prompt, undefined, {\n        systemPrompt: EXERCISE_SYSTEM_PROMPT,\n        temperature: this.config.options?.temperature ?? 0.3,\n        maxTokens: this.config.options?.maxTokens ?? 4000,\n      });\n\n      // Map the comprehensive result to the expected structure\n      const enrichedData: Record<string, unknown> = {};\n\n      // Map description and aliases\n      if (result.description) {\n        this.setNestedValue(enrichedData, 'canonical.description', result.description);\n      }\n      if (result.aliases) {\n        this.setNestedValue(enrichedData, 'canonical.aliases', result.aliases);\n      }\n      if (result.localized) {\n        this.setNestedValue(enrichedData, 'canonical.localized', result.localized);\n      }\n\n      // Map classification\n      if (result.classification) {\n        const classification = result.classification as Record<string, unknown>;\n        for (const [key, value] of Object.entries(classification)) {\n          this.setNestedValue(enrichedData, `classification.${key}`, value);\n        }\n      }\n\n      // Map targets\n      if (result.targets) {\n        const targets = result.targets as Record<string, unknown>;\n        if (targets.secondary) {\n          this.setNestedValue(enrichedData, 'targets.secondary', targets.secondary);\n        }\n      }\n\n      // Map equipment\n      if (result.equipment) {\n        const equipment = result.equipment as Record<string, unknown>;\n        if (equipment.optional) {\n          this.setNestedValue(enrichedData, 'equipment.optional', equipment.optional);\n        }\n      }\n\n      // Map constraints\n      if (result.constraints) {\n        const constraints = result.constraints as Record<string, unknown>;\n        for (const [key, value] of Object.entries(constraints)) {\n          this.setNestedValue(enrichedData, `constraints.${key}`, value);\n        }\n      }\n\n      // Map relations\n      if (result.relations) {\n        this.setNestedValue(enrichedData, 'relations', result.relations);\n      }\n\n      // Map metrics\n      if (result.metrics) {\n        const metrics = result.metrics as Record<string, unknown>;\n        if (metrics.primary) {\n          this.setNestedValue(enrichedData, 'metrics.primary', metrics.primary);\n        }\n        if (metrics.secondary) {\n          this.setNestedValue(enrichedData, 'metrics.secondary', metrics.secondary);\n        }\n      }\n\n      return {\n        success: true,\n        data: enrichedData,\n        tokensUsed: 0,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      };\n    }\n  }\n\n  /**\n   * Per-field enrichment fallback\n   */\n  private async enrichPerField(\n    mapped: Record<string, unknown>,\n    mappings: Record<string, FieldMapping>,\n    context: TransformContext\n  ): Promise<EnrichmentResult> {\n    const enrichedData: Record<string, unknown> = {};\n    let totalTokens = 0;\n\n    for (const [field, mapping] of Object.entries(mappings)) {\n      const mappingObj = this.normalizeMapping(mapping);\n\n      if (!mappingObj.enrichment?.enabled) {\n        continue;\n      }\n\n      const shouldEnrich = this.shouldEnrich(mapped, field, mappingObj.enrichment);\n      if (!shouldEnrich || this.config.skipFields?.includes(field)) {\n        continue;\n      }\n\n      try {\n        const result = await this.enrichField(field, mappingObj, context);\n\n        if (result.success && result.data) {\n          if (mappingObj.enrichment.fields) {\n            for (const subField of mappingObj.enrichment.fields) {\n              const fullPath = field.includes('.') ? field : `${field}.${subField}`;\n              if (result.data[subField] !== undefined) {\n                this.setNestedValue(enrichedData, fullPath, result.data[subField]);\n              }\n            }\n          } else {\n            this.setNestedValue(enrichedData, field, result.data);\n          }\n          totalTokens += result.tokensUsed || 0;\n        }\n      } catch (error) {\n        console.warn(`Failed to enrich field ${field}:`, error);\n        if (mappingObj.enrichment.fallback !== undefined) {\n          this.setNestedValue(enrichedData, field, mappingObj.enrichment.fallback);\n        }\n      }\n    }\n\n    return {\n      success: true,\n      data: enrichedData,\n      tokensUsed: totalTokens,\n    };\n  }\n\n  /**\n   * Check if a field should be enriched\n   */\n  private shouldEnrich(\n    mapped: Record<string, unknown>,\n    field: string,\n    config: NonNullable<FieldMappingObject['enrichment']>\n  ): boolean {\n    const when = config.when || 'missing';\n    const currentValue = this.getNestedValue(mapped, field);\n\n    switch (when) {\n      case 'always':\n        return true;\n      case 'missing':\n        return currentValue === undefined;\n      case 'empty':\n        return currentValue === undefined || currentValue === null || currentValue === '';\n      case 'notFound':\n        return currentValue === undefined || currentValue === null;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Enrich a single field\n   */\n  private async enrichField(\n    field: string,\n    mapping: FieldMappingObject,\n    context: TransformContext\n  ): Promise<EnrichmentResult> {\n    if (!this.provider) {\n      return { success: false, error: 'No AI provider available' };\n    }\n\n    const enrichmentConfig = mapping.enrichment!;\n\n    // Build context for the prompt\n    const promptContext: Record<string, unknown> = {};\n    if (enrichmentConfig.context) {\n      for (const contextField of enrichmentConfig.context) {\n        promptContext[contextField] =\n          this.getNestedValue(context.source, contextField) ??\n          this.getNestedValue(context.target, contextField);\n      }\n    }\n\n    // Get the prompt template\n    const prompt = this.buildPrompt(field, enrichmentConfig.prompt, promptContext);\n\n    try {\n      const result = await this.provider.completeJSON(prompt, undefined, {\n        systemPrompt: this.getSystemPrompt(),\n        temperature: this.config.options?.temperature ?? 0.3,\n        maxTokens: this.config.options?.maxTokens ?? 2000,\n      });\n      return {\n        success: true,\n        data: result as Record<string, unknown>,\n        tokensUsed: 0, // Would be set by provider\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Unknown error',\n      };\n    }\n  }\n\n  /**\n   * Build the prompt for AI enrichment\n   */\n  private buildPrompt(\n    _field: string,\n    promptName: string | undefined,\n    context: Record<string, unknown>\n  ): string {\n    // Build exercise context\n    const exerciseContext: ExerciseContext = {\n      name: String(context.name || context['canonical.name'] || 'Unknown Exercise'),\n      target: context.target as string | undefined,\n      equipment: context.equipment as string | undefined,\n      bodyPart: context.bodyPart as string | undefined,\n    };\n\n    // Use specific prompt template if available\n    if (promptName && FIELD_PROMPTS[promptName]) {\n      return FIELD_PROMPTS[promptName](exerciseContext);\n    }\n\n    // Fall back to comprehensive enrichment prompt\n    return getExerciseEnrichmentPrompt(exerciseContext);\n  }\n\n  /**\n   * Get the system prompt for enrichment\n   */\n  getSystemPrompt(): string {\n    return EXERCISE_SYSTEM_PROMPT;\n  }\n\n  /**\n   * Check if engine is enabled\n   */\n  isEnabled(): boolean {\n    return this.config.enabled === true && this.provider !== null;\n  }\n\n  /**\n   * Check if tiered enrichment is configured\n   */\n  isTieredEnabled(): boolean {\n    return !!(this.config.tiers && this.config.fields);\n  }\n\n  /**\n   * Get the provider (for testing)\n   */\n  getProvider(): AIProvider | null {\n    return this.provider;\n  }\n\n  /**\n   * Get the rate limiter (for testing)\n   */\n  getRateLimiter(): RateLimiter | null {\n    return this.rateLimiter;\n  }\n\n  // ==========================================================================\n  // Utility Methods\n  // ==========================================================================\n\n  /**\n   * Normalize mapping to object form\n   */\n  private normalizeMapping(mapping: FieldMapping): FieldMappingObject {\n    if (typeof mapping === 'string') {\n      return { from: mapping };\n    }\n    return mapping;\n  }\n\n  /**\n   * Get nested value from object\n   */\n  private getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n    const parts = path.split('.');\n    let current: unknown = obj;\n\n    for (const part of parts) {\n      if (current === null || current === undefined) {\n        return undefined;\n      }\n      current = (current as Record<string, unknown>)[part];\n    }\n\n    return current;\n  }\n\n  /**\n   * Set nested value in object\n   */\n  private setNestedValue(obj: Record<string, unknown>, path: string, value: unknown): void {\n    const parts = path.split('.');\n    let current = obj;\n\n    for (let i = 0; i < parts.length - 1; i++) {\n      const part = parts[i];\n      if (!(part in current)) {\n        current[part] = {};\n      }\n      current = current[part] as Record<string, unknown>;\n    }\n\n    current[parts[parts.length - 1]] = value;\n  }\n}\n","/**\n * OpenRouter AI Provider\n *\n * Supports rate limiting with automatic backoff on 429 responses.\n */\n\nimport type { AIProvider, AIProviderOptions, AIResponse } from '../../core/types.js';\nimport type { RateLimiter } from '../rate-limiter.js';\n\n/**\n * OpenRouter provider configuration\n */\nexport interface OpenRouterConfig {\n  /** API key for OpenRouter */\n  apiKey: string;\n  /** Model to use (default: anthropic/claude-3.5-sonnet) */\n  model?: string;\n  /** Base URL for API (default: https://openrouter.ai/api/v1) */\n  baseUrl?: string;\n  /** Default temperature (default: 0.3) */\n  temperature?: number;\n  /** Default max tokens (default: 1024) */\n  maxTokens?: number;\n  /** Max retries on failure (default: 3) */\n  maxRetries?: number;\n  /** Base retry delay in ms (default: 1000) */\n  retryDelay?: number;\n  /** Optional rate limiter for request throttling */\n  rateLimiter?: RateLimiter;\n}\n\n/**\n * Error thrown when rate limit is hit (429 response)\n */\nexport class RateLimitError extends Error {\n  readonly statusCode = 429;\n  readonly retryAfter: number | null;\n\n  constructor(message: string, retryAfter: number | null = null) {\n    super(message);\n    this.name = 'RateLimitError';\n    this.retryAfter = retryAfter;\n  }\n}\n\n/**\n * Error thrown for API errors\n */\nexport class OpenRouterAPIError extends Error {\n  readonly statusCode: number;\n\n  constructor(message: string, statusCode: number) {\n    super(message);\n    this.name = 'OpenRouterAPIError';\n    this.statusCode = statusCode;\n  }\n}\n\nexport class OpenRouterProvider implements AIProvider {\n  name = 'openrouter';\n\n  private apiKey: string;\n  private model: string;\n  private baseUrl: string;\n  private defaultTemperature: number;\n  private defaultMaxTokens: number;\n  private maxRetries: number;\n  private retryDelay: number;\n  private rateLimiter: RateLimiter | null;\n\n  constructor(config: OpenRouterConfig) {\n    this.apiKey = config.apiKey;\n    this.model = config.model || 'anthropic/claude-3.5-sonnet';\n    this.baseUrl = config.baseUrl || 'https://openrouter.ai/api/v1';\n    this.defaultTemperature = config.temperature ?? 0.3;\n    this.defaultMaxTokens = config.maxTokens ?? 1024;\n    this.maxRetries = config.maxRetries ?? 3;\n    this.retryDelay = config.retryDelay ?? 1000;\n    this.rateLimiter = config.rateLimiter ?? null;\n  }\n\n  /**\n   * Set or update the rate limiter\n   */\n  setRateLimiter(rateLimiter: RateLimiter | null): void {\n    this.rateLimiter = rateLimiter;\n  }\n\n  /**\n   * Get the current rate limiter (for testing/monitoring)\n   */\n  getRateLimiter(): RateLimiter | null {\n    return this.rateLimiter;\n  }\n\n  /**\n   * Get the current model\n   */\n  getModel(): string {\n    return this.model;\n  }\n\n  /**\n   * Set the model for subsequent requests\n   */\n  setModel(model: string): void {\n    this.model = model;\n  }\n\n  /**\n   * Send a completion request with rate limiting and 429 handling\n   */\n  async complete(prompt: string, options: AIProviderOptions = {}): Promise<AIResponse> {\n    const messages = [\n      ...(options.systemPrompt ? [{ role: 'system', content: options.systemPrompt }] : []),\n      { role: 'user', content: prompt },\n    ];\n\n    let lastError: Error | null = null;\n\n    for (let attempt = 0; attempt < this.maxRetries; attempt++) {\n      try {\n        // Acquire rate limit permission before making request\n        if (this.rateLimiter) {\n          await this.rateLimiter.acquire();\n        }\n\n        const response = await fetch(`${this.baseUrl}/chat/completions`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${this.apiKey}`,\n            'HTTP-Referer': 'https://spec.vitness.me',\n            'X-Title': 'FDS Transformer',\n          },\n          body: JSON.stringify({\n            model: this.model,\n            messages,\n            temperature: options.temperature ?? this.defaultTemperature,\n            max_tokens: options.maxTokens ?? this.defaultMaxTokens,\n          }),\n        });\n\n        // Handle 429 rate limit response\n        if (response.status === 429) {\n          const retryAfter = this.parseRetryAfter(response.headers.get('Retry-After'));\n\n          if (this.rateLimiter) {\n            this.rateLimiter.recordRateLimitHit();\n          }\n\n          const errorBody = await response.text();\n          throw new RateLimitError(\n            `Rate limited by OpenRouter: ${errorBody}`,\n            retryAfter\n          );\n        }\n\n        if (!response.ok) {\n          const errorBody = await response.text();\n          throw new OpenRouterAPIError(\n            `OpenRouter API error: ${response.status} ${errorBody}`,\n            response.status\n          );\n        }\n\n        const data = await response.json() as {\n          choices?: Array<{ message?: { content?: string } }>;\n          usage?: { total_tokens?: number };\n          model?: string;\n        };\n        const content = data.choices?.[0]?.message?.content || '';\n        const tokensUsed = data.usage?.total_tokens || 0;\n\n        // Record successful request\n        if (this.rateLimiter) {\n          this.rateLimiter.recordSuccess();\n        }\n\n        return {\n          content,\n          tokensUsed,\n          model: data.model || this.model,\n        };\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n\n        // Check if this is a rate limit error\n        const isRateLimitError = error instanceof RateLimitError;\n\n        // Check if we should retry\n        if (attempt < this.maxRetries - 1) {\n          let delay: number;\n\n          if (isRateLimitError && error.retryAfter) {\n            // Use server-provided retry-after if available\n            delay = error.retryAfter * 1000;\n          } else if (isRateLimitError && this.rateLimiter) {\n            // Use rate limiter's backoff\n            delay = this.rateLimiter.getBackoffRemaining();\n            if (delay === 0) {\n              delay = this.retryDelay * Math.pow(2, attempt);\n            }\n          } else {\n            // Standard exponential backoff for other errors\n            delay = this.retryDelay * Math.pow(2, attempt);\n          }\n\n          await this.sleep(delay);\n        }\n      }\n    }\n\n    throw lastError || new Error('Failed to complete request after retries');\n  }\n\n  /**\n   * Parse the Retry-After header value\n   * Can be either seconds or HTTP-date format\n   */\n  private parseRetryAfter(value: string | null): number | null {\n    if (!value) return null;\n\n    // Try parsing as seconds\n    const seconds = parseInt(value, 10);\n    if (!isNaN(seconds)) {\n      return seconds;\n    }\n\n    // Try parsing as HTTP-date\n    const date = Date.parse(value);\n    if (!isNaN(date)) {\n      return Math.max(0, Math.ceil((date - Date.now()) / 1000));\n    }\n\n    return null;\n  }\n\n  /**\n   * Send a completion request expecting JSON response\n   */\n  async completeJSON<T>(\n    prompt: string,\n    _schema?: object,\n    options: AIProviderOptions = {}\n  ): Promise<T> {\n    const systemPrompt = options.systemPrompt || \n      'You are a helpful assistant that responds only with valid JSON. Do not include any text outside the JSON object.';\n\n    const response = await this.complete(prompt, {\n      ...options,\n      systemPrompt,\n    });\n\n    // Extract JSON from response\n    const content = response.content.trim();\n    \n    // Try to find JSON in the response\n    let jsonStr = content;\n    \n    // Handle markdown code blocks\n    const codeBlockMatch = content.match(/```(?:json)?\\s*([\\s\\S]*?)\\s*```/);\n    if (codeBlockMatch) {\n      jsonStr = codeBlockMatch[1];\n    }\n\n    try {\n      return JSON.parse(jsonStr) as T;\n    } catch (error) {\n      throw new Error(`Failed to parse JSON response: ${content.slice(0, 200)}`);\n    }\n  }\n\n  /**\n   * Sleep helper\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n","/**\n * Rate Limiter - Intelligent rate limiting with automatic backoff\n *\n * Handles API rate limits by:\n * - Tracking requests per minute\n * - Waiting when approaching limits\n * - Implementing exponential/linear/fixed backoff on 429 responses\n * - Resetting backoff on successful requests\n */\n\nimport type { RateLimitConfig } from '../core/types.js';\n\n/**\n * Rate limiter state for external monitoring\n */\nexport interface RateLimiterState {\n  /** Requests made in current window */\n  requestsInWindow: number;\n  /** Maximum requests per minute */\n  requestsPerMinute: number;\n  /** Current backoff delay in ms (0 if not in backoff) */\n  currentBackoffMs: number;\n  /** Number of consecutive rate limit hits */\n  consecutiveHits: number;\n  /** Whether currently in backoff state */\n  isBackingOff: boolean;\n  /** Timestamp of last request */\n  lastRequestTime: number | null;\n  /** Time until next request can be made (0 if ready) */\n  waitTimeMs: number;\n}\n\n/**\n * Default rate limit configuration\n */\nexport const DEFAULT_RATE_LIMIT_CONFIG: RateLimitConfig = {\n  requestsPerMinute: 50,\n  backoffStrategy: 'exponential',\n  initialBackoffMs: 1000,\n  maxBackoffMs: 60000,\n};\n\n/**\n * Rate limiter for API calls with automatic backoff\n */\nexport class RateLimiter {\n  private config: RateLimitConfig;\n  private requestTimestamps: number[] = [];\n  private consecutiveHits: number = 0;\n  private currentBackoffMs: number = 0;\n  private backoffUntil: number = 0;\n  private lastRequestTime: number | null = null;\n\n  constructor(config: Partial<RateLimitConfig> = {}) {\n    this.config = { ...DEFAULT_RATE_LIMIT_CONFIG, ...config };\n  }\n\n  /**\n   * Acquire permission to make a request\n   * Waits if necessary to stay within rate limits\n   * @returns Promise that resolves when it's safe to make a request\n   */\n  async acquire(): Promise<void> {\n    const now = Date.now();\n\n    // Check if we're in backoff state\n    if (this.backoffUntil > now) {\n      const waitTime = this.backoffUntil - now;\n      await this.sleep(waitTime);\n    }\n\n    // Clean old timestamps (older than 1 minute)\n    this.cleanOldTimestamps();\n\n    // Check if we're at the rate limit\n    if (this.requestTimestamps.length >= this.config.requestsPerMinute) {\n      // Calculate wait time until oldest request falls out of window\n      const oldestTimestamp = this.requestTimestamps[0];\n      const windowEnd = oldestTimestamp + 60000; // 1 minute window\n      const waitTime = Math.max(0, windowEnd - Date.now());\n\n      if (waitTime > 0) {\n        await this.sleep(waitTime);\n        // Clean again after waiting\n        this.cleanOldTimestamps();\n      }\n    }\n\n    // Record this request\n    this.requestTimestamps.push(Date.now());\n    this.lastRequestTime = Date.now();\n  }\n\n  /**\n   * Record a rate limit hit (429 response)\n   * Increases backoff according to strategy\n   */\n  recordRateLimitHit(): void {\n    this.consecutiveHits++;\n\n    // Calculate new backoff based on strategy\n    this.currentBackoffMs = this.calculateBackoff();\n\n    // Set backoff deadline\n    this.backoffUntil = Date.now() + this.currentBackoffMs;\n  }\n\n  /**\n   * Record a successful request\n   * Resets backoff counter\n   */\n  recordSuccess(): void {\n    this.consecutiveHits = 0;\n    this.currentBackoffMs = 0;\n    this.backoffUntil = 0;\n  }\n\n  /**\n   * Get current rate limiter state for logging/monitoring\n   */\n  getState(): RateLimiterState {\n    const now = Date.now();\n    this.cleanOldTimestamps();\n\n    // Calculate wait time\n    let waitTimeMs = 0;\n\n    // Check backoff wait time\n    if (this.backoffUntil > now) {\n      waitTimeMs = this.backoffUntil - now;\n    }\n    // Check rate limit wait time\n    else if (this.requestTimestamps.length >= this.config.requestsPerMinute) {\n      const oldestTimestamp = this.requestTimestamps[0];\n      const windowEnd = oldestTimestamp + 60000;\n      waitTimeMs = Math.max(0, windowEnd - now);\n    }\n\n    return {\n      requestsInWindow: this.requestTimestamps.length,\n      requestsPerMinute: this.config.requestsPerMinute,\n      currentBackoffMs: this.currentBackoffMs,\n      consecutiveHits: this.consecutiveHits,\n      isBackingOff: this.backoffUntil > now,\n      lastRequestTime: this.lastRequestTime,\n      waitTimeMs,\n    };\n  }\n\n  /**\n   * Get the configured requests per minute\n   */\n  getRequestsPerMinute(): number {\n    return this.config.requestsPerMinute;\n  }\n\n  /**\n   * Check if currently in backoff state\n   */\n  isInBackoff(): boolean {\n    return this.backoffUntil > Date.now();\n  }\n\n  /**\n   * Get time remaining in backoff (0 if not in backoff)\n   */\n  getBackoffRemaining(): number {\n    return Math.max(0, this.backoffUntil - Date.now());\n  }\n\n  /**\n   * Reset the rate limiter state\n   */\n  reset(): void {\n    this.requestTimestamps = [];\n    this.consecutiveHits = 0;\n    this.currentBackoffMs = 0;\n    this.backoffUntil = 0;\n    this.lastRequestTime = null;\n  }\n\n  /**\n   * Calculate backoff based on strategy\n   */\n  private calculateBackoff(): number {\n    const { backoffStrategy, initialBackoffMs, maxBackoffMs } = this.config;\n\n    let backoff: number;\n\n    switch (backoffStrategy) {\n      case 'exponential':\n        // Exponential backoff: initial * 2^(hits-1)\n        backoff = initialBackoffMs * Math.pow(2, this.consecutiveHits - 1);\n        break;\n\n      case 'linear':\n        // Linear backoff: initial * hits\n        backoff = initialBackoffMs * this.consecutiveHits;\n        break;\n\n      case 'fixed':\n        // Fixed backoff: always use initial\n        backoff = initialBackoffMs;\n        break;\n\n      default:\n        backoff = initialBackoffMs;\n    }\n\n    // Cap at maximum\n    return Math.min(backoff, maxBackoffMs);\n  }\n\n  /**\n   * Remove timestamps older than 1 minute\n   */\n  private cleanOldTimestamps(): void {\n    const cutoff = Date.now() - 60000; // 1 minute ago\n    this.requestTimestamps = this.requestTimestamps.filter((ts) => ts > cutoff);\n  }\n\n  /**\n   * Sleep for specified milliseconds\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n","/**\n * Checkpoint Manager - Progress saving and resumption for enrichment\n *\n * Handles:\n * - Saving partial enrichment progress to disk\n * - Resuming from checkpoint on restart\n * - Detecting config changes via hash\n * - Managing log file paths\n */\n\nimport { createHash } from 'crypto';\nimport { existsSync, mkdirSync, readFileSync, renameSync, unlinkSync, writeFileSync } from 'fs';\nimport { dirname, join } from 'path';\nimport type { CheckpointConfig, CheckpointData, TierName } from '../core/types.js';\n\n/**\n * Checkpoint file name\n */\nexport const CHECKPOINT_FILENAME = '.fds-checkpoint.json';\n\n/**\n * Enrichment log file name\n */\nexport const ENRICHMENT_LOG_FILENAME = 'enrichment.log';\n\n/**\n * Current checkpoint format version\n */\nexport const CHECKPOINT_VERSION = '1.0.0';\n\n/**\n * Default checkpoint configuration\n */\nexport const DEFAULT_CHECKPOINT_CONFIG: CheckpointConfig = {\n  enabled: true,\n  saveInterval: 10,\n};\n\n/**\n * Options for initializing a new checkpoint\n */\nexport interface CheckpointInitOptions {\n  /** Path to input file being processed */\n  inputFile: string;\n  /** Total number of exercises to process */\n  totalExercises: number;\n  /** Configuration object to hash for change detection */\n  config: unknown;\n}\n\n/**\n * Options for updating a checkpoint\n */\nexport interface CheckpointUpdateOptions {\n  /** Exercise ID that was completed */\n  exerciseId: string;\n  /** Whether the exercise succeeded or failed */\n  success: boolean;\n  /** Current tier being processed */\n  currentTier: TierName;\n  /** Partial results for this exercise (tier -> field -> value) */\n  results?: Record<string, Record<string, unknown>>;\n}\n\n/**\n * Validation result for checkpoint\n */\nexport interface CheckpointValidationResult {\n  /** Whether checkpoint is valid */\n  valid: boolean;\n  /** Reason for invalidity (if any) */\n  reason?: string;\n  /** Whether config hash matches */\n  configMatches?: boolean;\n  /** Expected config hash */\n  expectedHash?: string;\n  /** Actual config hash in checkpoint */\n  actualHash?: string;\n}\n\n/**\n * Checkpoint Manager for resumable enrichment\n */\nexport class CheckpointManager {\n  private config: CheckpointConfig;\n  private checkpointPath: string;\n  private logFilePath: string;\n  private data: CheckpointData | null = null;\n  private updatesSinceLastSave: number = 0;\n\n  constructor(outputDirectory: string, config: Partial<CheckpointConfig> = {}) {\n    this.config = { ...DEFAULT_CHECKPOINT_CONFIG, ...config };\n    this.checkpointPath = join(outputDirectory, CHECKPOINT_FILENAME);\n    this.logFilePath = join(outputDirectory, ENRICHMENT_LOG_FILENAME);\n  }\n\n  /**\n   * Check if a checkpoint file exists\n   */\n  exists(): boolean {\n    return existsSync(this.checkpointPath);\n  }\n\n  /**\n   * Load existing checkpoint from file\n   * @returns Checkpoint data if found and valid, null otherwise\n   */\n  load(): CheckpointData | null {\n    if (!this.exists()) {\n      return null;\n    }\n\n    try {\n      const content = readFileSync(this.checkpointPath, 'utf-8');\n      const data = JSON.parse(content) as CheckpointData;\n\n      // Basic structure validation\n      if (!data.version || !data.configHash || !data.completedIds) {\n        return null;\n      }\n\n      this.data = data;\n      return data;\n    } catch {\n      // File is corrupted or invalid JSON\n      return null;\n    }\n  }\n\n  /**\n   * Initialize a new checkpoint\n   * @param options - Initialization options\n   * @returns The new checkpoint data\n   */\n  initialize(options: CheckpointInitOptions): CheckpointData {\n    const now = new Date().toISOString();\n    const configHash = this.hashConfig(options.config);\n\n    this.data = {\n      version: CHECKPOINT_VERSION,\n      configHash,\n      startedAt: now,\n      lastUpdatedAt: now,\n      inputFile: options.inputFile,\n      totalExercises: options.totalExercises,\n      completedExercises: 0,\n      completedIds: [],\n      failedIds: [],\n      currentTier: 'simple',\n      results: {},\n    };\n\n    // Ensure output directory exists\n    this.ensureDirectory();\n\n    // Save immediately\n    this.forceSave();\n\n    return this.data;\n  }\n\n  /**\n   * Validate checkpoint against current config\n   * @param currentConfig - Current configuration to compare hash\n   * @returns Validation result\n   */\n  validate(currentConfig: unknown): CheckpointValidationResult {\n    if (!this.data) {\n      return { valid: false, reason: 'No checkpoint loaded' };\n    }\n\n    // Check version compatibility\n    if (this.data.version !== CHECKPOINT_VERSION) {\n      return {\n        valid: false,\n        reason: `Checkpoint version mismatch: expected ${CHECKPOINT_VERSION}, got ${this.data.version}`,\n      };\n    }\n\n    // Check config hash\n    const currentHash = this.hashConfig(currentConfig);\n    const configMatches = this.data.configHash === currentHash;\n\n    if (!configMatches) {\n      return {\n        valid: false,\n        reason: 'Configuration has changed since checkpoint was created',\n        configMatches: false,\n        expectedHash: currentHash,\n        actualHash: this.data.configHash,\n      };\n    }\n\n    return { valid: true, configMatches: true };\n  }\n\n  /**\n   * Update checkpoint with exercise completion\n   * @param options - Update options\n   */\n  update(options: CheckpointUpdateOptions): void {\n    if (!this.data) {\n      throw new Error('Checkpoint not initialized. Call initialize() or load() first.');\n    }\n\n    const { exerciseId, success, currentTier, results } = options;\n\n    // Update tier\n    this.data.currentTier = currentTier;\n    this.data.lastUpdatedAt = new Date().toISOString();\n\n    // Track completion/failure\n    if (success) {\n      if (!this.data.completedIds.includes(exerciseId)) {\n        this.data.completedIds.push(exerciseId);\n        this.data.completedExercises = this.data.completedIds.length;\n      }\n      // Remove from failed if it was there (retry succeeded)\n      const failedIndex = this.data.failedIds.indexOf(exerciseId);\n      if (failedIndex > -1) {\n        this.data.failedIds.splice(failedIndex, 1);\n      }\n    } else {\n      if (!this.data.failedIds.includes(exerciseId)) {\n        this.data.failedIds.push(exerciseId);\n      }\n    }\n\n    // Store partial results\n    if (results) {\n      if (!this.data.results[exerciseId]) {\n        this.data.results[exerciseId] = {};\n      }\n      // Merge tier results\n      for (const [tier, fields] of Object.entries(results)) {\n        if (!this.data.results[exerciseId][tier]) {\n          this.data.results[exerciseId][tier] = {};\n        }\n        Object.assign(this.data.results[exerciseId][tier], fields);\n      }\n    }\n\n    this.updatesSinceLastSave++;\n\n    // Auto-save based on interval\n    if (this.updatesSinceLastSave >= this.config.saveInterval) {\n      this.save();\n    }\n  }\n\n  /**\n   * Save checkpoint to file\n   * Only saves if there are pending updates\n   * @returns Whether a save was performed\n   */\n  save(): boolean {\n    if (!this.data || this.updatesSinceLastSave === 0) {\n      return false;\n    }\n\n    this.forceSave();\n    return true;\n  }\n\n  /**\n   * Force save checkpoint to file regardless of pending updates\n   */\n  forceSave(): void {\n    if (!this.data) {\n      return;\n    }\n\n    this.ensureDirectory();\n\n    // Update timestamp\n    this.data.lastUpdatedAt = new Date().toISOString();\n\n    // Write atomically (write to temp, then rename)\n    const content = JSON.stringify(this.data, null, 2);\n    const tempPath = `${this.checkpointPath}.tmp.${process.pid}.${Date.now()}`;\n    writeFileSync(tempPath, content, 'utf-8');\n    renameSync(tempPath, this.checkpointPath);\n\n    this.updatesSinceLastSave = 0;\n  }\n\n  /**\n   * Clear checkpoint file (call on successful completion)\n   */\n  clear(): void {\n    if (existsSync(this.checkpointPath)) {\n      unlinkSync(this.checkpointPath);\n    }\n    this.data = null;\n    this.updatesSinceLastSave = 0;\n  }\n\n  /**\n   * Get list of completed exercise IDs (for skipping on resume)\n   */\n  getCompletedIds(): string[] {\n    return this.data?.completedIds ?? [];\n  }\n\n  /**\n   * Get list of failed exercise IDs\n   */\n  getFailedIds(): string[] {\n    return this.data?.failedIds ?? [];\n  }\n\n  /**\n   * Get partial results for an exercise\n   */\n  getResults(exerciseId: string): Record<string, Record<string, unknown>> | undefined {\n    return this.data?.results[exerciseId];\n  }\n\n  /**\n   * Get all partial results\n   */\n  getAllResults(): Record<string, Record<string, Record<string, unknown>>> {\n    return this.data?.results ?? {};\n  }\n\n  /**\n   * Get path for enrichment log file\n   */\n  getLogFilePath(): string {\n    return this.logFilePath;\n  }\n\n  /**\n   * Get path to checkpoint file\n   */\n  getCheckpointPath(): string {\n    return this.checkpointPath;\n  }\n\n  /**\n   * Get current checkpoint data (readonly copy)\n   */\n  getData(): CheckpointData | null {\n    if (!this.data) {\n      return null;\n    }\n    return { ...this.data };\n  }\n\n  /**\n   * Get current tier being processed\n   */\n  getCurrentTier(): TierName | null {\n    return this.data?.currentTier ?? null;\n  }\n\n  /**\n   * Get progress percentage\n   */\n  getProgress(): number {\n    if (!this.data || this.data.totalExercises === 0) {\n      return 0;\n    }\n    return (this.data.completedExercises / this.data.totalExercises) * 100;\n  }\n\n  /**\n   * Check if checkpointing is enabled\n   */\n  isEnabled(): boolean {\n    return this.config.enabled;\n  }\n\n  /**\n   * Get save interval\n   */\n  getSaveInterval(): number {\n    return this.config.saveInterval;\n  }\n\n  /**\n   * Hash configuration for change detection\n   */\n  private hashConfig(config: unknown): string {\n    const json = this.stableStringify(config);\n    return createHash('sha256').update(json).digest('hex').substring(0, 16);\n  }\n\n  private stableStringify(value: unknown): string {\n    const seen = new WeakSet<object>();\n\n    const stringify = (input: unknown): string | undefined => {\n      if (input === null) {\n        return 'null';\n      }\n\n      const inputType = typeof input;\n\n      if (inputType === 'number') {\n        return Number.isFinite(input) ? String(input) : 'null';\n      }\n\n      if (inputType === 'string') {\n        return JSON.stringify(input);\n      }\n\n      if (inputType === 'boolean') {\n        return input ? 'true' : 'false';\n      }\n\n      if (inputType === 'bigint') {\n        return JSON.stringify(String(input));\n      }\n\n      if (inputType === 'undefined' || inputType === 'function' || inputType === 'symbol') {\n        return undefined;\n      }\n\n      if (inputType !== 'object') {\n        return JSON.stringify(input);\n      }\n\n      const objectValue = input as Record<string, unknown>;\n\n      if (typeof objectValue.toJSON === 'function') {\n        return stringify(objectValue.toJSON());\n      }\n\n      if (Array.isArray(objectValue)) {\n        const items = objectValue.map((item) => stringify(item) ?? 'null');\n        return `[${items.join(',')} ]`.replace(', ]', ']');\n      }\n\n      if (seen.has(objectValue)) {\n        throw new TypeError('Cannot stringify circular structure');\n      }\n\n      seen.add(objectValue);\n\n      const keys = Object.keys(objectValue).sort();\n      const entries: string[] = [];\n\n      for (const key of keys) {\n        const valueString = stringify(objectValue[key]);\n        if (valueString !== undefined) {\n          entries.push(`${JSON.stringify(key)}:${valueString}`);\n        }\n      }\n\n      seen.delete(objectValue);\n\n      return `{${entries.join(',')}}`;\n    };\n\n    return stringify(value) ?? 'null';\n  }\n\n  /**\n   * Ensure output directory exists\n   */\n  private ensureDirectory(): void {\n    const dir = dirname(this.checkpointPath);\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n  }\n}\n","/**\n * Exercise enrichment prompts for FDS Transformer\n * These prompts generate high-quality exercise data matching POC standards\n */\n\nexport interface ExerciseContext {\n  name: string;\n  target?: string;\n  equipment?: string;\n  bodyPart?: string;\n}\n\n/**\n * System prompt for exercise enrichment\n */\nexport const EXERCISE_SYSTEM_PROMPT = `You are an expert exercise physiologist and certified strength and conditioning specialist (CSCS) with deep knowledge of biomechanics, anatomy, and exercise programming.\n\nYour responses must be:\n1. Technically accurate based on exercise science\n2. Practical and applicable for fitness professionals\n3. Formatted as valid JSON only - no markdown, no explanations\n\nUse proper anatomical terminology and exercise science concepts.`;\n\n/**\n * Get prompt for comprehensive exercise enrichment\n */\nexport function getExerciseEnrichmentPrompt(context: ExerciseContext): string {\n  return `Analyze this exercise and provide comprehensive enrichment data:\n\nExercise: ${context.name}\n${context.target ? `Primary Target: ${context.target}` : ''}\n${context.equipment ? `Equipment: ${context.equipment}` : ''}\n${context.bodyPart ? `Body Part: ${context.bodyPart}` : ''}\n\nProvide a JSON object with ALL of the following fields:\n\n{\n  \"description\": \"A detailed 1-2 sentence description of the exercise emphasizing the movement pattern and primary benefits\",\n  \"aliases\": [\"3-5 common alternative names for this exercise\"],\n  \"localized\": [\n    {\n      \"lang\": \"sr\",\n      \"name\": \"Serbian name\",\n      \"description\": \"Serbian description\",\n      \"aliases\": [\"Serbian aliases\"]\n    },\n    {\n      \"lang\": \"es\", \n      \"name\": \"Spanish name\",\n      \"description\": \"Spanish description\",\n      \"aliases\": [\"Spanish aliases\"]\n    }\n  ],\n  \"classification\": {\n    \"exerciseType\": \"strength|cardio|flexibility|balance|plyometric\",\n    \"movement\": \"squat|hinge|push|pull|lunge|carry|rotation|core-anti-extension|core-anti-rotation|other\",\n    \"mechanics\": \"compound|isolation\",\n    \"force\": \"push|pull|static|dynamic\",\n    \"level\": \"beginner|intermediate|advanced\",\n    \"unilateral\": false,\n    \"kineticChain\": \"open|closed\",\n    \"tags\": [\"relevant tags like bilateral, freeWeight, barbell, kneeDominant, upperBody, etc.\"]\n  },\n  \"targets\": {\n    \"secondary\": [\n      {\"id\": \"mus.muscleName\", \"name\": \"Muscle Name\", \"categoryId\": \"cat.category\"}\n    ]\n  },\n  \"equipment\": {\n    \"optional\": [\n      {\"id\": \"eq.equipmentName\", \"name\": \"Equipment Name\"}\n    ]\n  },\n  \"constraints\": {\n    \"contraindications\": [\"3-4 specific medical/injury conditions that would make this exercise inadvisable\"],\n    \"prerequisites\": [\"3-4 movement competencies or abilities required before attempting this exercise\"],\n    \"progressions\": [\"4-5 harder variations or next-level exercises\"],\n    \"recessions\": [\"4-5 easier variations or regression exercises\"]\n  },\n  \"relations\": [\n    {\"type\": \"alternate\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"regression\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"progression\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"equipmentVariant\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"accessory\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"mobilityPrep\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"similarPattern\", \"targetId\": \"urn:slug:exercise-slug\"}\n  ],\n  \"metrics\": {\n    \"primary\": {\"type\": \"reps|duration|distance\", \"unit\": \"count|s|m\"},\n    \"secondary\": [\n      {\"type\": \"weight|tempo|rpe|rest|speed\", \"unit\": \"kg|count|s|km/h\"}\n    ]\n  }\n}\n\nIMPORTANT:\n- Use realistic exercise slugs for relations (e.g., \"goblet-squat\", \"front-squat\")\n- Use standard muscle IDs: mus.quadriceps, mus.glutes, mus.hamstrings, mus.lats, mus.pectorals, mus.deltoids, mus.triceps, mus.biceps, mus.abs, mus.obliques, mus.erectorSpinae, etc.\n- Use standard category IDs: cat.legs, cat.back, cat.chest, cat.shoulders, cat.arms, cat.core\n- Use standard equipment IDs: eq.barbell, eq.dumbbell, eq.cable, eq.machine, eq.bench, eq.rack, eq.mat, eq.band, eq.kettlebell\n- Provide 8-12 relations covering different relationship types\n- Be specific and technically accurate`;\n}\n\n/**\n * Prompt templates by field type (for targeted enrichment)\n */\nexport const FIELD_PROMPTS: Record<string, (ctx: ExerciseContext) => string> = {\n  'exercise-description': (ctx) => `\nGenerate a professional exercise description for: ${ctx.name}\nContext: ${ctx.target ? `targets ${ctx.target}` : ''} ${ctx.equipment ? `using ${ctx.equipment}` : ''}\n\nReturn JSON: {\"description\": \"1-2 sentence description emphasizing movement pattern and primary benefits\"}`,\n\n  'exercise-aliases': (ctx) => `\nList common alternative names for: ${ctx.name}\n\nReturn JSON: {\"aliases\": [\"3-5 alternative names commonly used by trainers and athletes\"]}`,\n\n  'exercise-classification': (ctx) => `\nClassify this exercise: ${ctx.name}\n${ctx.target ? `Target: ${ctx.target}` : ''}\n${ctx.equipment ? `Equipment: ${ctx.equipment}` : ''}\n\nReturn JSON with classification data:\n{\n  \"exerciseType\": \"strength|cardio|flexibility|balance|plyometric\",\n  \"movement\": \"squat|hinge|push|pull|lunge|carry|rotation|core-anti-extension|other\",\n  \"mechanics\": \"compound|isolation\",\n  \"force\": \"push|pull|static|dynamic\",\n  \"level\": \"beginner|intermediate|advanced\",\n  \"unilateral\": true|false,\n  \"kineticChain\": \"open|closed\"\n}`,\n\n  'exercise-tags': (ctx) => `\nGenerate relevant tags for: ${ctx.name}\n${ctx.equipment ? `Equipment: ${ctx.equipment}` : ''}\n${ctx.bodyPart ? `Body part: ${ctx.bodyPart}` : ''}\n\nReturn JSON: {\"tags\": [\"6-10 relevant tags like bilateral, freeWeight, barbell, kneeDominant, upperBody, compound, etc.\"]}`,\n\n  'exercise-muscles': (ctx) => `\nIdentify secondary muscles for: ${ctx.name}\n${ctx.target ? `Primary target: ${ctx.target}` : ''}\n\nReturn JSON with secondary muscles activated:\n{\n  \"secondary\": [\n    {\"id\": \"mus.muscleName\", \"name\": \"Muscle Name\", \"categoryId\": \"cat.category\"}\n  ]\n}\n\nUse standard IDs: mus.quadriceps, mus.glutes, mus.hamstrings, mus.lats, mus.pectorals, mus.deltoids, mus.triceps, mus.biceps, mus.abs, mus.obliques, mus.erectorSpinae, mus.adductors, mus.calves, mus.forearms, mus.traps, mus.rhomboids, mus.serratus\nCategories: cat.legs, cat.back, cat.chest, cat.shoulders, cat.arms, cat.core`,\n\n  'exercise-constraints': (ctx) => `\nIdentify constraints for: ${ctx.name}\n\nReturn JSON:\n{\n  \"contraindications\": [\"3-4 specific medical/injury conditions making this exercise inadvisable\"],\n  \"prerequisites\": [\"3-4 movement competencies required before attempting\"],\n  \"progressions\": [\"4-5 harder variations\"],\n  \"recessions\": [\"4-5 easier variations\"]\n}`,\n\n  'exercise-relations': (ctx) => `\nIdentify related exercises for: ${ctx.name}\n\nReturn JSON with 8-12 relations:\n{\n  \"relations\": [\n    {\"type\": \"alternate\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"regression\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"progression\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"equipmentVariant\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"accessory\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"mobilityPrep\", \"targetId\": \"urn:slug:exercise-slug\"},\n    {\"type\": \"similarPattern\", \"targetId\": \"urn:slug:exercise-slug\"}\n  ]\n}\n\nUse realistic slugs like: goblet-squat, front-squat, leg-press, romanian-deadlift, etc.`,\n\n  'exercise-metrics': (ctx) => `\nDetermine appropriate metrics for: ${ctx.name}\n\nReturn JSON:\n{\n  \"primary\": {\"type\": \"reps|duration|distance\", \"unit\": \"count|s|m\"},\n  \"secondary\": [\n    {\"type\": \"weight|tempo|rpe|rest|speed|incline\", \"unit\": \"kg|count|s|km/h|%\"}\n  ]\n}`,\n\n  'exercise-localization': (ctx) => `\nTranslate exercise data for: ${ctx.name}\n\nReturn JSON with Serbian (sr) and Spanish (es) translations:\n{\n  \"localized\": [\n    {\n      \"lang\": \"sr\",\n      \"name\": \"Serbian name using Cyrillic script\",\n      \"description\": \"Serbian description\",\n      \"aliases\": [\"2-3 Serbian alternative names\"]\n    },\n    {\n      \"lang\": \"es\",\n      \"name\": \"Spanish name\",\n      \"description\": \"Spanish description\", \n      \"aliases\": [\"2-3 Spanish alternative names\"]\n    }\n  ]\n}`,\n};\n\nexport default {\n  EXERCISE_SYSTEM_PROMPT,\n  getExerciseEnrichmentPrompt,\n  FIELD_PROMPTS,\n};\n","/**\n * Tier Prompts - Tier-specific prompt templates for AI enrichment\n *\n * Provides structured prompts for each complexity tier:\n * - Simple (Haiku): description, aliases, exerciseType, level, unilateral, metrics, equipment.optional\n * - Medium (Sonnet): constraints.*, relations\n * - Complex (Opus): classification.movement/mechanics/force/kineticChain/tags, targets.secondary\n *\n * All prompts instruct the model to return structured JSON for reliable parsing.\n */\n\nimport type { TierName } from '../../core/types.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Exercise context provided to prompt builders\n */\nexport interface ExerciseContext {\n  /** Exercise name */\n  name: string;\n  /** Exercise slug (URL-safe identifier) */\n  slug: string;\n  /** Current description if available */\n  description?: string;\n  /** Current aliases if available */\n  aliases?: string[];\n  /** Primary target muscles */\n  primaryTargets?: Array<{ name: string; id: string }>;\n  /** Required equipment */\n  requiredEquipment?: Array<{ name: string; id: string }>;\n  /** Exercise type if known */\n  exerciseType?: string;\n  /** Any additional context fields */\n  [key: string]: unknown;\n}\n\n/**\n * Batch of exercises for batch processing\n */\nexport interface ExerciseBatch {\n  exercises: ExerciseContext[];\n}\n\n/**\n * Prompt template with metadata\n */\nexport interface PromptTemplate {\n  /** Unique identifier for this prompt */\n  id: string;\n  /** Fields this prompt generates */\n  fields: string[];\n  /** The prompt template with placeholders */\n  template: string;\n  /** Expected output schema description */\n  outputSchema: string;\n}\n\n/**\n * Built prompt ready for API call\n */\nexport interface BuiltPrompt {\n  /** System prompt for the tier */\n  system: string;\n  /** User prompt with exercise context */\n  user: string;\n  /** Fields being generated */\n  fields: string[];\n  /** Tier this prompt is for */\n  tier: TierName;\n}\n\n// ============================================================================\n// Schema Enums - Valid values from FDS schema\n// ============================================================================\n\n/**\n * FDS schema enum values for validation and prompt context\n */\nexport const SCHEMA_ENUMS = {\n  exerciseType: ['strength', 'cardio', 'flexibility', 'balance', 'plyometric'] as const,\n\n  level: ['beginner', 'intermediate', 'advanced'] as const,\n\n  movement: [\n    'squat',\n    'hinge',\n    'lunge',\n    'push-horizontal',\n    'push-vertical',\n    'pull-horizontal',\n    'pull-vertical',\n    'carry',\n    'core-anti-extension',\n    'core-anti-rotation',\n    'rotation',\n    'locomotion',\n    'isolation',\n    'other',\n  ] as const,\n\n  mechanics: ['compound', 'isolation'] as const,\n\n  force: ['push', 'pull', 'static', 'mixed'] as const,\n\n  kineticChain: ['open', 'closed', 'mixed'] as const,\n\n  relationType: [\n    'alternate',\n    'variation',\n    'substitute',\n    'progression',\n    'regression',\n    'equipmentVariant',\n    'accessory',\n    'mobilityPrep',\n    'similarPattern',\n    'unilateralPair',\n    'contralateralPair',\n  ] as const,\n\n  metricType: [\n    'reps',\n    'weight',\n    'duration',\n    'distance',\n    'speed',\n    'pace',\n    'power',\n    'heartRate',\n    'steps',\n    'calories',\n    'height',\n    'tempo',\n    'rpe',\n  ] as const,\n\n  metricUnit: [\n    'count',\n    'kg',\n    'lb',\n    's',\n    'min',\n    'm',\n    'km',\n    'mi',\n    'm_s',\n    'km_h',\n    'min_per_km',\n    'min_per_mi',\n    'W',\n    'bpm',\n    'kcal',\n    'cm',\n    'in',\n  ] as const,\n} as const;\n\n// Type exports for enum values\nexport type ExerciseType = (typeof SCHEMA_ENUMS.exerciseType)[number];\nexport type Level = (typeof SCHEMA_ENUMS.level)[number];\nexport type Movement = (typeof SCHEMA_ENUMS.movement)[number];\nexport type Mechanics = (typeof SCHEMA_ENUMS.mechanics)[number];\nexport type Force = (typeof SCHEMA_ENUMS.force)[number];\nexport type KineticChain = (typeof SCHEMA_ENUMS.kineticChain)[number];\nexport type RelationType = (typeof SCHEMA_ENUMS.relationType)[number];\nexport type MetricType = (typeof SCHEMA_ENUMS.metricType)[number];\nexport type MetricUnit = (typeof SCHEMA_ENUMS.metricUnit)[number];\n\n// ============================================================================\n// System Prompts - Per-tier expert context\n// ============================================================================\n\n/**\n * System prompts that establish expert context for each tier\n */\nexport const SYSTEM_PROMPTS: Record<TierName, string> = {\n  simple: `You are a fitness data specialist helping to enrich exercise metadata for a fitness application database.\n\nYour role is to provide accurate, concise information for basic exercise fields. Focus on:\n- Clear, actionable descriptions\n- Common alternative names (aliases)\n- Appropriate difficulty levels\n- Standard exercise classifications\n- Relevant metrics for tracking\n\nAlways respond with valid JSON matching the requested schema. Be consistent and precise.`,\n\n  medium: `You are an exercise science specialist with expertise in movement assessment and programming.\n\nYour role is to analyze exercise requirements and relationships. Focus on:\n- Safety considerations and contraindications\n- Movement prerequisites and competency requirements\n- Logical progressions and regressions\n- Exercise relationships and substitutes\n\nConsider the full context of each exercise including equipment, primary muscles, and movement patterns.\nAlways respond with valid JSON matching the requested schema. Prioritize safety and evidence-based recommendations.`,\n\n  complex: `You are a biomechanics expert with deep knowledge of human movement, kinesiology, and exercise physiology.\n\nYour role is to provide precise biomechanical classifications and muscle targeting analysis. Focus on:\n- Accurate movement pattern classification based on joint actions\n- Force vector and kinetic chain analysis\n- Primary and secondary muscle recruitment patterns\n- Compound vs isolation mechanics\n\nUse your expertise to make nuanced distinctions. Consider muscle activation patterns, joint involvement, and force directions.\nAlways respond with valid JSON matching the requested schema. Accuracy is paramount - when uncertain, choose the most defensible classification.`,\n};\n\n// ============================================================================\n// Simple Tier Prompts\n// ============================================================================\n\n/**\n * Prompt templates for simple tier fields (batched, Haiku model)\n */\nexport const SIMPLE_TIER_PROMPTS: Record<string, PromptTemplate> = {\n  description: {\n    id: 'description',\n    fields: ['canonical.description'],\n    template: `Generate a clear, professional description for each exercise.\n\nThe description should:\n- Be 1-3 sentences\n- Explain what the exercise is and its primary benefit\n- Use active voice\n- Be suitable for a fitness app\n\nExercises:\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \"slug\": \"exercise-slug\", \"description\": \"...\" },\n    ...\n  ]\n}`,\n    outputSchema: '{ \"results\": [{ \"slug\": string, \"description\": string }] }',\n  },\n\n  aliases: {\n    id: 'aliases',\n    fields: ['canonical.aliases'],\n    template: `Generate common alternative names (aliases) for each exercise.\n\nInclude:\n- Gym slang and informal names\n- Regional variations\n- Equipment-specific names if applicable\n- Maximum 5 aliases per exercise\n\nExercises:\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \"slug\": \"exercise-slug\", \"aliases\": [\"alias1\", \"alias2\", ...] },\n    ...\n  ]\n}`,\n    outputSchema: '{ \"results\": [{ \"slug\": string, \"aliases\": string[] }] }',\n  },\n\n  'classification-simple': {\n    id: 'classification-simple',\n    fields: ['classification.exerciseType', 'classification.level', 'classification.unilateral'],\n    template: `Classify each exercise with basic attributes.\n\nFor exerciseType, choose from: ${SCHEMA_ENUMS.exerciseType.join(', ')}\nFor level, choose from: ${SCHEMA_ENUMS.level.join(', ')}\nFor unilateral, determine if the exercise works one side at a time (true/false)\n\nExercises:\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \n      \"slug\": \"exercise-slug\",\n      \"exerciseType\": \"strength|cardio|flexibility|balance|plyometric\",\n      \"level\": \"beginner|intermediate|advanced\",\n      \"unilateral\": true|false\n    },\n    ...\n  ]\n}`,\n    outputSchema:\n      '{ \"results\": [{ \"slug\": string, \"exerciseType\": string, \"level\": string, \"unilateral\": boolean }] }',\n  },\n\n  metrics: {\n    id: 'metrics',\n    fields: ['metrics.primary', 'metrics.secondary'],\n    template: `Determine the appropriate tracking metrics for each exercise.\n\nFor metric types, choose from: ${SCHEMA_ENUMS.metricType.join(', ')}\nFor metric units, choose appropriate unit for the type.\n\nPrimary metric: The main way to track this exercise\nSecondary metrics: Additional useful metrics (0-3)\n\nExercises:\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \n      \"slug\": \"exercise-slug\",\n      \"primary\": { \"type\": \"reps|weight|duration|...\", \"unit\": \"count|kg|s|...\" },\n      \"secondary\": [\n        { \"type\": \"...\", \"unit\": \"...\" }\n      ]\n    },\n    ...\n  ]\n}`,\n    outputSchema:\n      '{ \"results\": [{ \"slug\": string, \"primary\": { \"type\": string, \"unit\": string }, \"secondary\": [{ \"type\": string, \"unit\": string }] }] }',\n  },\n\n  equipment: {\n    id: 'equipment',\n    fields: ['equipment.optional'],\n    template: `Identify optional equipment that can enhance each exercise.\n\nConsider equipment that:\n- Can add resistance or difficulty\n- Provides support or stability\n- Enables variations of the exercise\n\nExercises (with their required equipment noted):\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \n      \"slug\": \"exercise-slug\",\n      \"optional\": [\n        { \"id\": \"equipment-id\", \"name\": \"Equipment Name\" }\n      ]\n    },\n    ...\n  ]\n}\n\nUse standardized equipment names like: dumbbell, barbell, kettlebell, resistance-band, cable-machine, bench, stability-ball, foam-roller, etc.`,\n    outputSchema:\n      '{ \"results\": [{ \"slug\": string, \"optional\": [{ \"id\": string, \"name\": string }] }] }',\n  },\n};\n\n// ============================================================================\n// Medium Tier Prompts\n// ============================================================================\n\n/**\n * Prompt templates for medium tier fields (batched, Sonnet model)\n */\nexport const MEDIUM_TIER_PROMPTS: Record<string, PromptTemplate> = {\n  constraints: {\n    id: 'constraints',\n    fields: [\n      'constraints.contraindications',\n      'constraints.prerequisites',\n      'constraints.progressions',\n      'constraints.regressions',\n    ],\n    template: `Analyze each exercise and determine its constraints.\n\nContraindications: Medical conditions or situations where this exercise should be avoided\nPrerequisites: Exercises or abilities needed before attempting this exercise\nProgressions: More challenging variations to progress to\nRegressions: Easier variations for those not ready for this exercise\n\nBe specific and evidence-based. Use exercise slugs for progressions/regressions when referencing other exercises.\n\nExercises:\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \n      \"slug\": \"exercise-slug\",\n      \"contraindications\": [\"condition1\", \"condition2\"],\n      \"prerequisites\": [\"prerequisite-exercise-slug\", \"ability or skill\"],\n      \"progressions\": [\"harder-exercise-slug\", \"harder-variation\"],\n      \"regressions\": [\"easier-exercise-slug\", \"easier-variation\"]\n    },\n    ...\n  ]\n}`,\n    outputSchema:\n      '{ \"results\": [{ \"slug\": string, \"contraindications\": string[], \"prerequisites\": string[], \"progressions\": string[], \"regressions\": string[] }] }',\n  },\n\n  relations: {\n    id: 'relations',\n    fields: ['relations'],\n    template: `Identify relationships between each exercise and other exercises.\n\nRelation types: ${SCHEMA_ENUMS.relationType.join(', ')}\n\n- alternate: Can be used interchangeably\n- variation: A variant of the same base movement\n- substitute: Can replace when equipment unavailable\n- progression: A harder version\n- regression: An easier version\n- equipmentVariant: Same movement, different equipment\n- accessory: Supports or complements this exercise\n- mobilityPrep: Mobility work that prepares for this exercise\n- similarPattern: Uses similar movement pattern\n- unilateralPair: Single-limb version\n- contralateralPair: Opposite-side movement\n\nExercises:\n{{exercises}}\n\nRespond with JSON:\n{\n  \"results\": [\n    { \n      \"slug\": \"exercise-slug\",\n      \"relations\": [\n        { \"type\": \"variation\", \"targetId\": \"related-exercise-slug\", \"confidence\": 0.9, \"notes\": \"optional note\" }\n      ]\n    },\n    ...\n  ]\n}\n\nConfidence should be 0.0-1.0. Only include relations you're confident about (>0.7).`,\n    outputSchema:\n      '{ \"results\": [{ \"slug\": string, \"relations\": [{ \"type\": string, \"targetId\": string, \"confidence\": number, \"notes\"?: string }] }] }',\n  },\n};\n\n// ============================================================================\n// Complex Tier Prompts\n// ============================================================================\n\n/**\n * Prompt templates for complex tier fields (single exercise, Opus model)\n */\nexport const COMPLEX_TIER_PROMPTS: Record<string, PromptTemplate> = {\n  biomechanics: {\n    id: 'biomechanics',\n    fields: [\n      'classification.movement',\n      'classification.mechanics',\n      'classification.force',\n      'classification.kineticChain',\n      'classification.tags',\n      'targets.secondary',\n    ],\n    template: `Perform a detailed biomechanical analysis of this exercise.\n\nMovement patterns: ${SCHEMA_ENUMS.movement.join(', ')}\nMechanics: ${SCHEMA_ENUMS.mechanics.join(', ')}\nForce: ${SCHEMA_ENUMS.force.join(', ')}\nKinetic chain: ${SCHEMA_ENUMS.kineticChain.join(', ')}\n\nMovement classification guidance:\n- squat: Knee-dominant bilateral lowering (squats, leg press)\n- hinge: Hip-dominant posterior chain (deadlifts, good mornings)\n- lunge: Single-leg knee-dominant (lunges, step-ups, split squats)\n- push-horizontal: Pushing away from body horizontally (bench press, push-ups)\n- push-vertical: Pushing overhead (shoulder press, pike push-ups)\n- pull-horizontal: Pulling toward body horizontally (rows)\n- pull-vertical: Pulling from overhead (pull-ups, lat pulldown)\n- carry: Loaded locomotion (farmer's walk, suitcase carry)\n- core-anti-extension: Resisting spinal extension (planks, rollouts)\n- core-anti-rotation: Resisting rotation (Pallof press, bird dogs)\n- rotation: Active rotation (Russian twists, woodchops)\n- locomotion: Cyclical movement patterns (running, cycling)\n- isolation: Single-joint movements (curls, extensions, raises)\n- other: Doesn't fit above patterns\n\nMechanics guidance:\n- compound: Multiple joints involved\n- isolation: Single joint involved\n\nForce guidance:\n- push: Force directed away from body\n- pull: Force directed toward body\n- static: Isometric, no movement\n- mixed: Combination of force vectors\n\nKinetic chain guidance:\n- closed: Distal segment (hand/foot) fixed (push-ups, squats)\n- open: Distal segment free (leg curls, chest fly)\n- mixed: Elements of both\n\nExercise:\n{{exercise}}\n\nPrimary targets: {{primaryTargets}}\nRequired equipment: {{equipment}}\n\nRespond with JSON:\n{\n  \"movement\": \"squat|hinge|lunge|push-horizontal|...\",\n  \"mechanics\": \"compound|isolation\",\n  \"force\": \"push|pull|static|mixed\",\n  \"kineticChain\": \"open|closed|mixed\",\n  \"tags\": [\"tag1\", \"tag2\"],\n  \"secondary\": [\n    { \"id\": \"muscle-id\", \"name\": \"Muscle Name\" }\n  ]\n}\n\nFor tags, include relevant descriptors like: \"upper-body\", \"lower-body\", \"core\", \"stability\", \"power\", \"strength\", \"endurance\", \"mobility\", etc.\nFor secondary targets, list muscles that assist but are not the primary focus. Use anatomical muscle names.`,\n    outputSchema:\n      '{ \"movement\": string, \"mechanics\": string, \"force\": string, \"kineticChain\": string, \"tags\": string[], \"secondary\": [{ \"id\": string, \"name\": string }] }',\n  },\n};\n\n// ============================================================================\n// Prompt Builders\n// ============================================================================\n\n/**\n * Format exercises for batch prompts\n */\nfunction formatExercisesForPrompt(exercises: ExerciseContext[]): string {\n  return exercises\n    .map((ex, index) => {\n      const parts = [`${index + 1}. ${ex.name} (slug: ${ex.slug})`];\n\n      if (ex.description) {\n        parts.push(`   Description: ${ex.description}`);\n      }\n      if (ex.primaryTargets && ex.primaryTargets.length > 0) {\n        parts.push(`   Primary targets: ${ex.primaryTargets.map((t) => t.name).join(', ')}`);\n      }\n      if (ex.requiredEquipment && ex.requiredEquipment.length > 0) {\n        parts.push(`   Equipment: ${ex.requiredEquipment.map((e) => e.name).join(', ')}`);\n      }\n      if (ex.exerciseType) {\n        parts.push(`   Type: ${ex.exerciseType}`);\n      }\n\n      return parts.join('\\n');\n    })\n    .join('\\n\\n');\n}\n\n/**\n * Format single exercise for complex prompts\n */\nfunction formatSingleExercise(exercise: ExerciseContext): string {\n  const parts = [`Name: ${exercise.name}`, `Slug: ${exercise.slug}`];\n\n  if (exercise.description) {\n    parts.push(`Description: ${exercise.description}`);\n  }\n  if (exercise.aliases && exercise.aliases.length > 0) {\n    parts.push(`Aliases: ${exercise.aliases.join(', ')}`);\n  }\n  if (exercise.exerciseType) {\n    parts.push(`Exercise type: ${exercise.exerciseType}`);\n  }\n\n  return parts.join('\\n');\n}\n\n/**\n * Get the appropriate prompt template for a tier and prompt ID\n */\nexport function getPromptTemplate(tier: TierName, promptId: string): PromptTemplate | undefined {\n  switch (tier) {\n    case 'simple':\n      return SIMPLE_TIER_PROMPTS[promptId];\n    case 'medium':\n      return MEDIUM_TIER_PROMPTS[promptId];\n    case 'complex':\n      return COMPLEX_TIER_PROMPTS[promptId];\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Get all prompt templates for a tier\n */\nexport function getTierPrompts(tier: TierName): Record<string, PromptTemplate> {\n  switch (tier) {\n    case 'simple':\n      return SIMPLE_TIER_PROMPTS;\n    case 'medium':\n      return MEDIUM_TIER_PROMPTS;\n    case 'complex':\n      return COMPLEX_TIER_PROMPTS;\n    default:\n      return {};\n  }\n}\n\n/**\n * Build a complete prompt for a tier with exercise context\n *\n * @param tier - The complexity tier\n * @param promptId - The prompt template ID\n * @param exercises - Array of exercises (1 for complex tier, multiple for others)\n * @returns Built prompt ready for API call, or undefined if template not found\n */\nexport function buildTierPrompt(\n  tier: TierName,\n  promptId: string,\n  exercises: ExerciseContext[]\n): BuiltPrompt | undefined {\n  const template = getPromptTemplate(tier, promptId);\n  if (!template) {\n    return undefined;\n  }\n\n  const system = SYSTEM_PROMPTS[tier];\n  let user = template.template;\n\n  // Replace placeholders based on tier\n  if (tier === 'complex') {\n    // Complex tier uses single exercise format\n    const exercise = exercises[0];\n    if (!exercise) {\n      return undefined;\n    }\n\n    user = user.replace('{{exercise}}', formatSingleExercise(exercise));\n\n    // Replace specific placeholders for biomechanics prompt\n    if (exercise.primaryTargets && exercise.primaryTargets.length > 0) {\n      user = user.replace(\n        '{{primaryTargets}}',\n        exercise.primaryTargets.map((t) => t.name).join(', ')\n      );\n    } else {\n      user = user.replace('{{primaryTargets}}', 'Not specified');\n    }\n\n    if (exercise.requiredEquipment && exercise.requiredEquipment.length > 0) {\n      user = user.replace(\n        '{{equipment}}',\n        exercise.requiredEquipment.map((e) => e.name).join(', ')\n      );\n    } else {\n      user = user.replace('{{equipment}}', 'Bodyweight / None');\n    }\n  } else {\n    // Simple and medium tiers use batch format\n    user = user.replace('{{exercises}}', formatExercisesForPrompt(exercises));\n  }\n\n  return {\n    system,\n    user,\n    fields: template.fields,\n    tier,\n  };\n}\n\n/**\n * Build prompts for all templates in a tier\n *\n * @param tier - The complexity tier\n * @param exercises - Array of exercises\n * @returns Array of built prompts for the tier\n */\nexport function buildAllTierPrompts(tier: TierName, exercises: ExerciseContext[]): BuiltPrompt[] {\n  const templates = getTierPrompts(tier);\n  const prompts: BuiltPrompt[] = [];\n\n  for (const [promptId] of Object.entries(templates)) {\n    const prompt = buildTierPrompt(tier, promptId, exercises);\n    if (prompt) {\n      prompts.push(prompt);\n    }\n  }\n\n  return prompts;\n}\n\n/**\n * Get all fields covered by a tier's prompts\n */\nexport function getTierFields(tier: TierName): string[] {\n  const templates = getTierPrompts(tier);\n  const fields: string[] = [];\n\n  for (const template of Object.values(templates)) {\n    fields.push(...template.fields);\n  }\n\n  return [...new Set(fields)]; // Deduplicate\n}\n\n/**\n * Validate that an enum value is valid for a field\n */\nexport function validateEnumValue(\n  enumName: keyof typeof SCHEMA_ENUMS,\n  value: string\n): value is (typeof SCHEMA_ENUMS)[typeof enumName][number] {\n  return (SCHEMA_ENUMS[enumName] as readonly string[]).includes(value);\n}\n\n/**\n * Get enum values for a field\n */\nexport function getEnumValues(enumName: keyof typeof SCHEMA_ENUMS): readonly string[] {\n  return SCHEMA_ENUMS[enumName];\n}\n","/**\n * Config Loader - loads and validates mapping configurations\n */\n\nimport type { MappingConfig, RegistriesConfig } from '../core/types.js';\nimport { dirname, resolve, isAbsolute } from 'path';\n\nexport class ConfigLoader {\n  /**\n   * Load a mapping configuration from file\n   */\n  static async load(configPath: string): Promise<MappingConfig> {\n    const fs = await import('fs/promises');\n    const content = await fs.readFile(configPath, 'utf-8');\n    \n    const config = JSON.parse(content) as MappingConfig;\n    \n    // Resolve relative paths in registries config\n    if (config.registries) {\n      const configDir = dirname(configPath);\n      config.registries = this.resolveRegistryPaths(config.registries, configDir);\n    }\n    \n    // Resolve relative path in output directory\n    if (config.output?.directory && !isAbsolute(config.output.directory)) {\n      const configDir = dirname(configPath);\n      config.output.directory = resolve(configDir, config.output.directory);\n    }\n    \n    return config;\n  }\n\n  /**\n   * Resolve relative paths in registry config\n   */\n  private static resolveRegistryPaths(\n    registries: RegistriesConfig,\n    basePath: string\n  ): RegistriesConfig {\n    const resolved: RegistriesConfig = {};\n\n    if (registries.muscles?.local) {\n      resolved.muscles = {\n        ...registries.muscles,\n        local: isAbsolute(registries.muscles.local)\n          ? registries.muscles.local\n          : resolve(basePath, registries.muscles.local)\n      };\n    } else if (registries.muscles) {\n      resolved.muscles = registries.muscles;\n    }\n\n    if (registries.equipment?.local) {\n      resolved.equipment = {\n        ...registries.equipment,\n        local: isAbsolute(registries.equipment.local)\n          ? registries.equipment.local\n          : resolve(basePath, registries.equipment.local)\n      };\n    } else if (registries.equipment) {\n      resolved.equipment = registries.equipment;\n    }\n\n    if (registries.muscleCategories?.local) {\n      resolved.muscleCategories = {\n        ...registries.muscleCategories,\n        local: isAbsolute(registries.muscleCategories.local)\n          ? registries.muscleCategories.local\n          : resolve(basePath, registries.muscleCategories.local)\n      };\n    } else if (registries.muscleCategories) {\n      resolved.muscleCategories = registries.muscleCategories;\n    }\n\n    return resolved;\n  }\n\n  /**\n   * Load a mapping configuration from a URL\n   */\n  static async loadFromUrl(url: string): Promise<MappingConfig> {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`Failed to load config from ${url}: ${response.statusText}`);\n    }\n    \n    return response.json() as Promise<MappingConfig>;\n  }\n\n  /**\n   * Merge multiple configurations\n   */\n  static merge(...configs: Partial<MappingConfig>[]): MappingConfig {\n    const merged: MappingConfig = {\n      version: '1.0.0',\n      targetSchema: { version: '1.0.0' },\n      mappings: {},\n    };\n\n    for (const config of configs) {\n      if (config.version) merged.version = config.version;\n      if (config.targetSchema) {\n        merged.targetSchema = { ...merged.targetSchema, ...config.targetSchema };\n      }\n      if (config.registries) {\n        merged.registries = { ...merged.registries, ...config.registries };\n      }\n      if (config.mappings) {\n        merged.mappings = { ...merged.mappings, ...config.mappings };\n      }\n      if (config.allowUnsafeEval !== undefined) {\n        merged.allowUnsafeEval = config.allowUnsafeEval;\n      }\n      if (config.enrichment) {\n        merged.enrichment = { ...merged.enrichment, ...config.enrichment };\n      }\n      if (config.validation) {\n        merged.validation = { ...merged.validation, ...config.validation };\n      }\n      if (config.output) {\n        merged.output = { ...merged.output, ...config.output };\n      }\n      if (config.plugins) {\n        merged.plugins = [...(merged.plugins || []), ...config.plugins];\n      }\n    }\n\n    return merged;\n  }\n\n  /**\n   * Apply environment variable overrides\n   */\n  static applyEnvOverrides(config: MappingConfig): MappingConfig {\n    const result = { ...config };\n\n    // API key from environment\n    if (!result.enrichment?.apiKey && process.env.OPENROUTER_API_KEY) {\n      result.enrichment = {\n        ...result.enrichment,\n        apiKey: process.env.OPENROUTER_API_KEY,\n      };\n    }\n\n    // Model override\n    if (process.env.FDS_TRANSFORMER_MODEL) {\n      result.enrichment = {\n        ...result.enrichment,\n        model: process.env.FDS_TRANSFORMER_MODEL,\n      };\n    }\n\n    return result;\n  }\n\n  /**\n   * Validate a configuration\n   */\n  static validate(config: MappingConfig): { valid: boolean; errors: string[] } {\n    const errors: string[] = [];\n\n    // Required fields\n    if (!config.version) {\n      errors.push('Missing required field: version');\n    }\n\n    if (!config.targetSchema?.version) {\n      errors.push('Missing required field: targetSchema.version');\n    }\n\n    if (!config.mappings || Object.keys(config.mappings).length === 0) {\n      errors.push('Missing required field: mappings (must have at least one mapping)');\n    }\n\n    // Validate mappings reference valid transforms\n    // (This would require access to the transform registry)\n\n    return {\n      valid: errors.length === 0,\n      errors,\n    };\n  }\n}\n\nexport default ConfigLoader;\n","/**\n * Batch Processor - handles streaming and parallel processing\n */\n\nimport type { TransformResult } from './types.js';\nimport { Transformer } from './transformer.js';\n\nexport interface BatchOptions {\n  concurrency?: number;\n  chunkSize?: number;\n  onProgress?: (progress: BatchProgress) => void;\n  onError?: (error: Error, item: Record<string, unknown>, index: number) => void;\n}\n\nexport interface BatchProgress {\n  processed: number;\n  total: number;\n  successful: number;\n  failed: number;\n  percentage: number;\n}\n\nexport interface BatchResult {\n  results: TransformResult[];\n  summary: {\n    total: number;\n    successful: number;\n    failed: number;\n    duration: number;\n  };\n}\n\nexport class BatchProcessor {\n  private transformer: Transformer;\n  private options: Required<BatchOptions>;\n\n  constructor(transformer: Transformer, options: BatchOptions = {}) {\n    this.transformer = transformer;\n    this.options = {\n      concurrency: options.concurrency ?? 5,\n      chunkSize: options.chunkSize ?? 10,\n      onProgress: options.onProgress ?? (() => {}),\n      onError: options.onError ?? (() => {}),\n    };\n  }\n\n  /**\n   * Process items in parallel batches\n   */\n  async process(items: Record<string, unknown>[]): Promise<BatchResult> {\n    const startTime = Date.now();\n    const results: TransformResult[] = [];\n    let successful = 0;\n    let failed = 0;\n\n    // Process in chunks to manage memory\n    for (let i = 0; i < items.length; i += this.options.chunkSize) {\n      const chunk = items.slice(i, i + this.options.chunkSize);\n      const chunkResults = await this.processChunk(chunk, i);\n\n      for (const result of chunkResults) {\n        results.push(result);\n        if (result.success) {\n          successful++;\n        } else {\n          failed++;\n        }\n      }\n\n      // Report progress\n      this.options.onProgress({\n        processed: Math.min(i + this.options.chunkSize, items.length),\n        total: items.length,\n        successful,\n        failed,\n        percentage: Math.round(\n          (Math.min(i + this.options.chunkSize, items.length) / items.length) * 100\n        ),\n      });\n    }\n\n    return {\n      results,\n      summary: {\n        total: items.length,\n        successful,\n        failed,\n        duration: Date.now() - startTime,\n      },\n    };\n  }\n\n  /**\n   * Process a chunk of items with concurrency control\n   */\n  private async processChunk(\n    chunk: Record<string, unknown>[],\n    startIndex: number\n  ): Promise<TransformResult[]> {\n    const results: TransformResult[] = new Array(chunk.length);\n\n    // Process with concurrency limit using a semaphore pattern\n    const executing = new Set<Promise<void>>();\n\n    for (let i = 0; i < chunk.length; i++) {\n      const item = chunk[i];\n      const globalIndex = startIndex + i;\n\n      const task = (async () => {\n        try {\n          const result = await this.transformer.transform(item);\n          results[i] = result;\n        } catch (error) {\n          const err = error instanceof Error ? error : new Error(String(error));\n          this.options.onError(err, item, globalIndex);\n          results[i] = {\n            success: false,\n            errors: [{ field: '_batch', message: err.message }],\n          };\n        }\n      })();\n\n      // Wrap task to remove itself from executing set when done\n      const wrappedTask = task.finally(() => {\n        executing.delete(wrappedTask);\n      });\n\n      executing.add(wrappedTask);\n\n      // Limit concurrency - wait for one to complete if at limit\n      if (executing.size >= this.options.concurrency) {\n        await Promise.race(executing);\n      }\n    }\n\n    // Wait for remaining tasks\n    await Promise.all(executing);\n\n    return results;\n  }\n\n  /**\n   * Process items as an async stream\n   */\n  async *processStream(\n    items: AsyncIterable<Record<string, unknown>> | Iterable<Record<string, unknown>>\n  ): AsyncGenerator<TransformResult> {\n    let index = 0;\n\n    for await (const item of items) {\n      try {\n        const result = await this.transformer.transform(item);\n        yield result;\n      } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        this.options.onError(err, item, index);\n        yield {\n          success: false,\n          errors: [{ field: '_batch', message: err.message }],\n        };\n      }\n      index++;\n    }\n  }\n}\n"],"mappings":"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","names":["path","toArray","template","path","getNestedValue","path","currentRecord","path","path","resolve","resolve","template","path","dirname","log","spinner"]}